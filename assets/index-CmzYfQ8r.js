var hf=Object.defineProperty;var cf=(n,t,e)=>t in n?hf(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var Z=(n,t,e)=>cf(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const ue={ADD:"add",REMOVE:"remove"},gs={PROPERTYCHANGE:"propertychange"},st={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Fo{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function uf(n,t,e){let i,s;e=e||Li;let r=0,o=n.length,a=!1;for(;r<o;)i=r+(o-r>>1),s=+e(n[i],t),s<0?r=i+1:(o=i,a=!s);return a?r:~r}function Li(n,t){return n>t?1:n<t?-1:0}function df(n,t){return n<t?1:n>t?-1:0}function _l(n,t,e){if(n[0]<=t)return 0;const i=n.length;if(t<=n[i-1])return i-1;if(typeof e=="function"){for(let s=1;s<i;++s){const r=n[s];if(r===t)return s;if(r<t)return e(t,n[s-1],r)>0?s-1:s}return i-1}if(e>0){for(let s=1;s<i;++s)if(n[s]<t)return s-1;return i-1}if(e<0){for(let s=1;s<i;++s)if(n[s]<=t)return s;return i-1}for(let s=1;s<i;++s){if(n[s]==t)return s;if(n[s]<t)return n[s-1]-t<t-n[s]?s-1:s}return i-1}function ff(n,t,e){for(;t<e;){const i=n[t];n[t]=n[e],n[e]=i,++t,--e}}function di(n,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let s=0;s<i;s++)n[n.length]=e[s]}function gn(n,t){const e=n.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(n[i]!==t[i])return!1;return!0}function gf(n,t,e){const i=t||Li;return n.every(function(s,r){if(r===0)return!0;const o=i(n[r-1],s);return!(o>0||o===0)})}function nr(){return!0}function ko(){return!1}function sr(){}function Qc(n){let t,e,i;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==i||!gn(s,e))&&(i=this,e=s,t=n.apply(this,arguments)),t}}function mf(n){function t(){let e;try{e=n()}catch(i){return Promise.reject(i)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function Er(n){for(const t in n)delete n[t]}function An(n){let t;for(t in n)return!1;return!t}class qt{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Do extends Fo{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),s=i[t]||(i[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,s=this.listeners_&&this.listeners_[i];if(!s)return;const r=e?new qt(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?l=s[h].handleEvent(r):l=s[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,sr);delete o[i]}return l}disposeInternal(){this.listeners_&&Er(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const i=this.listeners_[t];if(!i)return;const s=i.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[s]=sr,++this.pendingRemovals_[t]):(i.splice(s,1),i.length===0&&delete this.listeners_[t]))}}function ut(n,t,e,i,s){if(s){const o=e;e=function(a){return n.removeEventListener(t,e),o.call(i??this,a)}}else i&&i!==n&&(e=e.bind(i));const r={target:n,type:t,listener:e};return n.addEventListener(t,e),r}function lo(n,t,e,i){return ut(n,t,e,i,!0)}function wt(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),Er(n))}class vr extends Do{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(st.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=ut(this,t[r],e);return s}return ut(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const s=t.length;i=new Array(s);for(let r=0;r<s;++r)i[r]=lo(this,t[r],e)}else i=lo(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)pf(i);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}vr.prototype.on;vr.prototype.once;vr.prototype.un;function pf(n){if(Array.isArray(n))for(let t=0,e=n.length;t<e;++t)wt(n[t]);else wt(n)}function tt(){throw new Error("Unimplemented abstract method.")}let _f=0;function gt(n){return n.ol_uid||(n.ol_uid=String(++_f))}class uh extends qt{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class He extends vr{constructor(t){super(),this.on,this.once,this.un,gt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new uh(i,t,e)),i=gs.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new uh(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const s=this.values_||(this.values_={});if(i)s[t]=e;else{const r=s[t];s[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],An(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const dh={LENGTH:"length"};class Fr extends qt{constructor(t,e,i){super(t),this.element=e,this.index=i}}class li extends He{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let i=0,s=this.array_.length;i<s;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(dh.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Fr(ue.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,s=e.length;i<s;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Fr(ue.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const s=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Fr(ue.REMOVE,s,t)),this.dispatchEvent(new Fr(ue.ADD,e,t))}updateLength_(){this.set(dh.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,s=this.array_.length;i<s;++i)if(this.array_[i]===t&&i!==e)throw new Error("Duplicate item added to a unique collection")}}function mt(n,t){if(!n)throw new Error(t)}class Ce extends He{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Ce(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(wt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=ut(t,st.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?yf(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function yf(n){if(typeof n=="function")return n;let t;return Array.isArray(n)?t=n:(mt(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[n]),function(){return t}}const Ut={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function fh(n){const t=$e();for(let e=0,i=n.length;e<i;++e)Qs(t,n[e]);return t}function xf(n,t,e){const i=Math.min.apply(null,n),s=Math.min.apply(null,t),r=Math.max.apply(null,n),o=Math.max.apply(null,t);return ki(i,s,r,o,e)}function yl(n,t,e){return e?(e[0]=n[0]-t,e[1]=n[1]-t,e[2]=n[2]+t,e[3]=n[3]+t,e):[n[0]-t,n[1]-t,n[2]+t,n[3]+t]}function tu(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n.slice()}function kn(n,t,e){let i,s;return t<n[0]?i=n[0]-t:n[2]<t?i=t-n[2]:i=0,e<n[1]?s=n[1]-e:n[3]<e?s=e-n[3]:s=0,i*i+s*s}function ms(n,t){return xl(n,t[0],t[1])}function os(n,t){return n[0]<=t[0]&&t[2]<=n[2]&&n[1]<=t[1]&&t[3]<=n[3]}function xl(n,t,e){return n[0]<=t&&t<=n[2]&&n[1]<=e&&e<=n[3]}function Na(n,t){const e=n[0],i=n[1],s=n[2],r=n[3],o=t[0],a=t[1];let l=Ut.UNKNOWN;return o<e?l=l|Ut.LEFT:o>s&&(l=l|Ut.RIGHT),a<i?l=l|Ut.BELOW:a>r&&(l=l|Ut.ABOVE),l===Ut.UNKNOWN&&(l=Ut.INTERSECTING),l}function $e(){return[1/0,1/0,-1/0,-1/0]}function ki(n,t,e,i,s){return s?(s[0]=n,s[1]=t,s[2]=e,s[3]=i,s):[n,t,e,i]}function Cs(n){return ki(1/0,1/0,-1/0,-1/0,n)}function eu(n,t){const e=n[0],i=n[1];return ki(e,i,e,i,t)}function El(n,t,e,i,s){const r=Cs(s);return nu(r,n,t,e,i)}function rr(n,t){return n[0]==t[0]&&n[2]==t[2]&&n[1]==t[1]&&n[3]==t[3]}function iu(n,t){return t[0]<n[0]&&(n[0]=t[0]),t[2]>n[2]&&(n[2]=t[2]),t[1]<n[1]&&(n[1]=t[1]),t[3]>n[3]&&(n[3]=t[3]),n}function Qs(n,t){t[0]<n[0]&&(n[0]=t[0]),t[0]>n[2]&&(n[2]=t[0]),t[1]<n[1]&&(n[1]=t[1]),t[1]>n[3]&&(n[3]=t[1])}function nu(n,t,e,i,s){for(;e<i;e+=s)Ef(n,t[e],t[e+1]);return n}function Ef(n,t,e){n[0]=Math.min(n[0],t),n[1]=Math.min(n[1],e),n[2]=Math.max(n[2],t),n[3]=Math.max(n[3],e)}function su(n,t){let e;return e=t(No(n)),e||(e=t(Go(n)),e)||(e=t(zo(n)),e)||(e=t(Dn(n)),e)?e:!1}function Ga(n){let t=0;return wr(n)||(t=Et(n)*re(n)),t}function No(n){return[n[0],n[1]]}function Go(n){return[n[2],n[1]]}function cn(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function vf(n,t){let e;if(t==="bottom-left")e=No(n);else if(t==="bottom-right")e=Go(n);else if(t==="top-left")e=Dn(n);else if(t==="top-right")e=zo(n);else throw new Error("Invalid corner");return e}function za(n,t,e,i,s){const[r,o,a,l,h,c,d,m]=ru(n,t,e,i);return ki(Math.min(r,a,h,d),Math.min(o,l,c,m),Math.max(r,a,h,d),Math.max(o,l,c,m),s)}function ru(n,t,e,i){const s=t*i[0]/2,r=t*i[1]/2,o=Math.cos(e),a=Math.sin(e),l=s*o,h=s*a,c=r*o,d=r*a,m=n[0],y=n[1];return[m-l+d,y-h-c,m-l-d,y-h+c,m+l-d,y+h+c,m+l+d,y+h-c,m-l+d,y-h-c]}function re(n){return n[3]-n[1]}function In(n,t,e){const i=e||$e();return ge(n,t)?(n[0]>t[0]?i[0]=n[0]:i[0]=t[0],n[1]>t[1]?i[1]=n[1]:i[1]=t[1],n[2]<t[2]?i[2]=n[2]:i[2]=t[2],n[3]<t[3]?i[3]=n[3]:i[3]=t[3]):Cs(i),i}function Dn(n){return[n[0],n[3]]}function zo(n){return[n[2],n[3]]}function Et(n){return n[2]-n[0]}function ge(n,t){return n[0]<=t[2]&&n[2]>=t[0]&&n[1]<=t[3]&&n[3]>=t[1]}function wr(n){return n[2]<n[0]||n[3]<n[1]}function wf(n,t){return t?(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t):n}function Sf(n,t,e){let i=!1;const s=Na(n,t),r=Na(n,e);if(s===Ut.INTERSECTING||r===Ut.INTERSECTING)i=!0;else{const o=n[0],a=n[1],l=n[2],h=n[3],c=t[0],d=t[1],m=e[0],y=e[1],x=(y-d)/(m-c);let R,I;r&Ut.ABOVE&&!(s&Ut.ABOVE)&&(R=m-(y-h)/x,i=R>=o&&R<=l),!i&&r&Ut.RIGHT&&!(s&Ut.RIGHT)&&(I=y-(m-l)*x,i=I>=a&&I<=h),!i&&r&Ut.BELOW&&!(s&Ut.BELOW)&&(R=m-(y-a)/x,i=R>=o&&R<=l),!i&&r&Ut.LEFT&&!(s&Ut.LEFT)&&(I=y-(m-o)*x,i=I>=a&&I<=h)}return i}function Cf(n,t,e,i){if(wr(n))return Cs(e);let s=[];s=[n[0],n[1],n[2],n[1],n[2],n[3],n[0],n[3]],t(s,s,2);const r=[],o=[];for(let a=0,l=s.length;a<l;a+=2)r.push(s[a]),o.push(s[a+1]);return xf(r,o,e)}function ou(n,t){const e=t.getExtent(),i=cn(n);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const s=Et(e),o=Math.floor((i[0]-e[0])/s)*s;n[0]-=o,n[2]-=o}return n}function au(n,t,e){if(t.canWrapX()){const i=t.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];ou(n,t);const s=Et(i);if(Et(n)>s&&!e)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+s,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-s,n[3]]]}return[n]}function At(n,t,e){return Math.min(Math.max(n,t),e)}function bf(n,t,e,i,s,r){const o=s-e,a=r-i;if(o!==0||a!==0){const l=((n-e)*o+(t-i)*a)/(o*o+a*a);l>1?(e=s,i=r):l>0&&(e+=o*l,i+=a*l)}return Ln(n,t,e,i)}function Ln(n,t,e,i){const s=e-n,r=i-t;return s*s+r*r}function Tf(n){const t=n.length;for(let i=0;i<t;i++){let s=i,r=Math.abs(n[i][i]);for(let a=i+1;a<t;a++){const l=Math.abs(n[a][i]);l>r&&(r=l,s=a)}if(r===0)return null;const o=n[s];n[s]=n[i],n[i]=o;for(let a=i+1;a<t;a++){const l=-n[a][i]/n[i][i];for(let h=i;h<t+1;h++)i==h?n[a][h]=0:n[a][h]+=l*n[i][h]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=n[i][t]/n[i][i];for(let s=i-1;s>=0;s--)n[s][t]-=n[s][i]*e[i]}return e}function gh(n){return n*180/Math.PI}function ln(n){return n*Math.PI/180}function Mn(n,t){const e=n%t;return e*t<0?e+t:e}function Te(n,t,e){return n+e*(t-n)}function $o(n,t){const e=Math.pow(10,t);return Math.round(n*e)/e}function kr(n,t){return Math.floor($o(n,t))}function Dr(n,t){return Math.ceil($o(n,t))}function $a(n,t,e){if(n>=t&&n<e)return n;const i=e-t;return((n-t)%i+i)%i+t}const Rf=63710088e-1;function mh(n,t,e){e=e||Rf;const i=ln(n[1]),s=ln(t[1]),r=(s-i)/2,o=ln(t[0]-n[0])/2,a=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}function lu(...n){console.warn(...n)}function If(n,t){return n[0]+=+t[0],n[1]+=+t[1],n}function ho(n,t){let e=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=t[i]){e=!1;break}return e}function vl(n,t){const e=Math.cos(t),i=Math.sin(t),s=n[0]*e-n[1]*i,r=n[1]*e+n[0]*i;return n[0]=s,n[1]=r,n}function Lf(n,t){return n[0]*=t,n[1]*=t,n}function hu(n,t){if(t.canWrapX()){const e=Et(t.getExtent()),i=Mf(n,t,e);i&&(n[0]-=i*e)}return n}function Mf(n,t,e){const i=t.getExtent();let s=0;return t.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(e=e||Et(i),s=Math.floor((n[0]-i[0])/e)),s}const ps={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class wl{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ps[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const Sr=6378137,as=Math.PI*Sr,Pf=[-as,-as,as,as],Af=[-180,-85,180,85],Nr=Sr*Math.log(Math.tan(Math.PI/2));class jn extends wl{constructor(t){super({code:t,units:"m",extent:Pf,global:!0,worldExtent:Af,getPointResolution:function(e,i){return e/Math.cosh(i[1]/Sr)}})}}const ph=[new jn("EPSG:3857"),new jn("EPSG:102100"),new jn("EPSG:102113"),new jn("EPSG:900913"),new jn("http://www.opengis.net/def/crs/EPSG/0/3857"),new jn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Of(n,t,e,i){const s=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(s));for(let r=0;r<s;r+=i){t[r]=as*n[r]/180;let o=Sr*Math.log(Math.tan(Math.PI*(+n[r+1]+90)/360));o>Nr?o=Nr:o<-Nr&&(o=-Nr),t[r+1]=o}return t}function Ff(n,t,e,i){const s=n.length;e=e>1?e:2,i=i??e,t===void 0&&(e>2?t=n.slice():t=new Array(s));for(let r=0;r<s;r+=i)t[r]=180*n[r]/as,t[r+1]=360*Math.atan(Math.exp(n[r+1]/Sr))/Math.PI-90;return t}const kf=6378137,_h=[-180,-90,180,90],Df=Math.PI*kf/180;class yn extends wl{constructor(t,e){super({code:t,units:"degrees",extent:_h,axisOrientation:e,global:!0,metersPerUnit:Df,worldExtent:_h})}}const yh=[new yn("CRS:84"),new yn("EPSG:4326","neu"),new yn("urn:ogc:def:crs:OGC:1.3:CRS84"),new yn("urn:ogc:def:crs:OGC:2:84"),new yn("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new yn("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new yn("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Wa={};function Nf(n){return Wa[n]||Wa[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Gf(n,t){Wa[n]=t}let cs={};function or(n,t,e){const i=n.getCode(),s=t.getCode();i in cs||(cs[i]={}),cs[i][s]=e}function ra(n,t){return n in cs&&t in cs[n]?cs[n][t]:null}const co=.9996,ze=.00669438,Wo=ze*ze,Bo=Wo*ze,Sn=ze/(1-ze),xh=Math.sqrt(1-ze),_s=(1-xh)/(1+xh),cu=_s*_s,Sl=cu*_s,Cl=Sl*_s,uu=Cl*_s,du=1-ze/4-3*Wo/64-5*Bo/256,zf=3*ze/8+3*Wo/32+45*Bo/1024,$f=15*Wo/256+45*Bo/1024,Wf=35*Bo/3072,Bf=3/2*_s-27/32*Sl+269/512*uu,Xf=21/16*cu-55/32*Cl,Uf=151/96*Sl-417/128*uu,Yf=1097/512*Cl,uo=6378137;function jf(n,t,e){const i=n-5e5,o=(e.north?t:t-1e7)/co/(uo*du),a=o+Bf*Math.sin(2*o)+Xf*Math.sin(4*o)+Uf*Math.sin(6*o)+Yf*Math.sin(8*o),l=Math.sin(a),h=l*l,c=Math.cos(a),d=l/c,m=d*d,y=m*m,x=1-ze*h,R=Math.sqrt(1-ze*h),I=uo/R,M=(1-ze)/x,v=Sn*c**2,A=v*v,P=i/(I*co),O=P*P,G=O*P,k=G*P,u=k*P,f=u*P,g=a-d/M*(O/2-k/24*(5+3*m+10*v-4*A-9*Sn))+f/720*(61+90*m+298*v+45*y-252*Sn-3*A);let E=(P-G/6*(1+2*m+v)+u/120*(5-2*v+28*m-3*A+8*Sn+24*y))/c;return E=$a(E+ln(fu(e.number)),-Math.PI,Math.PI),[gh(E),gh(g)]}const Eh=-80,vh=84,Kf=-180,Zf=180;function Vf(n,t,e){n=$a(n,Kf,Zf),t<Eh?t=Eh:t>vh&&(t=vh);const i=ln(t),s=Math.sin(i),r=Math.cos(i),o=s/r,a=o*o,l=a*a,h=ln(n),c=fu(e.number),d=ln(c),m=uo/Math.sqrt(1-ze*s**2),y=Sn*r**2,x=r*$a(h-d,-Math.PI,Math.PI),R=x*x,I=R*x,M=I*x,v=M*x,A=v*x,P=uo*(du*i-zf*Math.sin(2*i)+$f*Math.sin(4*i)-Wf*Math.sin(6*i)),O=co*m*(x+I/6*(1-a+y)+v/120*(5-18*a+l+72*y-58*Sn))+5e5;let G=co*(P+m*o*(R/2+M/24*(5-a+9*y+4*y**2)+A/720*(61-58*a+l+600*y-330*Sn)));return e.north||(G+=1e7),[O,G]}function fu(n){return(n-1)*6-180+3}const qf=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function gu(n){let t=0;for(const s of qf){const r=n.match(s);if(r){t=parseInt(r[1]);break}}if(!t)return null;let e=0,i=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(i=!0,e=t-32600),e?{number:e,north:i}:null}function wh(n,t){return function(e,i,s,r){const o=e.length;s=s>1?s:2,r=r??s,i||(s>2?i=e.slice():i=new Array(o));for(let a=0;a<o;a+=r){const l=e[a],h=e[a+1],c=n(l,h,t);i[a]=c[0],i[a+1]=c[1]}return i}}function Hf(n){return gu(n)?new wl({code:n,units:"m"}):null}function Jf(n){const t=gu(n.getCode());return t?{forward:wh(Vf,t),inverse:wh(jf,t)}:null}const Qf=[Jf],tg=[Hf];let Ba=!0;function mu(n){Ba=!1}function bl(n,t){if(t!==void 0){for(let e=0,i=n.length;e<i;++e)t[e]=n[e];t=t}else t=n.slice();return t}function Xa(n){Gf(n.getCode(),n),or(n,n,bl)}function eg(n){n.forEach(Xa)}function kt(n){if(typeof n!="string")return n;const t=Nf(n);if(t)return t;for(const e of tg){const i=e(n);if(i)return i}return null}function fo(n,t,e,i){n=kt(n);let s;const r=n.getPointResolutionFunc();if(r){if(s=r(t,e),i&&i!==n.getUnits()){const o=n.getMetersPerUnit();o&&(s=s*o/ps[i])}}else{const o=n.getUnits();if(o=="degrees"&&!i||i=="degrees")s=t;else{const a=Rl(n,kt("EPSG:4326"));if(!a&&o!=="degrees")s=t*n.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const c=mh(h.slice(0,2),h.slice(2,4)),d=mh(h.slice(4,6),h.slice(6,8));s=(c+d)/2}const l=i?ps[i]:n.getMetersPerUnit();l!==void 0&&(s/=l)}}return s}function Sh(n){eg(n),n.forEach(function(t){n.forEach(function(e){t!==e&&or(t,e,bl)})})}function ig(n,t,e,i){n.forEach(function(s){t.forEach(function(r){or(s,r,e),or(r,s,i)})})}function Tl(n,t){return n?typeof n=="string"?kt(n):n:kt(t)}function ng(n){return function(t,e,i,s){const r=t.length;i=i!==void 0?i:2,s=s??i,e=e!==void 0?e:new Array(r);for(let o=0;o<r;o+=s){const a=n(t.slice(o,o+i)),l=a.length;for(let h=0,c=s;h<c;++h)e[o+h]=h>=l?t[o+h]:a[h]}return e}}function Bs(n,t){return mu(),Xo(n,"EPSG:4326",t!==void 0?t:"EPSG:3857")}function Ch(n,t){const e=Xo(n,t!==void 0?t:"EPSG:3857","EPSG:4326"),i=e[0];return(i<-180||i>180)&&(e[0]=Mn(i+180,360)-180),e}function Qr(n,t){if(n===t)return!0;const e=n.getUnits()===t.getUnits();return(n.getCode()===t.getCode()||Rl(n,t)===bl)&&e}function Rl(n,t){const e=n.getCode(),i=t.getCode();let s=ra(e,i);if(s)return s;let r=null,o=null;for(const l of Qf)r||(r=l(n)),o||(o=l(t));if(!r&&!o)return null;const a="EPSG:4326";if(o)if(r)s=oa(r.inverse,o.forward);else{const l=ra(e,a);l&&(s=oa(l,o.forward))}else{const l=ra(a,i);l&&(s=oa(r.inverse,l))}return s&&(Xa(n),Xa(t),or(n,t,s)),s}function oa(n,t){return function(e,i,s,r){return i=n(e,i,s,r),t(i,i,s,r)}}function ys(n,t){const e=kt(n),i=kt(t);return Rl(e,i)}function Xo(n,t,e){const i=ys(t,e);if(!i){const s=kt(t).getCode(),r=kt(e).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return i(n,void 0,n.length)}function sg(n,t,e,i){const s=ys(t,e);return Cf(n,s,void 0)}function Ua(n,t){return n}function bi(n,t){return Ba&&!ho(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(Ba=!1,lu("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function pu(n,t){return n}function rn(n,t){return n}function rg(){Sh(ph),Sh(yh),ig(yh,ph,Of,Ff)}rg();new Array(6);function Ze(){return[1,0,0,1,0,0]}function og(n,t){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n}function jt(n,t){const e=t[0],i=t[1];return t[0]=n[0]*e+n[2]*i+n[4],t[1]=n[1]*e+n[3]*i+n[5],t}function Di(n,t,e,i,s,r,o,a){const l=Math.sin(r),h=Math.cos(r);return n[0]=i*h,n[1]=s*l,n[2]=-i*l,n[3]=s*h,n[4]=o*i*h-a*i*l+t,n[5]=o*s*l+a*s*h+e,n}function _u(n,t){const e=ag(t);mt(e!==0,"Transformation matrix cannot be inverted");const i=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5];return n[0]=o/e,n[1]=-s/e,n[2]=-r/e,n[3]=i/e,n[4]=(r*l-o*a)/e,n[5]=-(i*l-s*a)/e,n}function ag(n){return n[0]*n[3]-n[1]*n[2]}const lg=[1e5,1e5,1e5,1e5,2,2];function hg(n){return"matrix("+n.join(", ")+")"}function bh(n){return n.substring(7,n.length-1).split(",").map(parseFloat)}function cg(n,t){const e=bh(n),i=bh(t);for(let s=0;s<6;++s)if(Math.round((e[s]-i[s])*lg[s])!==0)return!1;return!0}function hn(n,t,e,i,s,r,o){r=r||[],o=o||2;let a=0;for(let l=t;l<e;l+=i){const h=n[l],c=n[l+1];r[a++]=s[0]*h+s[2]*c+s[4],r[a++]=s[1]*h+s[3]*c+s[5];for(let d=2;d<o;d++)r[a++]=n[l+d]}return r&&r.length!=a&&(r.length=a),r}function yu(n,t,e,i,s,r,o){o=o||[];const a=Math.cos(s),l=Math.sin(s),h=r[0],c=r[1];let d=0;for(let m=t;m<e;m+=i){const y=n[m]-h,x=n[m+1]-c;o[d++]=h+y*a-x*l,o[d++]=c+y*l+x*a;for(let R=m+2;R<m+i;++R)o[d++]=n[R]}return o&&o.length!=d&&(o.length=d),o}function ug(n,t,e,i,s,r,o,a){a=a||[];const l=o[0],h=o[1];let c=0;for(let d=t;d<e;d+=i){const m=n[d]-l,y=n[d+1]-h;a[c++]=l+s*m,a[c++]=h+r*y;for(let x=d+2;x<d+i;++x)a[c++]=n[x]}return a&&a.length!=c&&(a.length=c),a}function dg(n,t,e,i,s,r,o){o=o||[];let a=0;for(let l=t;l<e;l+=i){o[a++]=n[l]+s,o[a++]=n[l+1]+r;for(let h=l+2;h<l+i;++h)o[a++]=n[h]}return o&&o.length!=a&&(o.length=a),o}const Th=Ze(),fg=[NaN,NaN];class xu extends He{constructor(){super(),this.extent_=$e(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=Qc((t,e,i)=>{if(!i)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(i),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return tt()}closestPointXY(t,e,i,s){return tt()}containsXY(t,e){return this.closestPointXY(t,e,fg,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return tt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Cs(e),this.extentRevision_=this.getRevision()}return wf(this.extent_,t)}rotate(t,e){tt()}scale(t,e,i){tt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return tt()}getType(){return tt()}applyTransform(t){tt()}intersectsExtent(t){return tt()}translate(t,e){tt()}transform(t,e){const i=kt(t),s=i.getUnits()=="tile-pixels"?function(r,o,a){const l=i.getExtent(),h=i.getWorldExtent(),c=re(h)/re(l);Di(Th,h[0],h[3],c,-c,0,0,0);const d=hn(r,0,r.length,a,Th,o),m=ys(i,e);return m?m(d,d,a):d}:ys(i,e);return this.applyTransform(s),this}}class Nn extends xu{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return El(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return tt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Rh(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){tt()}setLayout(t,e,i){let s;if(t)s=Rh(t);else{for(let r=0;r<i;++r){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=Gn(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();yu(i,0,i.length,s,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=cn(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();ug(s,0,s.length,r,t,e,i,s),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const s=this.getStride();dg(i,0,i.length,s,t,e,i),this.changed()}}}function Gn(n){let t;return n==2?t="XY":n==3?t="XYZ":n==4&&(t="XYZM"),t}function Rh(n){let t;return n=="XY"?t=2:n=="XYZ"||n=="XYM"?t=3:n=="XYZM"&&(t=4),t}function gg(n,t,e){const i=n.getFlatCoordinates();if(!i)return null;const s=n.getStride();return hn(i,0,i.length,s,t,e)}function Eu(n,t,e,i){let s=0;const r=n[e-i],o=n[e-i+1];let a=0,l=0;for(;t<e;t+=i){const h=n[t]-r,c=n[t+1]-o;s+=l*h-a*c,a=h,l=c}return s/2}function vu(n,t,e,i){let s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];s+=Eu(n,t,a,i),t=a}return s}function mg(n,t,e,i){let s=0;for(let r=0,o=e.length;r<o;++r){const a=e[r];s+=vu(n,t,a,i),t=a[a.length-1]}return s}function Ih(n,t,e,i,s,r,o){const a=n[t],l=n[t+1],h=n[e]-a,c=n[e+1]-l;let d;if(h===0&&c===0)d=t;else{const m=((s-a)*h+(r-l)*c)/(h*h+c*c);if(m>1)d=e;else if(m>0){for(let y=0;y<i;++y)o[y]=Te(n[t+y],n[e+y],m);o.length=i;return}else d=t}for(let m=0;m<i;++m)o[m]=n[d+m];o.length=i}function Il(n,t,e,i,s){let r=n[t],o=n[t+1];for(t+=i;t<e;t+=i){const a=n[t],l=n[t+1],h=Ln(r,o,a,l);h>s&&(s=h),r=a,o=l}return s}function Ll(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];s=Il(n,t,a,i,s),t=a}return s}function pg(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];s=Ll(n,t,a,i,s),t=a[a.length-1]}return s}function Ml(n,t,e,i,s,r,o,a,l,h,c){if(t==e)return h;let d,m;if(s===0){if(m=Ln(o,a,n[t],n[t+1]),m<h){for(d=0;d<i;++d)l[d]=n[t+d];return l.length=i,m}return h}c=c||[NaN,NaN];let y=t+i;for(;y<e;)if(Ih(n,y-i,y,i,o,a,c),m=Ln(o,a,c[0],c[1]),m<h){for(h=m,d=0;d<i;++d)l[d]=c[d];l.length=i,y+=i}else y+=i*Math.max((Math.sqrt(m)-Math.sqrt(h))/s|0,1);if(r&&(Ih(n,e-i,t,i,o,a,c),m=Ln(o,a,c[0],c[1]),m<h)){for(h=m,d=0;d<i;++d)l[d]=c[d];l.length=i}return h}function Pl(n,t,e,i,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let d=0,m=e.length;d<m;++d){const y=e[d];h=Ml(n,t,y,i,s,r,o,a,l,h,c),t=y}return h}function _g(n,t,e,i,s,r,o,a,l,h,c){c=c||[NaN,NaN];for(let d=0,m=e.length;d<m;++d){const y=e[d];h=Pl(n,t,y,i,s,r,o,a,l,h,c),t=y[y.length-1]}return h}function yg(n,t,e,i){for(let s=0,r=e.length;s<r;++s)n[t++]=e[s];return t}function Uo(n,t,e,i){for(let s=0,r=e.length;s<r;++s){const o=e[s];for(let a=0;a<i;++a)n[t++]=o[a]}return t}function Cr(n,t,e,i,s){s=s||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=Uo(n,t,e[o],i);s[r++]=l,t=l}return s.length=r,s}function wu(n,t,e,i,s){s=s||[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=Cr(n,t,e[o],i,s[r]);l.length===0&&(l[0]=t),s[r++]=l,t=l[l.length-1]}return s.length=r,s}function on(n,t,e,i,s){s=s!==void 0?s:[];let r=0;for(let o=t;o<e;o+=i)s[r++]=n.slice(o,o+i);return s.length=r,s}function ar(n,t,e,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=on(n,t,l,i,s[r]),t=l}return s.length=r,s}function Ya(n,t,e,i,s){s=s!==void 0?s:[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];s[r++]=l.length===1&&l[0]===t?[]:ar(n,t,l,i,s[r]),t=l[l.length-1]}return s.length=r,s}function Yo(n,t,e,i,s,r,o){const a=(e-t)/i;if(a<3){for(;t<e;t+=i)r[o++]=n[t],r[o++]=n[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-i];let c=0;for(;h.length>0;){const d=h.pop(),m=h.pop();let y=0;const x=n[m],R=n[m+1],I=n[d],M=n[d+1];for(let v=m+i;v<d;v+=i){const A=n[v],P=n[v+1],O=bf(A,P,x,R,I,M);O>y&&(c=v,y=O)}y>s&&(l[(c-t)/i]=1,m+i<c&&h.push(m,c),c+i<d&&h.push(c,d))}for(let d=0;d<a;++d)l[d]&&(r[o++]=n[t+d*i],r[o++]=n[t+d*i+1]);return o}function Su(n,t,e,i,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=Yo(n,t,c,i,s,r,o),a.push(o),t=c}return o}function wn(n,t){return t*Math.round(n/t)}function xg(n,t,e,i,s,r,o){if(t==e)return o;let a=wn(n[t],s),l=wn(n[t+1],s);t+=i,r[o++]=a,r[o++]=l;let h,c;do if(h=wn(n[t],s),c=wn(n[t+1],s),t+=i,t==e)return r[o++]=h,r[o++]=c,o;while(h==a&&c==l);for(;t<e;){const d=wn(n[t],s),m=wn(n[t+1],s);if(t+=i,d==h&&m==c)continue;const y=h-a,x=c-l,R=d-a,I=m-l;if(y*I==x*R&&(y<0&&R<y||y==R||y>0&&R>y)&&(x<0&&I<x||x==I||x>0&&I>x)){h=d,c=m;continue}r[o++]=h,r[o++]=c,a=h,l=c,h=d,c=m}return r[o++]=h,r[o++]=c,o}function Al(n,t,e,i,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l];o=xg(n,t,c,i,s,r,o),a.push(o),t=c}return o}function Eg(n,t,e,i,s,r,o,a){for(let l=0,h=e.length;l<h;++l){const c=e[l],d=[];o=Al(n,t,c,i,s,r,o,d),a.push(d),t=c[c.length-1]}return o}class lr extends Nn{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new lr(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,s){return s<kn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Il(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ml(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,s))}getArea(){return Eu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return on(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Yo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new lr(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Uo(this.flatCoordinates,0,t,this.stride),this.changed()}}class Mi extends Nn{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Mi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const r=this.flatCoordinates,o=Ln(t,e,r[0],r[1]);if(o<s){const a=this.stride;for(let l=0;l<a;++l)i[l]=r[l];return i.length=a,o}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return eu(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return xl(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=yg(this.flatCoordinates,0,t,this.stride),this.changed()}}function vg(n,t,e,i,s){return!su(s,function(o){return!Cn(n,t,e,i,o[0],o[1])})}function Cn(n,t,e,i,s,r){let o=0,a=n[e-i],l=n[e-i+1];for(;t<e;t+=i){const h=n[t],c=n[t+1];l<=r?c>r&&(h-a)*(r-l)-(s-a)*(c-l)>0&&o++:c<=r&&(h-a)*(r-l)-(s-a)*(c-l)<0&&o--,a=h,l=c}return o!==0}function Ol(n,t,e,i,s,r){if(e.length===0||!Cn(n,t,e[0],i,s,r))return!1;for(let o=1,a=e.length;o<a;++o)if(Cn(n,e[o-1],e[o],i,s,r))return!1;return!0}function wg(n,t,e,i,s,r){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(Ol(n,t,l,i,s,r))return!0;t=l[l.length-1]}return!1}function Fl(n,t,e,i,s,r,o){let a,l,h,c,d,m,y;const x=s[r+1],R=[];for(let v=0,A=e.length;v<A;++v){const P=e[v];for(c=n[P-i],m=n[P-i+1],a=t;a<P;a+=i)d=n[a],y=n[a+1],(x<=m&&y<=x||m<=x&&x<=y)&&(h=(x-m)/(y-m)*(d-c)+c,R.push(h)),c=d,m=y}let I=NaN,M=-1/0;for(R.sort(Li),c=R[0],a=1,l=R.length;a<l;++a){d=R[a];const v=Math.abs(d-c);v>M&&(h=(c+d)/2,Ol(n,t,e,i,h,x)&&(I=h,M=v)),c=d}return isNaN(I)&&(I=s[r]),o?(o.push(I,x,M),o):[I,x,M]}function Cu(n,t,e,i,s){let r=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];r=Fl(n,t,l,i,s,2*o,r),t=l[l.length-1]}return r}function bu(n,t,e,i,s){let r;for(t+=i;t<e;t+=i)if(r=s(n.slice(t-i,t),n.slice(t,t+i)),r)return r;return!1}function jo(n,t,e,i,s,r){return r=r??nu($e(),n,t,e,i),ge(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:bu(n,t,e,i,function(o,a){return Sf(s,o,a)}):!1}function Sg(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){if(jo(n,t,e[r],i,s))return!0;t=e[r]}return!1}function Tu(n,t,e,i,s){return!!(jo(n,t,e,i,s)||Cn(n,t,e,i,s[0],s[1])||Cn(n,t,e,i,s[0],s[3])||Cn(n,t,e,i,s[2],s[1])||Cn(n,t,e,i,s[2],s[3]))}function Ru(n,t,e,i,s){if(!Tu(n,t,e[0],i,s))return!1;if(e.length===1)return!0;for(let r=1,o=e.length;r<o;++r)if(vg(n,e[r-1],e[r],i,s)&&!jo(n,e[r-1],e[r],i,s))return!1;return!0}function Cg(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];if(Ru(n,t,a,i,s))return!0;t=a[a.length-1]}return!1}function bg(n,t,e,i){for(;t<e-i;){for(let s=0;s<i;++s){const r=n[t+s];n[t+s]=n[e-i+s],n[e-i+s]=r}t+=i,e-=i}}function kl(n,t,e,i){let s=0,r=n[e-i],o=n[e-i+1];for(;t<e;t+=i){const a=n[t],l=n[t+1];s+=(a-r)*(l+o),r=a,o=l}return s===0?void 0:s>0}function Dl(n,t,e,i,s){s=s!==void 0?s:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=kl(n,t,a,i);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;t=a}return!0}function Iu(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r){const a=e[r];if(!Dl(n,t,a,i,s))return!1;a.length&&(t=a[a.length-1])}return!0}function go(n,t,e,i,s){s=s!==void 0?s:!1;for(let r=0,o=e.length;r<o;++r){const a=e[r],l=kl(n,t,a,i);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&bg(n,t,a,i),t=a}return t}function ja(n,t,e,i,s){for(let r=0,o=e.length;r<o;++r)t=go(n,t,e[r],i,s);return t}function Tg(n,t){const e=[];let i=0,s=0,r;for(let o=0,a=t.length;o<a;++o){const l=t[o],h=kl(n,i,l,2);if(r===void 0&&(r=h),h===r)e.push(t.slice(s,o+1));else{if(e.length===0)continue;e[e.length-1].push(t[s])}s=o+1,i=l}return e}class gi extends Nn{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?di(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new gi(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<kn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ll(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pl(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return Ol(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return vu(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),go(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,ar(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=cn(this.getExtent());this.flatInteriorPoint_=Fl(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Mi(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new lr(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new lr(e.slice(r,l),t);s.push(h),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Dl(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=go(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Al(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new gi(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return Ru(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Cr(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function Lh(n){if(wr(n))throw new Error("Cannot create polygon from empty extent");const t=n[0],e=n[1],i=n[2],s=n[3],r=[t,e,t,s,i,s,i,e,t,e];return new gi(r,"XY",[r.length])}function mo(n,t,e,i,s,r,o){let a,l;const h=(e-t)/i;if(h===1)a=t;else if(h===2)a=t,l=s;else if(h!==0){let c=n[t],d=n[t+1],m=0;const y=[0];for(let I=t+i;I<e;I+=i){const M=n[I],v=n[I+1];m+=Math.sqrt((M-c)*(M-c)+(v-d)*(v-d)),y.push(m),c=M,d=v}const x=s*m,R=uf(y,x);R<0?(l=(x-y[-R-2])/(y[-R-1]-y[-R-2]),a=t+(-R-2)*i):a=t+R*i}o=o>1?o:2,r=r||new Array(o);for(let c=0;c<o;++c)r[c]=a===void 0?NaN:l===void 0?n[a+c]:Te(n[a+c],n[a+i+c],l);return r}function Ka(n,t,e,i,s,r){if(e==t)return null;let o;if(s<n[t+i-1])return r?(o=n.slice(t,t+i),o[i-1]=s,o):null;if(n[e-1]<s)return r?(o=n.slice(e-i,e),o[i-1]=s,o):null;if(s==n[t+i-1])return n.slice(t,t+i);let a=t/i,l=e/i;for(;a<l;){const m=a+l>>1;s<n[(m+1)*i-1]?l=m:a=m+1}const h=n[a*i-1];if(s==h)return n.slice((a-1)*i,(a-1)*i+i);const c=n[(a+1)*i-1],d=(s-h)/(c-h);o=[];for(let m=0;m<i-1;++m)o.push(Te(n[(a-1)*i+m],n[a*i+m],d));return o.push(s),o}function Rg(n,t,e,i,s,r,o){if(o)return Ka(n,t,e[e.length-1],i,s,r);let a;if(s<n[i-1])return r?(a=n.slice(0,i),a[i-1]=s,a):null;if(n[n.length-1]<s)return r?(a=n.slice(n.length-i),a[i-1]=s,a):null;for(let l=0,h=e.length;l<h;++l){const c=e[l];if(t!=c){if(s<n[t+i-1])return null;if(s<=n[c-1])return Ka(n,t,c,i,s,!1);t=c}}return null}function Nl(n,t,e,i){let s=n[t],r=n[t+1],o=0;for(let a=t+i;a<e;a+=i){const l=n[a],h=n[a+1];o+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return o}class un extends Nn{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){di(this.flatCoordinates,t),this.changed()}clone(){const t=new un(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<kn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Il(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ml(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,s))}forEachSegment(t){return bu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Ka(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return on(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return mo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Nl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Yo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new un(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return jo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Uo(this.flatCoordinates,0,t,this.stride),this.changed()}}const Ne={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},On=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Ig=On.includes("safari")&&!On.includes("chrom");Ig&&(On.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(On));const Lg=On.includes("webkit")&&!On.includes("edge"),Lu=On.includes("macintosh"),Mg=typeof devicePixelRatio<"u"?devicePixelRatio:1,Mu=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,Pu=typeof Image<"u"&&Image.prototype.decode,Au=function(){let n=!1;try{const t=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return n}(),ot={IDLE:0,LOADING:1,LOADED:2,ERROR:3};function Xt(n,t,e,i){let s;return e&&e.length?s=e.shift():Mu?s=new OffscreenCanvas(n||300,t||300):s=document.createElement("canvas"),n&&(s.width=n),t&&(s.height=t),s.getContext("2d",i)}let aa;function po(){return aa||(aa=Xt(1,1)),aa}function Ko(n){const t=n.canvas;t.width=1,t.height=1,n.clearRect(0,0,1,1)}function Pg(n){let t=n.offsetWidth;const e=getComputedStyle(n);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function Ag(n){let t=n.offsetHeight;const e=getComputedStyle(n);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function Mh(n,t){const e=t.parentNode;e&&e.replaceChild(n,t)}function Ou(n){for(;n.lastChild;)n.lastChild.remove()}function Og(n,t){const e=n.childNodes;for(let i=0;;++i){const s=e[i],r=t[i];if(!s&&!r)break;if(s!==r){if(!s){n.appendChild(r);continue}if(!r){n.removeChild(s),--i;continue}n.insertBefore(r,s)}}}const Gl=[NaN,NaN,NaN,0];let la;function Fg(){return la||(la=Xt(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),la}const kg=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Dg=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Ng=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,Gg=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function Gr(n,t){return n.endsWith("%")?Number(n.substring(0,n.length-1))/t:Number(n)}function tr(n){throw new Error('failed to parse "'+n+'" as color')}function Fu(n){if(n.toLowerCase().startsWith("rgb")){const r=n.match(Dg)||n.match(kg)||n.match(Ng);if(r){const o=r[4],a=100/255;return[At(Gr(r[1],a)+.5|0,0,255),At(Gr(r[2],a)+.5|0,0,255),At(Gr(r[3],a)+.5|0,0,255),o!==void 0?At(Gr(o,100),0,1):1]}tr(n)}if(n.startsWith("#")){if(Gg.test(n)){const r=n.substring(1),o=r.length<=4?1:2,a=[0,0,0,255];for(let l=0,h=r.length;l<h;l+=o){let c=parseInt(r.substring(l,l+o),16);o===1&&(c+=c<<4),a[l/o]=c}return a[3]=a[3]/255,a}tr(n)}const t=Fg();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=n,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=n,t.fillStyle===e&&tr(n));const i=t.fillStyle;if(i.startsWith("#")||i.startsWith("rgba"))return Fu(i);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const s=Array.from(t.getImageData(0,0,1,1).data);return s[3]=$o(s[3]/255,3),s}function zg(n){return typeof n=="string"?n:$l(n)}const $g=1024,Ms={};let ha=0;function Wg(n){if(n.length===4)return n;const t=n.slice();return t[3]=1,t}function ca(n){return n>.0031308?Math.pow(n,1/2.4)*269.025-14.025:n*3294.6}function ua(n){return n>.2068965?Math.pow(n,3):(n-4/29)*(108/841)}function da(n){return n>10.314724?Math.pow((n+14.025)/269.025,2.4):n/3294.6}function fa(n){return n>.0088564?Math.pow(n,1/3):n/(108/841)+4/29}function Ph(n){const t=da(n[0]),e=da(n[1]),i=da(n[2]),s=fa(t*.222488403+e*.716873169+i*.06060791),r=500*(fa(t*.452247074+e*.399439023+i*.148375274)-s),o=200*(s-fa(t*.016863605+e*.117638439+i*.865350722)),a=Math.atan2(o,r)*(180/Math.PI);return[116*s-16,Math.sqrt(r*r+o*o),a<0?a+360:a,n[3]]}function Bg(n){const t=(n[0]+16)/116,e=n[1],i=n[2]*Math.PI/180,s=ua(t),r=ua(t+e/500*Math.cos(i)),o=ua(t-e/200*Math.sin(i)),a=ca(r*3.021973625-s*1.617392459-o*.404875592),l=ca(r*-.943766287+s*1.916279586+o*.027607165),h=ca(r*.069407491-s*.22898585+o*1.159737864);return[At(a+.5|0,0,255),At(l+.5|0,0,255),At(h+.5|0,0,255),n[3]]}function zl(n){if(n==="none")return Gl;if(Ms.hasOwnProperty(n))return Ms[n];if(ha>=$g){let e=0;for(const i in Ms)(e++&3)===0&&(delete Ms[i],--ha)}const t=Fu(n);t.length!==4&&tr(n);for(const e of t)isNaN(e)&&tr(n);return Ms[n]=t,++ha,t}function xs(n){return Array.isArray(n)?n:zl(n)}function $l(n){let t=n[0];t!=(t|0)&&(t=t+.5|0);let e=n[1];e!=(e|0)&&(e=e+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const s=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+t+","+e+","+i+","+s+")"}function Xg(n,t,e){const i=n;let s=!0,r=!1,o=!1;const a=[lo(i,st.LOAD,function(){o=!0,r||t()})];return i.src&&Pu?(r=!0,i.decode().then(function(){s&&t()}).catch(function(l){s&&(o?t():e())})):a.push(lo(i,st.ERROR,e)),function(){s=!1,a.forEach(wt)}}function Ug(n,t){return new Promise((e,i)=>{function s(){o(),e(n)}function r(){o(),i(new Error("Image load error"))}function o(){n.removeEventListener("load",s),n.removeEventListener("error",r)}n.addEventListener("load",s),n.addEventListener("error",r)})}function Yg(n,t){return t&&(n.src=t),n.src&&Pu?new Promise((e,i)=>n.decode().then(()=>e(n)).catch(s=>n.complete&&n.width?e(n):i(s))):Ug(n)}class jg{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];(t++&3)===0&&!i.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,i){const s=ga(t,e,i);return s in this.cache_?this.cache_[s]:null}getPattern(t,e,i){const s=ga(t,e,i);return s in this.patternCache_?this.patternCache_[s]:null}set(t,e,i,s,r){const o=ga(t,e,i),a=o in this.cache_;this.cache_[o]=s,r&&(s.getImageState()===ot.IDLE&&s.load(),s.getImageState()===ot.LOADING?s.ready().then(()=>{this.patternCache_[o]=po().createPattern(s.getImage(1),"repeat")}):this.patternCache_[o]=po().createPattern(s.getImage(1),"repeat")),a||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function ga(n,t,e){const i=e?xs(e):"null";return t+":"+n+":"+i}const Ge=new jg;let Ps=null;class ku extends Do{constructor(t,e,i,s,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=i,this.canvas_={},this.color_=r,this.imageState_=s===void 0?ot.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===ot.LOADED){Ps||(Ps=Xt(1,1,void 0,{willReadFrequently:!0})),Ps.drawImage(this.image_,0,0);try{Ps.getImageData(0,0,1,1),this.tainted_=!1}catch{Ps=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(st.CHANGE)}handleImageError_(){this.imageState_=ot.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ot.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=Xt(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ot.IDLE){this.image_||this.initializeImage_(),this.imageState_=ot.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Yg(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==ot.LOADED)return;const e=this.image_,i=Xt(Math.ceil(e.width*t),Math.ceil(e.height*t)),s=i.canvas;i.scale(t,t),i.drawImage(e,0,0),i.globalCompositeOperation="multiply",i.fillStyle=zg(this.color_),i.fillRect(0,0,s.width/t,s.height/t),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),this.canvas_[t]=s}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===ot.LOADED||this.imageState_===ot.ERROR)t();else{const e=()=>{(this.imageState_===ot.LOADED||this.imageState_===ot.ERROR)&&(this.removeEventListener(st.CHANGE,e),t())};this.addEventListener(st.CHANGE,e)}})),this.ready_}}function Wl(n,t,e,i,s,r){let o=t===void 0?void 0:Ge.get(t,e,s);return o||(o=new ku(n,n&&"src"in n?n.src||void 0:t,e,i,s),Ge.set(t,e,s,o,r)),r&&o&&!Ge.getPattern(t,e,s)&&Ge.set(t,e,s,o,r),o}function hi(n){return n?Array.isArray(n)?$l(n):typeof n=="object"&&"src"in n?Kg(n):n:null}function Kg(n){if(!n.offset||!n.size)return Ge.getPattern(n.src,"anonymous",n.color);const t=n.src+":"+n.offset,e=Ge.getPattern(t,void 0,n.color);if(e)return e;const i=Ge.get(n.src,"anonymous",null);if(i.getImageState()!==ot.LOADED)return null;const s=Xt(n.size[0],n.size[1]);return s.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),Wl(s.canvas,t,void 0,ot.LOADED,n.color,!0),Ge.getPattern(t,void 0,n.color)}class Du{drawCustom(t,e,i,s,r){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,i){}drawFeature(t,e,i){}drawGeometryCollection(t,e,i){}drawLineString(t,e,i){}drawMultiLineString(t,e,i){}drawMultiPoint(t,e,i){}drawMultiPolygon(t,e,i){}drawPoint(t,e,i){}drawPolygon(t,e,i){}drawText(t,e,i){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const zr="ol-hidden",Zg="ol-selectable",br="ol-unselectable",Bl="ol-control",Ah="ol-collapsed",Vg=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),Oh=["style","variant","weight","size","lineHeight","family"],Nu=function(n){const t=n.match(Vg);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,s=Oh.length;i<s;++i){const r=t[i+1];r!==void 0&&(e[Oh[i]]=r)}return e.families=e.family.split(/,\s?/),e},Gu="10px sans-serif",de="#000",Es="round",Pi=[],Ai=0,vs="round",hr=10,cr="#000",ur="center",_o="middle",bn=[0,0,0,0],dr=1,Ti=new He;let ts=null,Za;const Va={},qg=function(){const t="32px ",e=["monospace","serif"],i=e.length,s="wmytzilWMYTZIL@#/&?$%10";let r,o;function a(h,c,d){let m=!0;for(let y=0;y<i;++y){const x=e[y];if(o=yo(h+" "+c+" "+t+x,s),d!=x){const R=yo(h+" "+c+" "+t+d+","+x,s);m=m&&R!=o}}return!!m}function l(){let h=!0;const c=Ti.getKeys();for(let d=0,m=c.length;d<m;++d){const y=c[d];if(Ti.get(y)<100){const[x,R,I]=y.split(`
`);a(x,R,I)?(Er(Va),ts=null,Za=void 0,Ti.set(y,100)):(Ti.set(y,Ti.get(y)+1,!0),h=!1)}}h&&(clearInterval(r),r=void 0)}return function(h){const c=Nu(h);if(!c)return;const d=c.families;for(let m=0,y=d.length;m<y;++m){const x=d[m],R=c.style+`
`+c.weight+`
`+x;Ti.get(R)===void 0&&(Ti.set(R,100,!0),a(c.style,c.weight,x)||(Ti.set(R,0,!0),r===void 0&&(r=setInterval(l,32))))}}}(),Hg=function(){let n;return function(t){let e=Va[t];if(e==null){if(Mu){const i=Nu(t),s=zu(t,"g");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=t,document.body.appendChild(n),e=n.offsetHeight,document.body.removeChild(n);Va[t]=e}return e}}();function zu(n,t){return ts||(ts=Xt(1,1)),n!=Za&&(ts.font=n,Za=ts.font),ts.measureText(t)}function yo(n,t){return zu(n,t).width}function Fh(n,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((s,r)=>Math.max(s,yo(n,r)),0);return e[t]=i,i}function Jg(n,t){const e=[],i=[],s=[];let r=0,o=0,a=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const d=t[h];if(d===`
`||h===c){r=Math.max(r,o),s.push(o),o=0,a+=l,l=0;continue}const m=t[h+1]||n.font,y=yo(m,d);e.push(y),o+=y;const x=Hg(m);i.push(x),l=Math.max(l,x)}return{width:r,height:a,widths:e,heights:i,lineWidths:s}}function Qg(n,t,e,i,s,r,o,a,l,h,c){n.save(),e!==1&&(n.globalAlpha===void 0?n.globalAlpha=d=>d.globalAlpha*=e:n.globalAlpha*=e),t&&n.transform.apply(n,t),i.contextInstructions?(n.translate(l,h),n.scale(c[0],c[1]),tm(i,n)):c[0]<0||c[1]<0?(n.translate(l,h),n.scale(c[0],c[1]),n.drawImage(i,s,r,o,a,0,0,o,a)):n.drawImage(i,s,r,o,a,l,h,o*c[0],a*c[1]),n.restore()}function tm(n,t){const e=n.contextInstructions;for(let i=0,s=e.length;i<s;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}class em extends Du{constructor(t,e,i,s,r,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=s,this.transformRotation_=s?$o(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Ze()}drawImages_(t,e,i,s){if(!this.image_)return;const r=hn(t,e,i,s,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,d=r.length;c<d;c+=2){const m=r[c]-this.imageAnchorX_,y=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const x=m+this.imageAnchorX_,R=y+this.imageAnchorY_;Di(a,x,R,1,1,h,-x,-R),o.save(),o.transform.apply(o,a),o.translate(x,R),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,m,y,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,i,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=hn(t,e,i,s,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=s){const l=r[e]+this.textOffsetX_,h=r[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,i,s,r){const o=this.context_,a=hn(t,e,i,s,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;r&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return r&&o.closePath(),i}drawRings_(t,e,i,s){for(let r=0,o=i.length;r<o;++r)e=this.moveToLineTo_(t,e,i[r],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ge(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=gg(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],s=e[3]-e[1],r=Math.sqrt(i*i+s*s),o=this.context_;o.beginPath(),o.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);i&&(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,s=e.length;i<s;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ge(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(ge(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,s=t.getFlatCoordinates();let r=0;const o=t.getEnds(),a=t.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)r=this.moveToLineTo_(s,r,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ge(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ge(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let s=0;const r=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=r.length;a<l;++a){const h=r[a];s=this.drawRings_(i,s,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),gn(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,s=t.textAlign?t.textAlign:ur;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=s&&(i.textAlign=s,e.textAlign=s),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:hi(i||de)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),s=e.getLineCap(),r=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=r||Pi;this.strokeState_={lineCap:s!==void 0?s:Es,lineDash:this.pixelRatio_===1?c:c.map(d=>d*this.pixelRatio_),lineDashOffset:(o||Ai)*this.pixelRatio_,lineJoin:a!==void 0?a:vs,lineWidth:(l!==void 0?l:dr)*this.pixelRatio_,miterLimit:h!==void 0?h:hr,strokeStyle:hi(i||cr)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*i,this.imageAnchorY_=s[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const y=e.getColor();this.textFillState_={fillStyle:hi(y||de)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const y=i.getColor(),x=i.getLineCap(),R=i.getLineDash(),I=i.getLineDashOffset(),M=i.getLineJoin(),v=i.getWidth(),A=i.getMiterLimit();this.textStrokeState_={lineCap:x!==void 0?x:Es,lineDash:R||Pi,lineDashOffset:I||Ai,lineJoin:M!==void 0?M:vs,lineWidth:v!==void 0?v:dr,miterLimit:A!==void 0?A:hr,strokeStyle:hi(y||cr)}}const s=t.getFont(),r=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),d=t.getTextAlign(),m=t.getTextBaseline();this.textState_={font:s!==void 0?s:Gu,textAlign:d!==void 0?d:ur,textBaseline:m!==void 0?m:_o},this.text_=c!==void 0?Array.isArray(c)?c.reduce((y,x,R)=>y+=R%2?" ":x,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const im=.5,$u={Point:cm,LineString:am,Polygon:dm,MultiPoint:um,MultiLineString:lm,MultiPolygon:hm,GeometryCollection:om,Circle:sm};function nm(n,t){return parseInt(gt(n),10)-parseInt(gt(t),10)}function kh(n,t){const e=Wu(n,t);return e*e}function Wu(n,t){return im*n/t}function sm(n,t,e,i,s){const r=e.getFill(),o=e.getStroke();if(r||o){const l=n.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(r,o),l.drawCircle(t,i,s)}const a=e.getText();if(a&&a.getText()){const l=n.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}}function Dh(n,t,e,i,s,r,o,a){const l=[],h=e.getImage();if(h){let m=!0;const y=h.getImageState();y==ot.LOADED||y==ot.ERROR?m=!1:y==ot.IDLE&&h.load(),m&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const d=l.length>0;return d&&Promise.all(l).then(()=>s(null)),rm(n,t,e,i,r,o,a),d}function rm(n,t,e,i,s,r,o){const a=e.getGeometryFunction()(t);if(!a)return;const l=a.simplifyTransformed(i,s);if(e.getRenderer())Bu(n,l,e,t,o);else{const c=$u[l.getType()];c(n,l,e,t,o,r)}}function Bu(n,t,e,i,s){if(t.getType()=="GeometryCollection"){const o=t.getGeometries();for(let a=0,l=o.length;a<l;++a)Bu(n,o[a],e,i,s);return}n.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer(),s)}function om(n,t,e,i,s,r){const o=t.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const h=$u[o[a].getType()];h(n,o[a],e,i,s,r)}}function am(n,t,e,i,s){const r=e.getStroke();if(r){const a=n.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawLineString(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=n.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,s)}}function lm(n,t,e,i,s){const r=e.getStroke();if(r){const a=n.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,r),a.drawMultiLineString(t,i,s)}const o=e.getText();if(o&&o.getText()){const a=n.getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i,s)}}function hm(n,t,e,i,s){const r=e.getFill(),o=e.getStroke();if(o||r){const l=n.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawMultiPolygon(t,i,s)}const a=e.getText();if(a&&a.getText()){const l=n.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i,s)}}function cm(n,t,e,i,s,r){const o=e.getImage(),a=e.getText(),l=a&&a.getText(),h=r&&o&&l?{}:void 0;if(o){if(o.getImageState()!=ot.LOADED)return;const c=n.getBuilder(e.getZIndex(),"Image");c.setImageStyle(o,h),c.drawPoint(t,i,s)}if(l){const c=n.getBuilder(e.getZIndex(),"Text");c.setTextStyle(a,h),c.drawText(t,i,s)}}function um(n,t,e,i,s,r){const o=e.getImage(),a=o&&o.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=r&&a&&h?{}:void 0;if(a){if(o.getImageState()!=ot.LOADED)return;const d=n.getBuilder(e.getZIndex(),"Image");d.setImageStyle(o,c),d.drawMultiPoint(t,i,s)}if(h){const d=n.getBuilder(e.getZIndex(),"Text");d.setTextStyle(l,c),d.drawText(t,i,s)}}function dm(n,t,e,i,s){const r=e.getFill(),o=e.getStroke();if(r||o){const l=n.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,o),l.drawPolygon(t,i,s)}const a=e.getText();if(a&&a.getText()){const l=n.getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i,s)}}let fm=!1;function gm(n,t,e,i,s,r,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(e,i,s):n,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=fm,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();try{let c;h=="text"||h=="json"?c=a.responseText:h=="xml"?c=a.responseXML||a.responseText:h=="arraybuffer"&&(c=a.response),c?r(t.readFeatures(c,{extent:e,featureProjection:s}),t.readProjection(c)):o()}catch{o()}}else o()},a.onerror=o,a.send()}function Nh(n,t){return function(e,i,s,r,o){gm(n,t,e,i,s,(a,l)=>{this.addFeatures(a),r!==void 0&&r(a)},()=>{this.changed(),o!==void 0&&o()})}}function mm(n,t){return[[-1/0,-1/0,1/0,1/0]]}function Xu(n,t,e,i){const s=[];let r=$e();for(let o=0,a=e.length;o<a;++o){const l=e[o];r=El(n,t,l[0],i),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=l[l.length-1]}return s}class fr extends xu{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(wt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,i=t.length;e<i;++e)this.changeEventsKeys_.push(ut(t[e],st.CHANGE,this.changed,this))}clone(){const t=new fr(ma(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<kn(this.getExtent(),t,e))return s;const r=this.geometries_;for(let o=0,a=r.length;o<a;++o)s=r[o].closestPointXY(t,e,i,s);return s}containsXY(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)if(i[s].containsXY(t,e))return!0;return!1}computeExtent(t){Cs(t);const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)iu(t,e[i].getExtent());return t}getGeometries(){return ma(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let s=!1;for(let r=0,o=i.length;r<o;++r){const a=i[r],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(s=!0)}return s?new fr(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].rotate(t,e);this.changed()}scale(t,e,i){i||(i=cn(this.getExtent()));const s=this.geometries_;for(let r=0,o=s.length;r<o;++r)s[r].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(ma(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,s=e.length;i<s;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let s=0,r=i.length;s<r;++s)i[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function ma(n){return n.map(t=>t.clone())}class ws extends Nn{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const s=t,r=[],o=[];for(let l=0,h=s.length;l<h;++l){const c=s[l];di(r,c.getFlatCoordinates()),o.push(r.length)}const a=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(a,r),this.ends_=o}}appendLineString(t){di(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ws(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<kn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ll(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Pl(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,s))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,Rg(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return ar(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new un(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,s=[];let r=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new un(t.slice(r,l),i);s.push(h),r=l}return s}getLength(){const t=this.ends_;let e=0,i=0;for(let s=0,r=t.length;s<r;++s)i+=Nl(this.flatCoordinates,e,t[s],this.stride),e=t[s];return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const s=this.ends_,r=this.stride;for(let o=0,a=s.length;o<a;++o){const l=s[o],h=mo(e,i,l,r,.5);di(t,h),i=l}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Su(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new ws(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return Sg(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Cr(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class Zo extends Nn{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){di(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new Zo(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<kn(this.getExtent(),t,e))return s;const r=this.flatCoordinates,o=this.stride;for(let a=0,l=r.length;a<l;a+=o){const h=Ln(t,e,r[a],r[a+1]);if(h<s){s=h;for(let c=0;c<o;++c)i[c]=r[a+c];i.length=o}}return s}getCoordinates(){return on(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Mi(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,s=[];for(let r=0,o=t.length;r<o;r+=i){const a=new Mi(t.slice(r,r+i),e);s.push(a)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let s=0,r=e.length;s<r;s+=i){const o=e[s],a=e[s+1];if(xl(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Uo(this.flatCoordinates,0,t,this.stride),this.changed()}}class Ss extends Nn{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const s=t,r=[],o=[];for(let a=0,l=s.length;a<l;++a){const h=s[a],c=r.length,d=h.getEnds();for(let m=0,y=d.length;m<y;++m)d[m]+=c;di(r,h.getFlatCoordinates()),o.push(d)}e=s.length===0?this.getLayout():s[0].getLayout(),t=r,i=o}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;di(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,r=e.length;s<r;++s)e[s]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const i=new Ss(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,s){return s<kn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pg(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_g(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return wg(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return mg(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),ja(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Ya(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Xu(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Cu(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Zo(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Iu(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=ja(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Eg(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new Ss(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const r=this.endss_[t-1];e=r[r.length-1]}const i=this.endss_[t].slice(),s=i[i.length-1];if(e!==0)for(let r=0,o=i.length;r<o;++r)i[r]-=e;return new gi(this.flatCoordinates.slice(e,s),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[];let r=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(r!==0)for(let d=0,m=l.length;d<m;++d)l[d]-=r;const c=new gi(e.slice(r,h),t,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return Cg(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=wu(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const Gh=Ze();class Re{constructor(t,e,i,s,r,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?eu(this.flatCoordinates_):El(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=cn(this.getExtent());this.flatInteriorPoints_=Fl(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=Tg(this.flatCoordinates_,this.ends_),e=Xu(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=Cu(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=mo(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const i=this.ends_;for(let s=0,r=i.length;s<r;++s){const o=i[s],a=mo(t,e,o,2,.5);di(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=kt(t);const e=t.getExtent(),i=t.getWorldExtent();if(e&&i){const s=re(i)/re(e);Di(Gh,i[0],i[3],s,-s,0,0,0),hn(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Gh,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var t;return new Re(this.type_,this.flatCoordinates_.slice(),(t=this.ends_)==null?void 0:t.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=Qc((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const i=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":i.length=Yo(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,i,0),s=[i.length];break;case"MultiLineString":s=[],i.length=Su(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,i,0,s);break;case"Polygon":s=[],i.length=Al(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),i,0,s);break}return s&&(this.simplifiedGeometry_=new Re(this.type_,i,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}Re.prototype.getFlatCoordinates=Re.prototype.getOrientedFlatCoordinates;function pm(n,t,e,i,s){Uu(n,t,e||0,i||n.length-1,s||_m)}function Uu(n,t,e,i,s){for(;i>e;){if(i-e>600){var r=i-e+1,o=t-e+1,a=Math.log(r),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(r-l)/r)*(o-r/2<0?-1:1),c=Math.max(e,Math.floor(t-o*l/r+h)),d=Math.min(i,Math.floor(t+(r-o)*l/r+h));Uu(n,t,c,d,s)}var m=n[t],y=e,x=i;for(As(n,e,t),s(n[i],m)>0&&As(n,e,i);y<x;){for(As(n,y,x),y++,x--;s(n[y],m)<0;)y++;for(;s(n[x],m)>0;)x--}s(n[e],m)===0?As(n,e,x):(x++,As(n,x,i)),x<=t&&(e=x+1),t<=x&&(i=x-1)}}function As(n,t,e){var i=n[t];n[t]=n[e],n[e]=i}function _m(n,t){return n<t?-1:n>t?1:0}let Yu=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Wr(t,e))return i;const s=this.toBBox,r=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?s(a):a;Wr(t,l)&&(e.leaf?i.push(a):_a(t,l)?this._all(a,i):r.push(a))}e=r.pop()}return i}collides(t){let e=this.data;if(!Wr(t,e))return!1;const i=[];for(;e;){for(let s=0;s<e.children.length;s++){const r=e.children[s],o=e.leaf?this.toBBox(r):r;if(Wr(t,o)){if(e.leaf||_a(t,o))return!0;i.push(r)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=es([]),this}remove(t,e){if(!t)return this;let i=this.data;const s=this.toBBox(t),r=[],o=[];let a,l,h;for(;i||r.length;){if(i||(i=r.pop(),l=r[r.length-1],a=o.pop(),h=!0),i.leaf){const c=ym(t,i.children,e);if(c!==-1)return i.children.splice(c,1),r.push(i),this._condense(r),this}!h&&!i.leaf&&_a(i,s)?(r.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,s){const r=i-e+1;let o=this._maxEntries,a;if(r<=o)return a=es(t.slice(e,i+1)),Kn(a,this.toBBox),a;s||(s=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,s-1))),a=es([]),a.leaf=!1,a.height=s;const l=Math.ceil(r/o),h=l*Math.ceil(Math.sqrt(o));zh(t,e,i,h,this.compareMinX);for(let c=e;c<=i;c+=h){const d=Math.min(c+h-1,i);zh(t,c,d,l,this.compareMinY);for(let m=c;m<=d;m+=l){const y=Math.min(m+l-1,d);a.children.push(this._build(t,m,y,s-1))}}return Kn(a,this.toBBox),a}_chooseSubtree(t,e,i,s){for(;s.push(e),!(e.leaf||s.length-1===i);){let r=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){const h=e.children[l],c=pa(h),d=vm(t,h)-c;d<o?(o=d,r=c<r?c:r,a=h):d===o&&c<r&&(r=c,a=h)}e=a||e.children[0]}return e}_insert(t,e,i){const s=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(s,this.data,e,r);for(o.children.push(t),Us(o,s);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(s,r,e)}_split(t,e){const i=t[e],s=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,s);const o=this._chooseSplitIndex(i,r,s),a=es(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Kn(i,this.toBBox),Kn(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)}_splitRoot(t,e){this.data=es([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Kn(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let s,r=1/0,o=1/0;for(let a=e;a<=i-e;a++){const l=Xs(t,0,a,this.toBBox),h=Xs(t,a,i,this.toBBox),c=wm(l,h),d=pa(l)+pa(h);c<r?(r=c,s=a,o=d<o?d:o):c===r&&d<o&&(o=d,s=a)}return s||i-e}_chooseSplitAxis(t,e,i){const s=t.leaf?this.compareMinX:xm,r=t.leaf?this.compareMinY:Em,o=this._allDistMargin(t,e,i,s),a=this._allDistMargin(t,e,i,r);o<a&&t.children.sort(s)}_allDistMargin(t,e,i,s){t.children.sort(s);const r=this.toBBox,o=Xs(t,0,e,r),a=Xs(t,i-e,i,r);let l=$r(o)+$r(a);for(let h=e;h<i-e;h++){const c=t.children[h];Us(o,t.leaf?r(c):c),l+=$r(o)}for(let h=i-e-1;h>=e;h--){const c=t.children[h];Us(a,t.leaf?r(c):c),l+=$r(a)}return l}_adjustParentBBoxes(t,e,i){for(let s=i;s>=0;s--)Us(e[s],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():Kn(t[e],this.toBBox)}};function ym(n,t,e){if(!e)return t.indexOf(n);for(let i=0;i<t.length;i++)if(e(n,t[i]))return i;return-1}function Kn(n,t){Xs(n,0,n.children.length,t,n)}function Xs(n,t,e,i,s){s||(s=es(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=t;r<e;r++){const o=n.children[r];Us(s,n.leaf?i(o):o)}return s}function Us(n,t){return n.minX=Math.min(n.minX,t.minX),n.minY=Math.min(n.minY,t.minY),n.maxX=Math.max(n.maxX,t.maxX),n.maxY=Math.max(n.maxY,t.maxY),n}function xm(n,t){return n.minX-t.minX}function Em(n,t){return n.minY-t.minY}function pa(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function $r(n){return n.maxX-n.minX+(n.maxY-n.minY)}function vm(n,t){return(Math.max(t.maxX,n.maxX)-Math.min(t.minX,n.minX))*(Math.max(t.maxY,n.maxY)-Math.min(t.minY,n.minY))}function wm(n,t){const e=Math.max(n.minX,t.minX),i=Math.max(n.minY,t.minY),s=Math.min(n.maxX,t.maxX),r=Math.min(n.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,r-i)}function _a(n,t){return n.minX<=t.minX&&n.minY<=t.minY&&t.maxX<=n.maxX&&t.maxY<=n.maxY}function Wr(n,t){return t.minX<=n.maxX&&t.minY<=n.maxY&&t.maxX>=n.minX&&t.maxY>=n.minY}function es(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function zh(n,t,e,i,s){const r=[t,e];for(;r.length;){if(e=r.pop(),t=r.pop(),e-t<=i)continue;const o=t+Math.ceil((e-t)/i/2)*i;pm(n,o,t,e,s),r.push(t,o,o,e)}}class $h{constructor(t){this.rbush_=new Yu(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[gt(e)]=i}load(t,e){const i=new Array(e.length);for(let s=0,r=e.length;s<r;s++){const o=t[s],a=e[s],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[s]=l,this.items_[gt(a)]=l}this.rbush_.load(i)}remove(t){const e=gt(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[gt(e)],s=[i.minX,i.minY,i.maxX,i.maxY];rr(s,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let s=0,r=t.length;s<r;s++)if(i=e(t[s]),i)return i;return i}isEmpty(){return An(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return ki(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class ju extends He{constructor(t){super(),this.projection=kt(t.projection),this.attributions_=Wh(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,s){e.viewResolver=i,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Wh(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Wh(n){return n?typeof n=="function"?n:(Array.isArray(n)||(n=[n]),t=>n):null}const Le={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Vi extends qt{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class Ku extends ju{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=sr,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(mt(this.format_,"`format` must be set when `url` is set"),this.loader_=Nh(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:mm;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new $h:null,this.loadedExtentsRtree_=new $h,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,s;Array.isArray(t.features)?s=t.features:t.features&&(i=t.features,s=i.getArray()),!e&&i===void 0&&(i=new li(s)),s!==void 0&&this.addFeaturesInternal(s),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=gt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const s=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Vi(Le.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof Re||(this.featureChangeKeys_[t]=[ut(e,st.CHANGE,this.handleFeatureChange_,this),ut(e,gs.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let i=!0;if(e.getId()!==void 0){const s=String(e.getId());if(!(s in this.idIndex_))this.idIndex_[s]=e;else if(e instanceof Re){const r=this.idIndex_[s];r instanceof Re?Array.isArray(r)?r.push(e):this.idIndex_[s]=[r,e]:i=!1}else i=!1}return i&&(mt(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],s=[];for(let r=0,o=t.length;r<o;r++){const a=t[r],l=gt(a);this.addToIndex_(l,a)&&i.push(a)}for(let r=0,o=i.length;r<o;r++){const a=i[r],l=gt(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const c=h.getExtent();e.push(c),s.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(Le.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new Vi(Le.ADDFEATURE,i[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Le.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(Le.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(ue.ADD,i=>{e||(e=!0,this.addFeature(i.element),e=!1)}),t.addEventListener(ue.REMOVE,i=>{e||(e=!0,this.removeFeature(i.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(wt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(i=>{this.removeFeatureInternal(i)});for(const i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Vi(Le.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(s){const r=s.getGeometry();if(r instanceof Re||r.intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){const s=i.getGeometry();if(s instanceof Re||s.intersectsExtent(t)){const r=e(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),An(this.nullGeometryFeatures_)||di(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=au(t,e);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],s=t[1];let r=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||nr,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),d=a;if(a=c instanceof Re?0:c.closestPointXY(i,s,o,a),a<d){r=h;const m=Math.sqrt(a);l[0]=i-m,l[1]=s-m,l[2]=i+m,l[3]=s+m}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=gt(e),s=e.getGeometry();if(!s)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const o=s.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const r=e.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new Vi(Le.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:gt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&An(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const s=this.loadedExtentsRtree_,r=this.strategy_(t,e,i);for(let o=0,a=r.length;o<a;++o){const l=r[o];s.forEachInExtent(l,function(c){return os(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Vi(Le.FEATURESLOADSTART)),this.loader_.call(this,l,e,i,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new Vi(Le.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Vi(Le.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,i=e.forEachInExtent(t,function(s){if(rr(s.extent,t))return s});i&&e.remove(i)}removeFeatures(t){let e=!1;for(let i=0,s=t.length;i<s;++i)e=this.removeFeatureInternal(t[i])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=gt(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);const i=this.featureChangeKeys_[e];i==null||i.forEach(wt),delete this.featureChangeKeys_[e];const s=t.getId();if(s!==void 0){const r=s.toString(),o=this.idIndex_[r];o===t?delete this.idIndex_[r]:Array.isArray(o)&&(o.splice(o.indexOf(t),1),o.length===1&&(this.idIndex_[r]=o[0]))}return delete this.uidIndex_[e],this.hasListener(Le.REMOVEFEATURE)&&this.dispatchEvent(new Vi(Le.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){mt(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Nh(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}class fi{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new fi({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=Wl(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===ot.IDLE&&e.load(),e.getImageState()===ot.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?gt(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:xs(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class Oi{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new Oi({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}function Bh(n){return n[0]>0&&n[1]>0}function Sm(n,t,e){return e===void 0&&(e=[0,0]),e[0]=n[0]*t+.5|0,e[1]=n[1]*t+.5|0,e}function pe(n,t){return Array.isArray(n)?n:(t===void 0?t=[n,n]:(t[0]=n,t[1]=n),t)}class Vo{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=pe(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Vo({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return tt()}getImage(t){return tt()}getHitDetectionImage(){return tt()}getPixelRatio(t){return 1}getImageState(){return tt()}getImageSize(){return tt()}getOrigin(){return tt()}getSize(){return tt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=pe(t)}listenImageChange(t){tt()}load(){tt()}unlistenImageChange(t){tt()}ready(){return Promise.resolve()}}class qo extends Vo{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?ot.LOADING:ot.LOADED,this.imageState_===ot.LOADING&&this.ready().then(()=>this.imageState_=ot.LOADED),this.render()}clone(){const t=this.getScale(),e=new qo({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){var r,o;const e=(r=this.fill_)==null?void 0:r.getKey(),i=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let s=(o=Ge.get(i,null,null))==null?void 0:o.getImage(1);if(!s){const a=this.renderOptions_,l=Math.ceil(a.size*t),h=Xt(l,l);this.draw_(a,h,t),s=h.canvas,Ge.set(i,null,null,new ku(s,void 0,null,ot.LOADED,null))}return s}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const G=s;s=r,r=G}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=r*Math.sin(a),h=Math.sqrt(r*r-l*l),c=s-h,d=Math.sqrt(l*l+c*c),m=d/l;if(t==="miter"&&m<=i)return m*e;const y=e/2/m,x=e/2*(c/d),I=Math.sqrt((s+y)*(s+y)+x*x)-s;if(this.radius2_===void 0||t==="bevel")return I*2;const M=s*Math.sin(a),v=Math.sqrt(s*s-M*M),A=r-v,O=Math.sqrt(M*M+A*A)/M;if(O<=i){const G=O*e/2-r-s;return 2*Math.max(I,G)}return I*2}createRenderOptions(){let t=Es,e=vs,i=0,s=null,r=0,o,a=0;this.stroke_&&(o=hi(this.stroke_.getColor()??cr),a=this.stroke_.getWidth()??dr,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??vs,t=this.stroke_.getLineCap()??Es,i=this.stroke_.getMiterLimit()??hr);const l=this.calculateLineJoinSize_(e,a,i),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:o,strokeWidth:a,size:c,lineCap:t,lineDash:s,lineDashOffset:r,lineJoin:e,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s=de),e.fillStyle=hi(s),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let i=this.fill_.getColor(),s=0;typeof i=="string"&&(i=xs(i)),i===null?s=1:Array.isArray(i)&&(s=i.length===4?i[3]:1),s===0&&(e=Xt(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const i=this.radius;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const s=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=r+a*o,h=a%2===0?i:s;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=de,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class Ho extends qo{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new Ho({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class Ve{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Xh,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Ve({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Xh,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Cm(n){let t;if(typeof n=="function")t=n;else{let e;Array.isArray(n)?e=n:(mt(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[n]),t=function(){return e}}return t}let ya=null;function Zu(n,t){if(!ya){const e=new fi({color:"rgba(255,255,255,0.4)"}),i=new Oi({color:"#3399CC",width:1.25});ya=[new Ve({image:new Ho({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return ya}function Xh(n){return n.getGeometry()}const bm="#333";class Jo{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=pe(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new fi({color:bm}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Jo({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=pe(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const te={ANIMATING:0,INTERACTING:1},H={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Br=[H.FILL],an=[H.STROKE],Tn=[H.BEGIN_PATH],Uh=[H.CLOSE_PATH];class Tr extends Du{constructor(t,e,i,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let a=0,l=t.length;a<l;a+=e)s[0]=t[a],s[1]=t[a+1],ms(i,s)&&(r[o++]=s[0],r[o++]=s[1]);return o}appendFlatLineCoordinates(t,e,i,s,r,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=s);let c=t[e],d=t[e+1];const m=this.tmpCoordinate_;let y=!0,x,R,I;for(x=e+s;x<i;x+=s)m[0]=t[x],m[1]=t[x+1],I=Na(h,m),I!==R?(y&&(a[l++]=c,a[l++]=d,y=!1),a[l++]=m[0],a[l++]=m[1]):I===Ut.INTERSECTING?(a[l++]=m[0],a[l++]=m[1],y=!1):y=!0,c=m[0],d=m[1],R=I;return(r&&y||x===e+s)&&(a[l++]=c,a[l++]=d),l}drawCustomCoordinates_(t,e,i,s,r){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(t,e,l,s,!1,!1);r.push(h),e=l}return e}drawCustom(t,e,i,s,r){this.beginGeometry(t,e,r);const o=t.getType(),a=t.getStride(),l=this.coordinates.length;let h,c,d,m,y;switch(o){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),m=[];const x=t.getEndss();y=0;for(let R=0,I=x.length;R<I;++R){const M=[];y=this.drawCustomCoordinates_(h,y,x[R],a,M),m.push(M)}this.instructions.push([H.CUSTOM,l,m,t,i,Ya,r]),this.hitDetectionInstructions.push([H.CUSTOM,l,m,t,s||i,Ya,r]);break;case"Polygon":case"MultiLineString":d=[],h=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),y=this.drawCustomCoordinates_(h,0,t.getEnds(),a,d),this.instructions.push([H.CUSTOM,l,d,t,i,ar,r]),this.hitDetectionInstructions.push([H.CUSTOM,l,d,t,s||i,ar,r]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,a,!1,!1),this.instructions.push([H.CUSTOM,l,c,t,i,on,r]),this.hitDetectionInstructions.push([H.CUSTOM,l,c,t,s||i,on,r]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,a),c>l&&(this.instructions.push([H.CUSTOM,l,c,t,i,on,r]),this.hitDetectionInstructions.push([H.CUSTOM,l,c,t,s||i,on,r]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([H.CUSTOM,l,c,t,i,void 0,r]),this.hitDetectionInstructions.push([H.CUSTOM,l,c,t,s||i,void 0,r]);break}this.endGeometry(e)}beginGeometry(t,e,i){this.beginGeometryInstruction1_=[H.BEGIN_GEOMETRY,e,0,t,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[H.BEGIN_GEOMETRY,e,0,t,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let s,r,o=-1;for(e=0;e<i;++e)s=t[e],r=s[0],r==H.END_GEOMETRY?o=e:r==H.BEGIN_GEOMETRY&&(s[2]=e,ff(this.hitDetectionInstructions,o,e),o=-1)}fillStyleToState(t,e={}){if(t){const i=t.getColor();e.fillPatternScale=i&&typeof i=="object"&&"src"in i?this.pixelRatio:1,e.fillStyle=hi(i||de)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const i=t.getColor();e.strokeStyle=hi(i||cr);const s=t.getLineCap();e.lineCap=s!==void 0?s:Es;const r=t.getLineDash();e.lineDash=r?r.slice():Pi;const o=t.getLineDashOffset();e.lineDashOffset=o||Ai;const a=t.getLineJoin();e.lineJoin=a!==void 0?a:vs;const l=t.getWidth();e.lineWidth=l!==void 0?l:dr;const h=t.getMiterLimit();e.miterLimit=h!==void 0?h:hr,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const i=this.state;this.fillStyleToState(t,i),this.strokeStyleToState(e,i)}createFill(t){const e=t.fillStyle,i=[H.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(t.fillPatternScale),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[H.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,s=t.lineCap,r=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=s||r!=t.currentLineDash&&!gn(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=s,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[H.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=tu(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;yl(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Tm extends Tr{constructor(t,e,i,s){super(t,e,i,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,i){if(!this.image_||this.maxExtent&&!ms(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),r=t.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,r);this.instructions.push([H.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([H.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,i){if(!this.image_)return;this.beginGeometry(t,e,i);const s=t.getFlatCoordinates(),r=[];for(let l=0,h=s.length;l<h;l+=t.getStride())(!this.maxExtent||ms(this.maxExtent,s.slice(l,l+2)))&&r.push(s[l],s[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,2);this.instructions.push([H.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([H.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),s=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class Rm extends Tr{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinates_(t,e,i,s){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,s,!1,!1),a=[H.MOVE_TO_LINE_TO,r,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(t,e,i){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Pi,Ai],Tn);const a=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(an),this.endGeometry(e)}drawMultiLineString(t,e,i){const s=this.state,r=s.strokeStyle,o=s.lineWidth;if(r===void 0||o===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,i),this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Pi,Ai],Tn);const a=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let d=0,m=a.length;d<m;++d)c=this.drawFlatCoordinates_(l,c,a[d],h);this.hitDetectionInstructions.push(an),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(an),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(an),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Tn)}}class Yh extends Tr{constructor(t,e,i,s){super(t,e,i,s)}drawFlatCoordinatess_(t,e,i,s){const r=this.state,o=r.fillStyle!==void 0,a=r.strokeStyle!==void 0,l=i.length;this.instructions.push(Tn),this.hitDetectionInstructions.push(Tn);for(let h=0;h<l;++h){const c=i[h],d=this.coordinates.length,m=this.appendFlatLineCoordinates(t,e,c,s,!0,!a),y=[H.MOVE_TO_LINE_TO,d,m];this.instructions.push(y),this.hitDetectionInstructions.push(y),a&&(this.instructions.push(Uh),this.hitDetectionInstructions.push(Uh)),e=c}return o&&(this.instructions.push(Br),this.hitDetectionInstructions.push(Br)),a&&(this.instructions.push(an),this.hitDetectionInstructions.push(an)),e}drawCircle(t,e,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_FILL_STYLE,de]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Pi,Ai]);const a=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[H.CIRCLE,h];this.instructions.push(Tn,c),this.hitDetectionInstructions.push(Tn,c),s.fillStyle!==void 0&&(this.instructions.push(Br),this.hitDetectionInstructions.push(Br)),s.strokeStyle!==void 0&&(this.instructions.push(an),this.hitDetectionInstructions.push(an)),this.endGeometry(e)}drawPolygon(t,e,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_FILL_STYLE,de]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Pi,Ai]);const a=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,a,h),this.endGeometry(e)}drawMultiPolygon(t,e,i){const s=this.state,r=s.fillStyle,o=s.strokeStyle;if(r===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,i),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_FILL_STYLE,de]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([H.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Pi,Ai]);const a=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let d=0,m=a.length;d<m;++d)c=this.drawFlatCoordinatess_(l,c,a[d],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,s=e.length;i<s;++i)e[i]=wn(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function Im(n,t,e,i,s){const r=[];let o=e,a=0,l=t.slice(e,2);for(;a<n&&o+s<i;){const[h,c]=l.slice(-2),d=t[o+s],m=t[o+s+1],y=Math.sqrt((d-h)*(d-h)+(m-c)*(m-c));if(a+=y,a>=n){const x=(n-a+y)/y,R=Te(h,d,x),I=Te(c,m,x);l.push(R,I),r.push(l),l=[R,I],a==n&&(o+=s),a=0}else if(a<n)l.push(t[o+s],t[o+s+1]),o+=s;else{const x=y-a,R=Te(h,d,x/y),I=Te(c,m,x/y);l.push(R,I),r.push(l),l=[R,I],a=0,o+=s}}return a>0&&r.push(l),r}function Lm(n,t,e,i,s){let r=e,o=e,a=0,l=0,h=e,c,d,m,y,x,R,I,M,v,A;for(d=e;d<i;d+=s){const P=t[d],O=t[d+1];x!==void 0&&(v=P-x,A=O-R,y=Math.sqrt(v*v+A*A),I!==void 0&&(l+=m,c=Math.acos((I*v+M*A)/(m*y)),c>n&&(l>a&&(a=l,r=h,o=d),l=0,h=d-s)),m=y,I=v,M=A),x=P,R=O}return l+=y,l>a?[h,d]:[r,o]}const xo={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Mm extends Tr{constructor(t,e,i,s){super(t,e,i,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[de]={fillStyle:de},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,i){const s=this.textFillState_,r=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!s&&!r)return;const a=this.coordinates;let l=a.length;const h=t.getType();let c=null,d=t.getStride();if(o.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!ge(this.maxExtent,t.getExtent()))return;let m;if(c=t.getFlatCoordinates(),h=="LineString")m=[c.length];else if(h=="MultiLineString")m=t.getEnds();else if(h=="Polygon")m=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const I=t.getEndss();m=[];for(let M=0,v=I.length;M<v;++M)m.push(I[M][0])}this.beginGeometry(t,e,i);const y=o.repeat,x=y?void 0:o.textAlign;let R=0;for(let I=0,M=m.length;I<M;++I){let v;y?v=Im(y*this.resolution,c,R,m[I],d):v=[c.slice(R,m[I])];for(let A=0,P=v.length;A<P;++A){const O=v[A];let G=0,k=O.length;if(x==null){const f=Lm(o.maxAngle,O,0,O.length,2);G=f[0],k=f[1]}for(let f=G;f<k;f+=d)a.push(O[f],O[f+1]);const u=a.length;R=m[I],this.drawChars_(l,u),l=u}}this.endGeometry(e)}else{let m=o.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),d=2;break;case"Polygon":c=t.getFlatInteriorPoint(),o.overflow||m.push(c[2]/this.resolution),d=3;break;case"MultiPolygon":const P=t.getFlatInteriorPoints();c=[];for(let O=0,G=P.length;O<G;O+=3)o.overflow||m.push(P[O+2]/this.resolution),c.push(P[O],P[O+1]);if(c.length===0)return;d=2;break}const y=this.appendFlatPointCoordinates(c,d);if(y===l)return;if(m&&(y-l)/2!==c.length/d){let P=l/2;m=m.filter((O,G)=>{const k=a[(P+G)*2]===c[G*d]&&a[(P+G)*2+1]===c[G*d+1];return k||--P,k})}this.saveTextStates_();const x=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,R=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(t,e,i);let I=o.padding;if(I!=bn&&(o.scale[0]<0||o.scale[1]<0)){let P=o.padding[0],O=o.padding[1],G=o.padding[2],k=o.padding[3];o.scale[0]<0&&(O=-O,k=-k),o.scale[1]<0&&(P=-P,G=-G),I=[P,O,G,k]}const M=this.pixelRatio;this.instructions.push([H.DRAW_IMAGE,l,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,I==bn?bn:I.map(function(P){return P*M}),x,R,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,m]);const v=1/M,A=x?x.slice(0):null;A&&(A[1]=de),this.hitDetectionInstructions.push([H.DRAW_IMAGE,l,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[v,v],NaN,this.declutterMode_,this.declutterImageWithText_,I,A,R,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?de:this.fillKey_,this.textOffsetX_,this.textOffsetY_,m]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||ur,justify:e.justify,textBaseline:e.textBaseline||_o,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=xo[s.textBaseline],c=this.textOffsetY_*l,d=this.text_,m=i?i.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([H.DRAW_CHARS,t,e,h,s.overflow,a,s.maxAngle,l,c,r,m*l,d,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([H.DRAW_CHARS,t,e,h,s.overflow,a&&de,s.maxAngle,l,c,r,m*l,d,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let i,s,r;if(!t)this.text_="";else{const o=t.getFill();o?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=hi(o.getColor()||de)):(s=null,this.textFillState_=s);const a=t.getStroke();if(!a)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const R=a.getLineDash(),I=a.getLineDashOffset(),M=a.getWidth(),v=a.getMiterLimit();r.lineCap=a.getLineCap()||Es,r.lineDash=R?R.slice():Pi,r.lineDashOffset=I===void 0?Ai:I,r.lineJoin=a.getLineJoin()||vs,r.lineWidth=M===void 0?dr:M,r.miterLimit=v===void 0?hr:v,r.strokeStyle=hi(a.getColor()||cr)}i=this.textState_;const l=t.getFont()||Gu;qg(l);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.repeat=t.getRepeat(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||_o,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||bn,i.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),d=t.getOffsetY(),m=t.getRotateWithView(),y=t.getKeepUpright(),x=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=d===void 0?0:d,this.textRotateWithView_=m===void 0?!1:m,this.textKeepUpright_=y===void 0?!0:y,this.textRotation_=x===void 0?0:x,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:gt(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+gt(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Pm={Circle:Yh,Default:Tr,Image:Tm,LineString:Rm,Polygon:Yh,Text:Mm};class Am{constructor(t,e,i,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const s in i){const r=i[s].finish();t[e][s]=r}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[i];s===void 0&&(s={},this.buildersByZIndex_[i]=s);let r=s[e];if(r===void 0){const o=Pm[e];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=r}return r}}function Om(n,t,e,i,s,r,o,a,l,h,c,d,m=!0){let y=n[t],x=n[t+1],R=0,I=0,M=0,v=0;function A(){R=y,I=x,t+=i,y=n[t],x=n[t+1],v+=M,M=Math.sqrt((y-R)*(y-R)+(x-I)*(x-I))}do A();while(t<e-i&&v+M<r);let P=M===0?0:(r-v)/M;const O=Te(R,y,P),G=Te(I,x,P),k=t-i,u=v,f=r+a*l(h,s,c);for(;t<e-i&&v+M<f;)A();P=M===0?0:(f-v)/M;const g=Te(R,y,P),E=Te(I,x,P);let p=!1;if(m)if(d){const T=[O,G,g,E];yu(T,0,4,2,d,T,T),p=T[0]>T[2]}else p=O>g;const S=Math.PI,C=[],_=k+i===t;t=k,M=0,v=u,y=n[t],x=n[t+1];let w;if(_){A(),w=Math.atan2(x-I,y-R),p&&(w+=w>0?-S:S);const T=(g+O)/2,b=(E+G)/2;return C[0]=[T,b,(f-r)/2,w,s],C}s=s.replace(/\n/g," ");for(let T=0,b=s.length;T<b;){A();let L=Math.atan2(x-I,y-R);if(p&&(L+=L>0?-S:S),w!==void 0){let B=L-w;if(B+=B>S?-2*S:B<-S?2*S:0,Math.abs(B)>o)return null}w=L;const D=T;let z=0;for(;T<b;++T){const B=p?b-T-1:T,X=a*l(h,s[B],c);if(t+i<e&&v+M<r+z+X/2)break;z+=X}if(T===D)continue;const F=p?s.substring(b-D,b-T):s.substring(D,T);P=M===0?0:(r+z/2-v)/M;const U=Te(R,y,P),K=Te(I,x,P);C.push([U,K,z/2,L,F]),r+=z}return C}class Vu{constructor(){Z(this,"pushMethodArgs_",(...t)=>(this.push_(t),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(po(),{get:(t,e)=>{if(typeof po()[e]=="function")return this.push_(e),this.pushMethodArgs_},set:(t,e,i)=>(this.push_(e,i),!0)})}push_(...t){const e=this.instructions_,i=this.zIndex+this.offset_;e[i]||(e[i]=[]),e[i].push(...t)}pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let i=0,s=e.length;i<s;++i){const r=e[i];if(typeof r=="function"){r(t);continue}const o=e[++i];if(typeof t[r]=="function")t[r](...o);else{if(typeof o=="function"){t[r]=o(t);continue}t[r]=o}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const Zn=$e(),qi=[],vi=[],wi=[],Hi=[];function jh(n){return n[3].declutterBox}const Kh=new RegExp("[-----]");function xa(n,t){return t==="start"?t=Kh.test(n)?"right":"left":t==="end"&&(t=Kh.test(n)?"left":"right"),xo[t]}function Fm(n,t,e){return e>0&&n.push(`
`,""),n.push(t,""),n}function km(n,t,e){return e%2===0&&(n+=t),n}class Dm{constructor(t,e,i,s,r){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=Ze(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new Vu:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,i,s){const r=t+e+i+s;if(this.labels_[r])return this.labels_[r];const o=s?this.strokeStates[s]:null,a=i?this.fillStates[i]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],d=l.justify?xo[l.justify]:xa(Array.isArray(t)?t[0]:t,l.textAlign||ur),m=s&&o.lineWidth?o.lineWidth:0,y=Array.isArray(t)?t:String(t).split(`
`).reduce(Fm,[]),{width:x,height:R,widths:I,heights:M,lineWidths:v}=Jg(l,y),A=x+m,P=[],O=(A+2)*c[0],G=(R+m)*c[1],k={width:O<0?Math.floor(O):Math.ceil(O),height:G<0?Math.floor(G):Math.ceil(G),contextInstructions:P};(c[0]!=1||c[1]!=1)&&P.push("scale",c),s&&(P.push("strokeStyle",o.strokeStyle),P.push("lineWidth",m),P.push("lineCap",o.lineCap),P.push("lineJoin",o.lineJoin),P.push("miterLimit",o.miterLimit),P.push("setLineDash",[o.lineDash]),P.push("lineDashOffset",o.lineDashOffset)),i&&P.push("fillStyle",a.fillStyle),P.push("textBaseline","middle"),P.push("textAlign","center");const u=.5-d;let f=d*A+u*m;const g=[],E=[];let p=0,S=0,C=0,_=0,w;for(let T=0,b=y.length;T<b;T+=2){const L=y[T];if(L===`
`){S+=p,p=0,f=d*A+u*m,++_;continue}const D=y[T+1]||l.font;D!==w&&(s&&g.push("font",D),i&&E.push("font",D),w=D),p=Math.max(p,M[C]);const z=[L,f+u*I[C]+d*(I[C]-v[_]),.5*(m+p)+S];f+=I[C],s&&g.push("strokeText",z),i&&E.push("fillText",z),++C}return Array.prototype.push.apply(P,g),Array.prototype.push.apply(P,E),this.labels_[r]=k,k}replayTextBackground_(t,e,i,s,r,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,s),t.lineTo.apply(t,r),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],t.fillStyle=o[1],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,s,r,o,a,l,h,c,d,m,y,x,R,I){a*=m[0],l*=m[1];let M=i-a,v=s-l;const A=r+h>t?t-h:r,P=o+c>e?e-c:o,O=x[3]+A*m[0]+x[1],G=x[0]+P*m[1]+x[2],k=M-x[3],u=v-x[0];(R||d!==0)&&(qi[0]=k,Hi[0]=k,qi[1]=u,vi[1]=u,vi[0]=k+O,wi[0]=vi[0],wi[1]=u+G,Hi[1]=wi[1]);let f;return d!==0?(f=Di(Ze(),i,s,1,1,d,-i,-s),jt(f,qi),jt(f,vi),jt(f,wi),jt(f,Hi),ki(Math.min(qi[0],vi[0],wi[0],Hi[0]),Math.min(qi[1],vi[1],wi[1],Hi[1]),Math.max(qi[0],vi[0],wi[0],Hi[0]),Math.max(qi[1],vi[1],wi[1],Hi[1]),Zn)):ki(Math.min(k,k+O),Math.min(u,u+G),Math.max(k,k+O),Math.max(u,u+G),Zn),y&&(M=Math.round(M),v=Math.round(v)),{drawImageX:M,drawImageY:v,drawImageW:A,drawImageH:P,originX:h,originY:c,declutterBox:{minX:Zn[0],minY:Zn[1],maxX:Zn[2],maxY:Zn[3],value:I},canvasTransform:f,scale:m}}replayImageOrLabel_(t,e,i,s,r,o,a){const l=!!(o||a),h=s.declutterBox,c=a?a[2]*s.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,qi,vi,wi,Hi,o,a),Qg(t,s.canvasTransform,r,i,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const i=jt(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(i[0]%s,i[1]%s),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,s){const r=this.textStates[e],o=this.createLabel(t,e,s,i),a=this.strokeStates[i],l=this.pixelRatio,h=xa(Array.isArray(t)?t[0]:t,r.textAlign||ur),c=xo[r.textBaseline||_o],d=a&&a.lineWidth?a.lineWidth:0,m=o.width/l-2*r.scale[0],y=h*m+2*(.5-h)*d,x=c*o.height/l+2*(.5-c)*d;return{label:o,anchorX:y,anchorY:x}}execute_(t,e,i,s,r,o,a,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&gn(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=hn(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),og(this.renderedTransform_,i));let d=0;const m=s.length;let y=0,x,R,I,M,v,A,P,O,G,k,u,f,g,E=0,p=0;const S=this.coordinateCache_,C=this.viewRotation_,_=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,w={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:C},T=this.instructions!=s||this.overlaps?0:200;let b,L,D,z;for(;d<m;){const F=s[d];switch(F[0]){case H.BEGIN_GEOMETRY:b=F[1],z=F[3],b.getGeometry()?a!==void 0&&!ge(a,z.getExtent())?d=F[2]+1:++d:d=F[2],h&&(h.zIndex=F[4]);break;case H.BEGIN_PATH:E>T&&(this.fill_(t),E=0),p>T&&(t.stroke(),p=0),!E&&!p&&(t.beginPath(),v=NaN,A=NaN),++d;break;case H.CIRCLE:y=F[1];const K=c[y],B=c[y+1],X=c[y+2],q=c[y+3],St=X-K,It=q-B,Ct=Math.sqrt(St*St+It*It);t.moveTo(K+Ct,B),t.arc(K,B,Ct,0,2*Math.PI,!0),++d;break;case H.CLOSE_PATH:t.closePath(),++d;break;case H.CUSTOM:y=F[1],x=F[2];const pt=F[3],Nt=F[4],lt=F[5];w.geometry=pt,w.feature=b,d in S||(S[d]=[]);const et=S[d];lt?lt(c,y,x,2,et):(et[0]=c[y],et[1]=c[y+1],et.length=2),h&&(h.zIndex=F[6]),Nt(et,w),++d;break;case H.DRAW_IMAGE:y=F[1],x=F[2],G=F[3],R=F[4],I=F[5];let j=F[6];const _e=F[7],Je=F[8],Qe=F[9],mn=F[10];let mi=F[11];const pi=F[12];let Xi=F[13];M=F[14]||"declutter";const Gt=F[15];if(!G&&F.length>=20){k=F[19],u=F[20],f=F[21],g=F[22];const oe=this.drawLabelWithPointPlacement_(k,u,f,g);G=oe.label,F[3]=G;const Ei=F[23];R=(oe.anchorX-Ei)*this.pixelRatio,F[4]=R;const ie=F[24];I=(oe.anchorY-ie)*this.pixelRatio,F[5]=I,j=G.height,F[6]=j,Xi=G.width,F[13]=Xi}let at;F.length>25&&(at=F[25]);let Lt,V,pn;F.length>17?(Lt=F[16],V=F[17],pn=F[18]):(Lt=bn,V=null,pn=null),mn&&_?mi+=C:!mn&&!_&&(mi-=C);let ye=0;for(;y<x;y+=2){if(at&&at[ye++]<Xi/this.pixelRatio)continue;const oe=this.calculateImageOrLabelDimensions_(G.width,G.height,c[y],c[y+1],Xi,j,R,I,Je,Qe,mi,pi,r,Lt,!!V||!!pn,b),Ei=[t,e,G,oe,_e,V,pn];if(l){let ie,ae,ne;if(Gt){const Tt=x-y;if(!Gt[Tt]){Gt[Tt]={args:Ei,declutterMode:M};continue}const Kt=Gt[Tt];ie=Kt.args,ae=Kt.declutterMode,delete Gt[Tt],ne=jh(ie)}let We,Be;if(ie&&(ae!=="declutter"||!l.collides(ne))&&(We=!0),(M!=="declutter"||!l.collides(oe.declutterBox))&&(Be=!0),ae==="declutter"&&M==="declutter"){const Tt=We&&Be;We=Tt,Be=Tt}We&&(ae!=="none"&&l.insert(ne),this.replayImageOrLabel_.apply(this,ie)),Be&&(M!=="none"&&l.insert(oe.declutterBox),this.replayImageOrLabel_.apply(this,Ei))}else this.replayImageOrLabel_.apply(this,Ei)}++d;break;case H.DRAW_CHARS:const dt=F[1],xe=F[2],Ui=F[3],Yi=F[4];g=F[5];const ji=F[6],_i=F[7],Xn=F[8];f=F[9];const Ee=F[10];k=F[11],Array.isArray(k)&&(k=k.reduce(km,"")),u=F[12];const Ar=[F[13],F[13]];M=F[14]||"declutter";const ti=F[15],Un=this.textStates[u],yi=Un.font,xi=[Un.scale[0]*_i,Un.scale[1]*_i];let _n;yi in this.widths_?_n=this.widths_[yi]:(_n={},this.widths_[yi]=_n);const Yn=Nl(c,dt,xe,2),Ki=Math.abs(xi[0])*Fh(yi,k,_n);if(Yi||Ki<=Yn){const oe=this.textStates[u].textAlign,Ei=(Yn-Ki)*xa(k,oe),ie=Om(c,dt,xe,2,k,Ei,ji,Math.abs(xi[0]),Fh,yi,_n,_?0:this.viewRotation_,ti);t:if(ie){const ae=[];let ne,We,Be,Tt,Kt;if(f)for(ne=0,We=ie.length;ne<We;++ne){Kt=ie[ne],Be=Kt[4],Tt=this.createLabel(Be,u,"",f),R=Kt[2]+(xi[0]<0?-Ee:Ee),I=Ui*Tt.height+(.5-Ui)*2*Ee*xi[1]/xi[0]-Xn;const Xe=this.calculateImageOrLabelDimensions_(Tt.width,Tt.height,Kt[0],Kt[1],Tt.width,Tt.height,R,I,0,0,Kt[3],Ar,!1,bn,!1,b);if(l&&M==="declutter"&&l.collides(Xe.declutterBox))break t;ae.push([t,e,Tt,Xe,1,null,null])}if(g)for(ne=0,We=ie.length;ne<We;++ne){Kt=ie[ne],Be=Kt[4],Tt=this.createLabel(Be,u,g,""),R=Kt[2],I=Ui*Tt.height-Xn;const Xe=this.calculateImageOrLabelDimensions_(Tt.width,Tt.height,Kt[0],Kt[1],Tt.width,Tt.height,R,I,0,0,Kt[3],Ar,!1,bn,!1,b);if(l&&M==="declutter"&&l.collides(Xe.declutterBox))break t;ae.push([t,e,Tt,Xe,1,null,null])}l&&M!=="none"&&l.load(ae.map(jh));for(let Xe=0,na=ae.length;Xe<na;++Xe)this.replayImageOrLabel_.apply(this,ae[Xe])}}++d;break;case H.END_GEOMETRY:if(o!==void 0){b=F[1];const oe=o(b,z,M);if(oe)return oe}++d;break;case H.FILL:T?E++:this.fill_(t),++d;break;case H.MOVE_TO_LINE_TO:for(y=F[1],x=F[2],L=c[y],D=c[y+1],t.moveTo(L,D),v=L+.5|0,A=D+.5|0,y+=2;y<x;y+=2)L=c[y],D=c[y+1],P=L+.5|0,O=D+.5|0,(y==x-2||P!==v||O!==A)&&(t.lineTo(L,D),v=P,A=O);++d;break;case H.SET_FILL_STYLE:this.alignAndScaleFill_=F[2],E&&(this.fill_(t),E=0,p&&(t.stroke(),p=0)),t.fillStyle=F[1],++d;break;case H.SET_STROKE_STYLE:p&&(t.stroke(),p=0),this.setStrokeStyle_(t,F),++d;break;case H.STROKE:T?p++:t.stroke(),++d;break;default:++d;break}}E&&this.fill_(t),p&&t.stroke()}execute(t,e,i,s,r,o){this.viewRotation_=s,this.execute_(t,e,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(t,e,i,s,r){return this.viewRotation_=i,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,r)}}const ls=["Polygon","Circle","LineString","Image","Text","Default"],qu=["Image","Text"],Nm=ls.filter(n=>!qu.includes(n));class Gm{constructor(t,e,i,s,r,o,a){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Ze(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,a)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t,e){for(const i in t){let s=this.executorsByZIndex_[i];s===void 0&&(s={},this.executorsByZIndex_[i]=s);const r=t[i];for(const o in r){const a=r[o];s[o]=new Dm(this.resolution_,this.pixelRatio_,this.overlaps_,a,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let s=0,r=t.length;s<r;++s)if(t[s]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,s,r,o){s=Math.round(s);const a=s*2+1,l=Di(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Xt(a,a));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):h||c.clearRect(0,0,a,a);let d;this.renderBuffer_!==void 0&&(d=$e(),Qs(d,t),yl(d,e*(this.renderBuffer_+s),d));const m=zm(s);let y;function x(O,G,k){const u=c.getImageData(0,0,a,a).data;for(let f=0,g=m.length;f<g;f++)if(u[m[f]]>0){if(!o||k==="none"||y!=="Image"&&y!=="Text"||o.includes(O)){const E=(m[f]-3)/4,p=s-E%a,S=s-(E/a|0),C=r(O,G,p*p+S*S);if(C)return C}c.clearRect(0,0,a,a);break}}const R=Object.keys(this.executorsByZIndex_).map(Number);R.sort(Li);let I,M,v,A,P;for(I=R.length-1;I>=0;--I){const O=R[I].toString();for(v=this.executorsByZIndex_[O],M=ls.length-1;M>=0;--M)if(y=ls[M],A=v[y],A!==void 0&&(P=A.executeHitDetection(c,l,i,x,d),P))return P}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],s=e[1],r=e[2],o=e[3],a=[i,s,i,o,r,o,r,s];return hn(a,0,8,2,t,a),a}isEmpty(){return An(this.executorsByZIndex_)}execute(t,e,i,s,r,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(a?df:Li),o=o||ls;const h=ls.length;for(let c=0,d=l.length;c<d;++c){const m=l[c].toString(),y=this.executorsByZIndex_[m];for(let x=0,R=o.length;x<R;++x){const I=o[x],M=y[I];if(M!==void 0){const v=a===null?void 0:M.getZIndexContext(),A=v?v.getContext():t,P=this.maxExtent_&&I!=="Image"&&I!=="Text";if(P&&(A.save(),this.clip(A,i)),!v||I==="Text"||I==="Image"?M.execute(A,e,i,s,r,a):v.pushFunction(O=>M.execute(O,e,i,s,r,a)),P&&A.restore(),v){v.offset();const O=l[c]*h+x;this.deferredZIndexContexts_[O]||(this.deferredZIndexContexts_[O]=[]),this.deferredZIndexContexts_[O].push(v)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(Li);for(let i=0,s=e.length;i<s;++i)t[e[i]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),t[e[i]].length=0}}const Ea={};function zm(n){if(Ea[n]!==void 0)return Ea[n];const t=n*2+1,e=n*n,i=new Array(e+1);for(let r=0;r<=n;++r)for(let o=0;o<=n;++o){const a=r*r+o*o;if(a>e)break;let l=i[a];l||(l=[],i[a]=l),l.push(((n+r)*t+(n+o))*4+3),r>0&&l.push(((n-r)*t+(n+o))*4+3),o>0&&(l.push(((n+r)*t+(n-o))*4+3),r>0&&l.push(((n-r)*t+(n-o))*4+3))}const s=[];for(let r=0,o=i.length;r<o;++r)i[r]&&s.push(...i[r]);return Ea[n]=s,s}function Zh(n,t,e,i){return e!==void 0&&i!==void 0?[e/n,i/t]:e!==void 0?e/n:i!==void 0?i/t:1}class Rr extends Vo{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;let a=t.src;mt(!(a!==void 0&&o),"`image` and `src` cannot be provided at the same time"),(a===void 0||a.length===0)&&o&&(a=o.src||gt(o)),mt(a!==void 0&&a.length>0,"A defined and non-empty `src` or `image` must be provided"),mt(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=ot.IDLE:o!==void 0&&("complete"in o?o.complete?l=o.src?ot.LOADED:ot.IDLE:l=ot.LOADING:l=ot.LOADED),this.color_=t.color!==void 0?xs(t.color):null,this.iconImage_=Wl(o,a,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const d=this.getImage(1);if(d.width&&d.height)h=d.width,c=d.height;else if(d instanceof HTMLImageElement){this.initialOptions_=t;const m=()=>{if(this.unlistenImageChange(m),!this.initialOptions_)return;const y=this.iconImage_.getSize();this.setScale(Zh(y[0],y[1],t.width,t.height))};this.listenImageChange(m);return}}h!==void 0&&this.setScale(Zh(h,c,t.width,t.height))}}clone(){let t,e,i;return this.initialOptions_?(e=this.initialOptions_.width,i=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Rr({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==ot.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==ot.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(st.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(st.CHANGE,t)}ready(){return this.iconImage_.ready()}}const ri=.5;function $m(n,t,e,i,s,r,o,a,l){const h=s,c=n[0]*ri,d=n[1]*ri,m=Xt(c,d);m.imageSmoothingEnabled=!1;const y=m.canvas,x=new em(m,ri,s,null,o,a,null),R=e.length,I=Math.floor((256*256*256-1)/R),M={};for(let A=1;A<=R;++A){const P=e[A-1],O=P.getStyleFunction()||i;if(!O)continue;let G=O(P,r);if(!G)continue;Array.isArray(G)||(G=[G]);const u=(A*I).toString(16).padStart(7,"#00000");for(let f=0,g=G.length;f<g;++f){const E=G[f],p=E.getGeometryFunction()(P);if(!p||!ge(h,p.getExtent()))continue;const S=E.clone(),C=S.getFill();C&&C.setColor(u);const _=S.getStroke();_&&(_.setColor(u),_.setLineDash(null)),S.setText(void 0);const w=E.getImage();if(w){const D=w.getImageSize();if(!D)continue;const z=Xt(D[0],D[1],void 0,{alpha:!1}),F=z.canvas;z.fillStyle=u,z.fillRect(0,0,F.width,F.height),S.setImage(new Rr({img:F,anchor:w.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:w.getOrigin(),opacity:1,size:w.getSize(),scale:w.getScale(),rotation:w.getRotation(),rotateWithView:w.getRotateWithView()}))}const T=S.getZIndex()||0;let b=M[T];b||(b={},M[T]=b,b.Polygon=[],b.Circle=[],b.LineString=[],b.Point=[]);const L=p.getType();if(L==="GeometryCollection"){const D=p.getGeometriesArrayRecursive();for(let z=0,F=D.length;z<F;++z){const U=D[z];b[U.getType().replace("Multi","")].push(U,S)}}else b[L.replace("Multi","")].push(p,S)}}const v=Object.keys(M).map(Number).sort(Li);for(let A=0,P=v.length;A<P;++A){const O=M[v[A]];for(const G in O){const k=O[G];for(let u=0,f=k.length;u<f;u+=2){x.setStyle(k[u+1]);for(let g=0,E=t.length;g<E;++g)x.setTransform(t[g]),x.drawGeometry(k[u])}}}return m.getImageData(0,0,y.width,y.height)}function Wm(n,t,e){const i=[];if(e){const s=Math.floor(Math.round(n[0])*ri),r=Math.floor(Math.round(n[1])*ri),o=(At(s,0,e.width-1)+At(r,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],c=e.data[o+2]+256*(l+256*a),d=Math.floor((256*256*256-1)/t.length);c&&c%d===0&&i.push(t[c/d-1])}return i}class Hu extends qt{constructor(t,e,i,s){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=s}}const Bm=5;class Xm extends vr{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=Bm}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return tt()}getData(t){return null}prepareFrame(t){return tt()}renderFrame(t,e){return tt()}forEachFeatureAtCoordinate(t,e,i,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===ot.LOADED||e.getState()===ot.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=ot.LOADED&&e!=ot.ERROR&&t.addEventListener(st.CHANGE,this.boundHandleImageChange_),e==ot.IDLE&&(t.load(),e=t.getState()),e==ot.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const Vh=[];let is=null;function Um(){is=Xt(1,1,void 0,{willReadFrequently:!0})}class Ju extends Xm{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Ze(),this.pixelTransform=Ze(),this.inversePixelTransform=Ze(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,i){is||Um(),is.clearRect(0,0,1,1);let s;try{is.drawImage(t,e,i,1,1,0,0,1,1),s=is.getImageData(0,0,1,1).data}catch{return is=null,null}return s}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const s=this.getLayer().getClassName();let r,o;if(t&&t.className===s&&(!i||t&&t.style.backgroundColor&&gn(xs(t.style.backgroundColor),xs(i)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&cg(o.canvas.style.transform,e)?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let a=r.style;a.position="absolute",a.width="100%",a.height="100%",o=Xt();const l=o.canvas;r.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const s=Dn(i),r=zo(i),o=Go(i),a=No(i);jt(e.coordinateToPixelTransform,s),jt(e.coordinateToPixelTransform,r),jt(e.coordinateToPixelTransform,o),jt(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;jt(l,s),jt(l,r),jt(l,o),jt(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}prepareContainer(t,e){const i=t.extent,s=t.viewState.resolution,r=t.viewState.rotation,o=t.pixelRatio,a=Math.round(Et(i)/s*o),l=Math.round(re(i)/s*o);Di(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/o,1/o,r,-a/2,-l/2),_u(this.inversePixelTransform,this.pixelTransform);const h=hg(this.pixelTransform);if(this.useContainer(e,h,this.getBackground(t)),!this.containerReused){const c=this.context.canvas;c.width!=a||c.height!=l?(c.width=a,c.height=l):this.context.clearRect(0,0,a,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(t,e,i){const s=this.getLayer();if(s.hasListener(t)){const r=new Hu(t,this.inversePixelTransform,i,e);s.dispatchEvent(r)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(Ne.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(Ne.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Vu),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Ne.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Ne.POSTRENDER,this.context,t))}getRenderTransform(t,e,i,s,r,o,a){const l=r/2,h=o/2,c=s/e,d=-c,m=-t[0]+a,y=-t[1];return Di(this.tempTransform,l,h,c,d,-i,m,y)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class Ym extends Ju{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=$e(),this.wrappedRenderedExtent_=$e(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,i){const s=e.extent,r=e.viewState,o=r.center,a=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),d=this.getLayer().getSource(),m=this.getLayer().getDeclutter(),y=e.pixelRatio,x=e.viewHints,R=!(x[te.ANIMATING]||x[te.INTERACTING]),I=this.context,M=Math.round(Et(s)/a*y),v=Math.round(re(s)/a*y),A=d.getWrapX()&&l.canWrapX(),P=A?Et(c):null,O=A?Math.ceil((s[2]-c[2])/P)+1:1;let G=A?Math.floor((s[0]-c[0])/P):0;do{let k=this.getRenderTransform(o,a,0,y,M,v,G*P);e.declutter&&(k=k.slice(0)),t.execute(I,[I.canvas.width,I.canvas.height],k,h,R,i===void 0?ls:i?qu:Nm,i?m&&e.declutter[m]:void 0)}while(++G<O)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Xt(this.context.canvas.width,this.context.canvas.height,Vh))}resetDrawContext_(){if(this.opacity_!==1){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Ko(this.context),Vh.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex];this.opacity_=i.opacity;const s=t.viewState;this.prepareContainer(t,e);const r=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!(this.getLayer().hasListener(Ne.PRERENDER)||this.getLayer().hasListener(Ne.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(r,t),s.projection,this.clipped_=!1,a&&i.extent&&this.clipping){const l=rn(i.extent);a=ge(l,t.extent),this.clipped_=a&&!os(l,t.extent),this.clipped_&&this.clipUnrotated(r,t,l)}return a&&this.renderWorlds(o,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&r.restore(),this.postRender(r,t),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),s=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],d=i[0]*ri,m=i[1]*ri;c.push(this.getRenderTransform(s,r,o,ri,d,m,0).slice());const y=h.getSource(),x=a.getExtent();if(y.getWrapX()&&a.canWrapX()&&!os(x,l)){let R=l[0];const I=Et(x);let M=0,v;for(;R<x[0];)--M,v=I*M,c.push(this.getRenderTransform(s,r,o,ri,d,m,v).slice()),R+=I;for(M=0,R=l[2];R>x[2];)++M,v=I*M,c.push(this.getRenderTransform(s,r,o,ri,d,m,v).slice()),R-=I}this.hitDetectionImageData_=$m(i,c,this.renderedFeatures_,h.getStyleFunction(),l,r,o,kh(r,this.renderedPixelRatio_))}e(Wm(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,i,s,r){var m,y;if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},c=function(x,R,I){const M=gt(x),v=h[M];if(v){if(v!==!0&&I<v.distanceSq){if(I===0)return h[M]=!0,r.splice(r.lastIndexOf(v),1),s(x,l,R);v.geometry=R,v.distanceSq=I}}else{if(I===0)return h[M]=!0,s(x,l,R);r.push(h[M]={feature:x,layer:l,geometry:R,distanceSq:I,callback:s})}},d=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,o,a,i,c,d?(y=(m=e.declutter)==null?void 0:m[d])==null?void 0:y.all().map(x=>x.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const s=t.viewHints[te.ANIMATING],r=t.viewHints[te.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&s||!a&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,d=h.resolution,m=t.pixelRatio,y=e.getRevision(),x=e.getRenderBuffer();let R=e.getRenderOrder();R===void 0&&(R=nm);const I=h.center.slice(),M=yl(l,x*d),v=M.slice(),A=[M.slice()],P=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!os(P,t.extent)){const C=Et(P),_=Math.max(Et(M)/2,C);M[0]=P[0]-_,M[2]=P[2]+_,hu(I,c);const w=ou(A[0],c);w[0]<P[0]&&w[2]<P[2]?A.push([w[0]+C,w[1],w[2]+C,w[3]]):w[0]>P[0]&&w[2]>P[2]&&A.push([w[0]-C,w[1],w[2]-C,w[3]])}if(this.ready&&this.renderedResolution_==d&&this.renderedRevision_==y&&this.renderedRenderOrder_==R&&this.renderedFrameDeclutter_===!!t.declutter&&os(this.wrappedRenderedExtent_,M))return gn(this.renderedExtent_,v)||(this.hitDetectionImageData_=null,this.renderedExtent_=v),this.renderedCenter_=I,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const O=new Am(Wu(d,m),M,d,m);let G;for(let C=0,_=A.length;C<_;++C)i.loadFeatures(A[C],d,c);const k=kh(d,m);let u=!0;const f=(C,_)=>{let w;const T=C.getStyleFunction()||e.getStyleFunction();if(T&&(w=T(C,d)),w){const b=this.renderFeature(C,k,w,O,G,this.getLayer().getDeclutter(),_);u=u&&!b}},g=pu(M),E=i.getFeaturesInExtent(g);R&&E.sort(R);for(let C=0,_=E.length;C<_;++C)f(E[C],C);this.renderedFeatures_=E,this.ready=u;const p=O.finish(),S=new Gm(M,d,m,i.getOverlaps(),p,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=d,this.renderedRevision_=y,this.renderedRenderOrder_=R,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=v,this.wrappedRenderedExtent_=M,this.renderedCenter_=I,this.renderedProjection_=c,this.renderedPixelRatio_=m,this.replayGroup_=S,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,s,r,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,c=i.length;h<c;++h)l=Dh(s,t,i[h],e,this.boundHandleStyleImageChange_,r,o,a)||l;else l=Dh(s,t,i,e,this.boundHandleStyleImageChange_,r,o,a);return l}}let zn=0;const se=1<<zn++,ht=1<<zn++,fe=1<<zn++,Ke=1<<zn++,Fn=1<<zn++,Ys=1<<zn++,Xr=Math.pow(2,zn)-1,Xl={[se]:"boolean",[ht]:"number",[fe]:"string",[Ke]:"color",[Fn]:"number[]",[Ys]:"size"},jm=Object.keys(Xl).map(Number).sort(Li);function Km(n){return n in Xl}function js(n){const t=[];for(const e of jm)Ks(n,e)&&t.push(Xl[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Ks(n,t){return(n&t)===t}function Ji(n,t){return n===t}class Wt{constructor(t,e){if(!Km(t))throw new Error(`literal expressions must have a specific type, got ${js(t)}`);this.type=t,this.value=e}}class Zm{constructor(t,e,...i){this.type=t,this.operator=e,this.args=i}}function Qu(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Vt(n,t,e){switch(typeof n){case"boolean":{if(Ji(t,fe))return new Wt(fe,n?"true":"false");if(!Ks(t,se))throw new Error(`got a boolean, but expected ${js(t)}`);return new Wt(se,n)}case"number":{if(Ji(t,Ys))return new Wt(Ys,pe(n));if(Ji(t,se))return new Wt(se,!!n);if(Ji(t,fe))return new Wt(fe,n.toString());if(!Ks(t,ht))throw new Error(`got a number, but expected ${js(t)}`);return new Wt(ht,n)}case"string":{if(Ji(t,Ke))return new Wt(Ke,zl(n));if(Ji(t,se))return new Wt(se,!!n);if(!Ks(t,fe))throw new Error(`got a string, but expected ${js(t)}`);return new Wt(fe,n)}}if(!Array.isArray(n))throw new Error("expression must be an array or a primitive value");if(n.length===0)throw new Error("empty expression");if(typeof n[0]=="string")return r0(n,t,e);for(const i of n)if(typeof i!="number")throw new Error("expected an array of numbers");if(Ji(t,Ys)){if(n.length!==2)throw new Error(`expected an array of two values for a size, got ${n.length}`);return new Wt(Ys,n)}if(Ji(t,Ke)){if(n.length===3)return new Wt(Ke,[...n,1]);if(n.length===4)return new Wt(Ke,n);throw new Error(`expected an array of 3 or 4 values for a color, got ${n.length}`)}if(!Ks(t,Fn))throw new Error(`got an array of numbers, but expected ${js(t)}`);return new Wt(Fn,n)}const W={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Vm={[W.Get]:Q(rt(1,1/0),qh),[W.Var]:Q(rt(1,1),qm),[W.Has]:Q(rt(1,1/0),qh),[W.Id]:Q(Hm,Vn),[W.Concat]:Q(rt(2,1/0),ft(fe)),[W.GeometryType]:Q(Jm,Vn),[W.LineMetric]:Q(Vn),[W.Resolution]:Q(va,Vn),[W.Zoom]:Q(va,Vn),[W.Time]:Q(va,Vn),[W.Any]:Q(rt(2,1/0),ft(se)),[W.All]:Q(rt(2,1/0),ft(se)),[W.Not]:Q(rt(1,1),ft(se)),[W.Equal]:Q(rt(2,2),ft(Xr)),[W.NotEqual]:Q(rt(2,2),ft(Xr)),[W.GreaterThan]:Q(rt(2,2),ft(ht)),[W.GreaterThanOrEqualTo]:Q(rt(2,2),ft(ht)),[W.LessThan]:Q(rt(2,2),ft(ht)),[W.LessThanOrEqualTo]:Q(rt(2,2),ft(ht)),[W.Multiply]:Q(rt(2,1/0),Hh),[W.Coalesce]:Q(rt(2,1/0),Hh),[W.Divide]:Q(rt(2,2),ft(ht)),[W.Add]:Q(rt(2,1/0),ft(ht)),[W.Subtract]:Q(rt(2,2),ft(ht)),[W.Clamp]:Q(rt(3,3),ft(ht)),[W.Mod]:Q(rt(2,2),ft(ht)),[W.Pow]:Q(rt(2,2),ft(ht)),[W.Abs]:Q(rt(1,1),ft(ht)),[W.Floor]:Q(rt(1,1),ft(ht)),[W.Ceil]:Q(rt(1,1),ft(ht)),[W.Round]:Q(rt(1,1),ft(ht)),[W.Sin]:Q(rt(1,1),ft(ht)),[W.Cos]:Q(rt(1,1),ft(ht)),[W.Atan]:Q(rt(1,2),ft(ht)),[W.Sqrt]:Q(rt(1,1),ft(ht)),[W.Match]:Q(rt(4,1/0),Jh,t0),[W.Between]:Q(rt(3,3),ft(ht)),[W.Interpolate]:Q(rt(6,1/0),Jh,e0),[W.Case]:Q(rt(3,1/0),Qm,i0),[W.In]:Q(rt(2,2),n0),[W.Number]:Q(rt(1,1/0),ft(Xr)),[W.String]:Q(rt(1,1/0),ft(Xr)),[W.Array]:Q(rt(1,1/0),ft(ht)),[W.Color]:Q(rt(1,4),ft(ht)),[W.Band]:Q(rt(1,3),ft(ht)),[W.Palette]:Q(rt(2,2),s0),[W.ToString]:Q(rt(1,1),ft(se|ht|fe|Ke))};function qh(n,t,e){const i=n.length-1,s=new Array(i);for(let r=0;r<i;++r){const o=n[r+1];switch(typeof o){case"number":{s[r]=new Wt(ht,o);break}case"string":{s[r]=new Wt(fe,o);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${o}`)}r===0&&e.properties.add(String(o))}return s}function qm(n,t,e){const i=n[1];if(typeof i!="string")throw new Error("expected a string argument for var operation");return e.variables.add(i),[new Wt(fe,i)]}function Hm(n,t,e){e.featureId=!0}function Jm(n,t,e){e.geometryType=!0}function va(n,t,e){e.mapState=!0}function Vn(n,t,e){const i=n[0];if(n.length!==1)throw new Error(`expected no arguments for ${i} operation`);return[]}function rt(n,t){return function(e,i,s){const r=e[0],o=e.length-1;if(n===t){if(o!==n){const a=n===1?"":"s";throw new Error(`expected ${n} argument${a} for ${r}, got ${o}`)}}else if(o<n||o>t){const a=t===1/0?`${n} or more`:`${n} to ${t}`;throw new Error(`expected ${a} arguments for ${r}, got ${o}`)}}}function Hh(n,t,e){const i=n.length-1,s=new Array(i);for(let r=0;r<i;++r){const o=Vt(n[r+1],t,e);s[r]=o}return s}function ft(n){return function(t,e,i){const s=t.length-1,r=new Array(s);for(let o=0;o<s;++o){const a=Vt(t[o+1],n,i);r[o]=a}return r}}function Qm(n,t,e){const i=n[0],s=n.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${i}, got ${s} instead`)}function Jh(n,t,e){const i=n[0],s=n.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${i}, got ${s} instead`)}function t0(n,t,e){const i=n.length-1,s=fe|ht|se,r=Vt(n[1],s,e),o=Vt(n[n.length-1],t,e),a=new Array(i-2);for(let l=0;l<i-2;l+=2){try{const h=Vt(n[l+2],r.type,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=Vt(n[l+3],o.type,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[r,...a,o]}function e0(n,t,e){const i=n[1];let s;switch(i[0]){case"linear":s=1;break;case"exponential":const l=i[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);s=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(i)}`)}const r=new Wt(ht,s);let o;try{o=Vt(n[2],ht,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const a=new Array(n.length-3);for(let l=0;l<a.length;l+=2){try{const h=Vt(n[l+3],ht,e);a[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=Vt(n[l+4],t,e);a[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[r,o,...a]}function i0(n,t,e){const i=Vt(n[n.length-1],t,e),s=new Array(n.length-1);for(let r=0;r<s.length-1;r+=2){try{const o=Vt(n[r+1],se,e);s[r]=o}catch(o){throw new Error(`failed to parse argument ${r} of case expression: ${o.message}`)}try{const o=Vt(n[r+2],i.type,e);s[r+1]=o}catch(o){throw new Error(`failed to parse argument ${r+1} of case expression: ${o.message}`)}}return s[s.length-1]=i,s}function n0(n,t,e){let i=n[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof i[0]=="string"){if(i[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],s=fe}else s=ht;const r=new Array(i.length);for(let a=0;a<r.length;a++)try{const l=Vt(i[a],s,e);r[a]=l}catch(l){throw new Error(`failed to parse haystack item ${a} for "in" expression: ${l.message}`)}return[Vt(n[1],s,e),...r]}function s0(n,t,e){let i;try{i=Vt(n[1],ht,e)}catch(o){throw new Error(`failed to parse first argument in palette expression: ${o.message}`)}const s=n[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const r=new Array(s.length);for(let o=0;o<r.length;o++){let a;try{a=Vt(s[o],Ke,e)}catch(l){throw new Error(`failed to parse color at index ${o} in palette expression: ${l.message}`)}if(!(a instanceof Wt))throw new Error(`the palette color at index ${o} must be a literal value`);r[o]=a}return[i,...r]}function Q(...n){return function(t,e,i){const s=t[0];let r;for(let o=0;o<n.length;o++){const a=n[o](t,e,i);if(o==n.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");r=a}}return new Zm(e,s,...r)}}function r0(n,t,e){const i=n[0],s=Vm[i];if(!s)throw new Error(`unknown operator: ${i}`);return s(n,t,e)}function td(n){if(!n)return"";const t=n.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return td(n.getGeometries()[0]);default:return""}}function ed(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Wi(n,t,e){const i=Vt(n,t,e);return qe(i)}function qe(n,t){if(n instanceof Wt){if(n.type===Ke&&typeof n.value=="string"){const i=zl(n.value);return function(){return i}}return function(){return n.value}}const e=n.operator;switch(e){case W.Number:case W.String:case W.Coalesce:return o0(n);case W.Get:case W.Var:case W.Has:return a0(n);case W.Id:return i=>i.featureId;case W.GeometryType:return i=>i.geometryType;case W.Concat:{const i=n.args.map(s=>qe(s));return s=>"".concat(...i.map(r=>r(s).toString()))}case W.Resolution:return i=>i.resolution;case W.Any:case W.All:case W.Between:case W.In:case W.Not:return h0(n);case W.Equal:case W.NotEqual:case W.LessThan:case W.LessThanOrEqualTo:case W.GreaterThan:case W.GreaterThanOrEqualTo:return l0(n);case W.Multiply:case W.Divide:case W.Add:case W.Subtract:case W.Clamp:case W.Mod:case W.Pow:case W.Abs:case W.Floor:case W.Ceil:case W.Round:case W.Sin:case W.Cos:case W.Atan:case W.Sqrt:return c0(n);case W.Case:return u0(n);case W.Match:return d0(n);case W.Interpolate:return f0(n);case W.ToString:return g0(n);default:throw new Error(`Unsupported operator ${e}`)}}function o0(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=qe(n.args[r]);switch(e){case W.Coalesce:return r=>{for(let o=0;o<i;++o){const a=s[o](r);if(typeof a<"u"&&a!==null)return a}throw new Error("Expected one of the values to be non-null")};case W.Number:case W.String:return r=>{for(let o=0;o<i;++o){const a=s[o](r);if(typeof a===e)return a}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function a0(n,t){const i=n.args[0].value;switch(n.operator){case W.Get:return s=>{const r=n.args;let o=s.properties[i];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;o=o[c]}return o};case W.Var:return s=>s.variables[i];case W.Has:return s=>{const r=n.args;if(!(i in s.properties))return!1;let o=s.properties[i];for(let a=1,l=r.length;a<l;++a){const c=r[a].value;if(!o||!Object.hasOwn(o,c))return!1;o=o[c]}return!0};default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function l0(n,t){const e=n.operator,i=qe(n.args[0]),s=qe(n.args[1]);switch(e){case W.Equal:return r=>i(r)===s(r);case W.NotEqual:return r=>i(r)!==s(r);case W.LessThan:return r=>i(r)<s(r);case W.LessThanOrEqualTo:return r=>i(r)<=s(r);case W.GreaterThan:return r=>i(r)>s(r);case W.GreaterThanOrEqualTo:return r=>i(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${e}`)}}function h0(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=qe(n.args[r]);switch(e){case W.Any:return r=>{for(let o=0;o<i;++o)if(s[o](r))return!0;return!1};case W.All:return r=>{for(let o=0;o<i;++o)if(!s[o](r))return!1;return!0};case W.Between:return r=>{const o=s[0](r),a=s[1](r),l=s[2](r);return o>=a&&o<=l};case W.In:return r=>{const o=s[0](r);for(let a=1;a<i;++a)if(o===s[a](r))return!0;return!1};case W.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${e}`)}}function c0(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=qe(n.args[r]);switch(e){case W.Multiply:return r=>{let o=1;for(let a=0;a<i;++a)o*=s[a](r);return o};case W.Divide:return r=>s[0](r)/s[1](r);case W.Add:return r=>{let o=0;for(let a=0;a<i;++a)o+=s[a](r);return o};case W.Subtract:return r=>s[0](r)-s[1](r);case W.Clamp:return r=>{const o=s[0](r),a=s[1](r);if(o<a)return a;const l=s[2](r);return o>l?l:o};case W.Mod:return r=>s[0](r)%s[1](r);case W.Pow:return r=>Math.pow(s[0](r),s[1](r));case W.Abs:return r=>Math.abs(s[0](r));case W.Floor:return r=>Math.floor(s[0](r));case W.Ceil:return r=>Math.ceil(s[0](r));case W.Round:return r=>Math.round(s[0](r));case W.Sin:return r=>Math.sin(s[0](r));case W.Cos:return r=>Math.cos(s[0](r));case W.Atan:return i===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case W.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${e}`)}}function u0(n,t){const e=n.args.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=qe(n.args[s]);return s=>{for(let r=0;r<e-1;r+=2)if(i[r](s))return i[r+1](s);return i[e-1](s)}}function d0(n,t){const e=n.args.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=qe(n.args[s]);return s=>{const r=i[0](s);for(let o=1;o<e-1;o+=2)if(r===i[o](s))return i[o+1](s);return i[e-1](s)}}function f0(n,t){const e=n.args.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=qe(n.args[s]);return s=>{const r=i[0](s),o=i[1](s);let a,l;for(let h=2;h<e;h+=2){const c=i[h](s);let d=i[h+1](s);const m=Array.isArray(d);if(m&&(d=Wg(d)),c>=o)return h===2?d:m?m0(r,o,a,l,c,d):Zs(r,o,a,l,c,d);a=c,l=d}return l}}function g0(n,t){const e=n.operator,i=n.args.length,s=new Array(i);for(let r=0;r<i;++r)s[r]=qe(n.args[r]);switch(e){case W.ToString:return r=>{const o=s[0](r);return n.args[0].type===Ke?$l(o):o.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function Zs(n,t,e,i,s,r){const o=s-e;if(o===0)return i;const a=t-e,l=n===1?a/o:(Math.pow(n,a)-1)/(Math.pow(n,o)-1);return i+l*(r-i)}function m0(n,t,e,i,s,r){if(s-e===0)return i;const a=Ph(i),l=Ph(r);let h=l[2]-a[2];h>180?h-=360:h<-180&&(h+=360);const c=[Zs(n,t,e,a[0],s,l[0]),Zs(n,t,e,a[1],s,l[1]),a[2]+Zs(n,t,e,0,s,h),Zs(n,t,e,i[3],s,r[3])];return Bg(c)}function p0(n){return!0}function _0(n){const t=Qu(),e=y0(n,t),i=ed();return function(s,r){if(i.properties=s.getPropertiesInternal(),i.resolution=r,t.featureId){const o=s.getId();o!==void 0?i.featureId=o:i.featureId=null}return t.geometryType&&(i.geometryType=td(s.getGeometry())),e(i)}}function Qh(n){const t=Qu(),e=n.length,i=new Array(e);for(let o=0;o<e;++o)i[o]=qa(n[o],t);const s=ed(),r=new Array(e);return function(o,a){if(s.properties=o.getPropertiesInternal(),s.resolution=a,t.featureId){const h=o.getId();h!==void 0?s.featureId=h:s.featureId=null}let l=0;for(let h=0;h<e;++h){const c=i[h](s);c&&(r[l]=c,l+=1)}return r.length=l,r}}function y0(n,t){const e=n.length,i=new Array(e);for(let s=0;s<e;++s){const r=n[s],o="filter"in r?Wi(r.filter,se,t):p0;let a;if(Array.isArray(r.style)){const l=r.style.length;a=new Array(l);for(let h=0;h<l;++h)a[h]=qa(r.style[h],t)}else a=[qa(r.style,t)];i[s]={filter:o,styles:a}}return function(s){const r=[];let o=!1;for(let a=0;a<e;++a){const l=i[a].filter;if(l(s)&&!(n[a].else&&o)){o=!0;for(const h of i[a].styles){const c=h(s);c&&r.push(c)}}}return r}}function qa(n,t){const e=gr(n,"",t),i=mr(n,"",t),s=x0(n,t),r=E0(n,t),o=me(n,"z-index",t);if(!e&&!i&&!s&&!r&&!An(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const a=new Ve;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),a.setFill(c)}if(i){const c=i(l);c&&(h=!1),a.setStroke(c)}if(s){const c=s(l);c&&(h=!1),a.setText(c)}if(r){const c=r(l);c&&(h=!1),a.setImage(c)}return o&&a.setZIndex(o(l)),h?null:a}}function gr(n,t,e){let i;if(t+"fill-pattern-src"in n)i=C0(n,t+"fill-",e);else{if(n[t+"fill-color"]==="none")return r=>null;i=Ul(n,t+"fill-color",e)}if(!i)return null;const s=new fi;return function(r){const o=i(r);return o===Gl?null:(s.setColor(o),s)}}function mr(n,t,e){const i=me(n,t+"stroke-width",e),s=Ul(n,t+"stroke-color",e);if(!i&&!s)return null;const r=Ii(n,t+"stroke-line-cap",e),o=Ii(n,t+"stroke-line-join",e),a=id(n,t+"stroke-line-dash",e),l=me(n,t+"stroke-line-dash-offset",e),h=me(n,t+"stroke-miter-limit",e),c=new Oi;return function(d){if(s){const m=s(d);if(m===Gl)return null;c.setColor(m)}if(i&&c.setWidth(i(d)),r){const m=r(d);if(m!=="butt"&&m!=="round"&&m!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(m)}if(o){const m=o(d);if(m!=="bevel"&&m!=="round"&&m!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(m)}return a&&c.setLineDash(a(d)),l&&c.setLineDashOffset(l(d)),h&&c.setMiterLimit(h(d)),c}}function x0(n,t){const e="text-",i=Ii(n,e+"value",t);if(!i)return null;const s=gr(n,e,t),r=gr(n,e+"background-",t),o=mr(n,e,t),a=mr(n,e+"background-",t),l=Ii(n,e+"font",t),h=me(n,e+"max-angle",t),c=me(n,e+"offset-x",t),d=me(n,e+"offset-y",t),m=us(n,e+"overflow",t),y=Ii(n,e+"placement",t),x=me(n,e+"repeat",t),R=Qo(n,e+"scale",t),I=us(n,e+"rotate-with-view",t),M=me(n,e+"rotation",t),v=Ii(n,e+"align",t),A=Ii(n,e+"justify",t),P=Ii(n,e+"baseline",t),O=us(n,e+"keep-upright",t),G=id(n,e+"padding",t),k=ta(n,e+"declutter-mode"),u=new Jo({declutterMode:k});return function(f){if(u.setText(i(f)),s&&u.setFill(s(f)),r&&u.setBackgroundFill(r(f)),o&&u.setStroke(o(f)),a&&u.setBackgroundStroke(a(f)),l&&u.setFont(l(f)),h&&u.setMaxAngle(h(f)),c&&u.setOffsetX(c(f)),d&&u.setOffsetY(d(f)),m&&u.setOverflow(m(f)),y){const g=y(f);if(g!=="point"&&g!=="line")throw new Error("Expected point or line for text-placement");u.setPlacement(g)}if(x&&u.setRepeat(x(f)),R&&u.setScale(R(f)),I&&u.setRotateWithView(I(f)),M&&u.setRotation(M(f)),v){const g=v(f);if(g!=="left"&&g!=="center"&&g!=="right"&&g!=="end"&&g!=="start")throw new Error("Expected left, right, center, start, or end for text-align");u.setTextAlign(g)}if(A){const g=A(f);if(g!=="left"&&g!=="right"&&g!=="center")throw new Error("Expected left, right, or center for text-justify");u.setJustify(g)}if(P){const g=P(f);if(g!=="bottom"&&g!=="top"&&g!=="middle"&&g!=="alphabetic"&&g!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");u.setTextBaseline(g)}return G&&u.setPadding(G(f)),O&&u.setKeepUpright(O(f)),u}}function E0(n,t){return"icon-src"in n?v0(n,t):"shape-points"in n?w0(n,t):"circle-radius"in n?S0(n,t):null}function v0(n,t){const e="icon-",i=e+"src",s=nd(n[i],i),r=Eo(n,e+"anchor",t),o=Qo(n,e+"scale",t),a=me(n,e+"opacity",t),l=Eo(n,e+"displacement",t),h=me(n,e+"rotation",t),c=us(n,e+"rotate-with-view",t),d=ec(n,e+"anchor-origin"),m=ic(n,e+"anchor-x-units"),y=ic(n,e+"anchor-y-units"),x=I0(n,e+"color"),R=T0(n,e+"cross-origin"),I=R0(n,e+"offset"),M=ec(n,e+"offset-origin"),v=vo(n,e+"width"),A=vo(n,e+"height"),P=b0(n,e+"size"),O=ta(n,e+"declutter-mode"),G=new Rr({src:s,anchorOrigin:d,anchorXUnits:m,anchorYUnits:y,color:x,crossOrigin:R,offset:I,offsetOrigin:M,height:A,width:v,size:P,declutterMode:O});return function(k){return a&&G.setOpacity(a(k)),l&&G.setDisplacement(l(k)),h&&G.setRotation(h(k)),c&&G.setRotateWithView(c(k)),o&&G.setScale(o(k)),r&&G.setAnchor(r(k)),G}}function w0(n,t){const e="shape-",i=e+"points",s=e+"radius",r=Ha(n[i],i),o=Ha(n[s],s),a=gr(n,e,t),l=mr(n,e,t),h=Qo(n,e+"scale",t),c=Eo(n,e+"displacement",t),d=me(n,e+"rotation",t),m=us(n,e+"rotate-with-view",t),y=vo(n,e+"radius2"),x=vo(n,e+"angle"),R=ta(n,e+"declutter-mode"),I=new qo({points:r,radius:o,radius2:y,angle:x,declutterMode:R});return function(M){return a&&I.setFill(a(M)),l&&I.setStroke(l(M)),c&&I.setDisplacement(c(M)),d&&I.setRotation(d(M)),m&&I.setRotateWithView(m(M)),h&&I.setScale(h(M)),I}}function S0(n,t){const e="circle-",i=gr(n,e,t),s=mr(n,e,t),r=me(n,e+"radius",t),o=Qo(n,e+"scale",t),a=Eo(n,e+"displacement",t),l=me(n,e+"rotation",t),h=us(n,e+"rotate-with-view",t),c=ta(n,e+"declutter-mode"),d=new Ho({radius:5,declutterMode:c});return function(m){return r&&d.setRadius(r(m)),i&&d.setFill(i(m)),s&&d.setStroke(s(m)),a&&d.setDisplacement(a(m)),l&&d.setRotation(l(m)),h&&d.setRotateWithView(h(m)),o&&d.setScale(o(m)),d}}function me(n,t,e){if(!(t in n))return;const i=Wi(n[t],ht,e);return function(s){return Ha(i(s),t)}}function Ii(n,t,e){if(!(t in n))return null;const i=Wi(n[t],fe,e);return function(s){return nd(i(s),t)}}function C0(n,t,e){const i=Ii(n,t+"pattern-src",e),s=tc(n,t+"pattern-offset",e),r=tc(n,t+"pattern-size",e),o=Ul(n,t+"color",e);return function(a){return{src:i(a),offset:s&&s(a),size:r&&r(a),color:o&&o(a)}}}function us(n,t,e){if(!(t in n))return null;const i=Wi(n[t],se,e);return function(s){const r=i(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${t}`);return r}}function Ul(n,t,e){if(!(t in n))return null;const i=Wi(n[t],Ke,e);return function(s){return sd(i(s),t)}}function id(n,t,e){if(!(t in n))return null;const i=Wi(n[t],Fn,e);return function(s){return Ir(i(s),t)}}function Eo(n,t,e){if(!(t in n))return null;const i=Wi(n[t],Fn,e);return function(s){const r=Ir(i(s),t);if(r.length!==2)throw new Error(`Expected two numbers for ${t}`);return r}}function tc(n,t,e){if(!(t in n))return null;const i=Wi(n[t],Fn,e);return function(s){return rd(i(s),t)}}function Qo(n,t,e){if(!(t in n))return null;const i=Wi(n[t],Fn|ht,e);return function(s){return L0(i(s),t)}}function vo(n,t){const e=n[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function b0(n,t){const e=n[t];if(e!==void 0){if(typeof e=="number")return pe(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function T0(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function ec(n,t){const e=n[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function ic(n,t){const e=n[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function R0(n,t){const e=n[t];if(e!==void 0)return Ir(e,t)}function ta(n,t){const e=n[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function I0(n,t){const e=n[t];if(e!==void 0)return sd(e,t)}function Ir(n,t){if(!Array.isArray(n))throw new Error(`Expected an array for ${t}`);const e=n.length;for(let i=0;i<e;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${t}`);return n}function nd(n,t){if(typeof n!="string")throw new Error(`Expected a string for ${t}`);return n}function Ha(n,t){if(typeof n!="number")throw new Error(`Expected a number for ${t}`);return n}function sd(n,t){if(typeof n=="string")return n;const e=Ir(n,t),i=e.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function rd(n,t){const e=Ir(n,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function L0(n,t){return typeof n=="number"?n:rd(n,t)}const Ue={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function nc(n,t,e){return function(i,s,r,o,a){if(!i)return;if(!s&&!t)return i;const l=t?0:r[0]*s,h=t?0:r[1]*s,c=a?a[0]:0,d=a?a[1]:0;let m=n[0]+l/2+c,y=n[2]-l/2+c,x=n[1]+h/2+d,R=n[3]-h/2+d;m>y&&(m=(y+m)/2,y=m),x>R&&(x=(R+x)/2,R=x);let I=At(i[0],m,y),M=At(i[1],x,R);if(o&&e&&s){const v=30*s;I+=-v*Math.log(1+Math.max(0,m-i[0])/v)+v*Math.log(1+Math.max(0,i[0]-y)/v),M+=-v*Math.log(1+Math.max(0,x-i[1])/v)+v*Math.log(1+Math.max(0,i[1]-R)/v)}return[I,M]}}function M0(n){return n}function od(n){return Math.pow(n,3)}function bs(n){return 1-od(1-n)}function P0(n){return 3*n*n-2*n*n*n}function A0(n){return n}function Yl(n,t,e,i){const s=Et(t)/e[0],r=re(t)/e[1];return i?Math.min(n,Math.max(s,r)):Math.min(n,Math.min(s,r))}function jl(n,t,e){let i=Math.min(n,t);const s=50;return i*=Math.log(1+s*Math.max(0,n/t-1))/s+1,e&&(i=Math.max(i,e),i/=Math.log(1+s*Math.max(0,e/n-1))/s+1),At(i,e/2,t*2)}function O0(n,t,e,i){return t=t!==void 0?t:!0,function(s,r,o,a){if(s!==void 0){const l=n[0],h=n[n.length-1],c=e?Yl(l,e,o,i):l;if(a)return t?jl(s,c,h):At(s,h,c);const d=Math.min(c,s),m=Math.floor(_l(n,d,r));return n[m]>c&&m<n.length-1?n[m+1]:n[m]}}}function F0(n,t,e,i,s,r){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const c=s?Yl(t,s,l,r):t;if(h)return i?jl(o,c,e):At(o,e,c);const d=1e-9,m=Math.ceil(Math.log(t/c)/Math.log(n)-d),y=-a*(.5-d)+.5,x=Math.min(c,o),R=Math.floor(Math.log(t/x)/Math.log(n)+y),I=Math.max(m,R),M=t/Math.pow(n,I);return At(M,e,c)}}}function sc(n,t,e,i,s){return e=e!==void 0?e:!0,function(r,o,a,l){if(r!==void 0){const h=i?Yl(n,i,a,s):n;return!e||!l?At(r,t,h):jl(r,h,t)}}}function Kl(n){if(n!==void 0)return 0}function rc(n){if(n!==void 0)return n}function k0(n){const t=2*Math.PI/n;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function D0(n){const t=ln(5);return function(e,i){return i||e===void 0?e:Math.abs(e)<=t?0:e}}const N0=42,Zl=256,wa=0;class oi extends He{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Tl(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&mu(),t.center&&(t.center=bi(t.center,this.projection_)),t.extent&&(t.extent=rn(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in Ue)delete e[a];this.setProperties(e,!0);const i=z0(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const s=G0(t),r=i.constraint,o=$0(t);this.constraints_={center:s,resolution:r,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenterInternal();if(i){const s=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),o=r/2*(s[3]-e[3]+e[1]-s[1]),a=r/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let s=arguments[i];s.center&&(s=Object.assign({},s),s.center=bi(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=bi(s.anchor,this.getProjection())),e[i]=s}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const c=arguments[s];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(s===e){i&&Ur(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;s<e;++s){const c=arguments[s],d={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||P0,callback:i};if(c.center&&(d.sourceCenter=o,d.targetCenter=c.center.slice(),o=d.targetCenter),c.zoom!==void 0?(d.sourceResolution=a,d.targetResolution=this.getResolutionForZoom(c.zoom),a=d.targetResolution):c.resolution&&(d.sourceResolution=a,d.targetResolution=c.resolution,a=d.targetResolution),c.rotation!==void 0){d.sourceRotation=l;const m=Mn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;d.targetRotation=l+m,l=d.targetRotation}W0(d)?d.complete=!0:r+=d.duration,h.push(d)}this.animations_.push(h),this.setHint(te.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[te.ANIMATING]>0}getInteracting(){return this.hints_[te.INTERACTING]>0}cancelAnimations(){this.setHint(te.ANIMATING,-this.hints_[te.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const s=this.animations_[e];if(s[0].callback&&Ur(s[0].callback,!1),!t)for(let r=0,o=s.length;r<o;++r){const a=s[r];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const s=this.animations_[i];let r=!0;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const d=l.easing(c);if(l.sourceCenter){const m=l.sourceCenter[0],y=l.sourceCenter[1],x=l.targetCenter[0],R=l.targetCenter[1];this.nextCenter_=l.targetCenter;const I=m+d*(x-m),M=y+d*(R-y);this.targetCenter_=[I,M]}if(l.sourceResolution&&l.targetResolution){const m=d===1?l.targetResolution:l.sourceResolution+d*(l.targetResolution-l.sourceResolution);if(l.anchor){const y=this.getViewportSize_(this.getRotation()),x=this.constraints_.resolution(m,0,y,!0);this.targetCenter_=this.calculateCenterZoom(x,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=m,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const m=d===1?Mn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+d*(l.targetRotation-l.sourceRotation);if(l.anchor){const y=this.constraints_.rotation(m,!0);this.targetCenter_=this.calculateCenterRotate(y,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=m}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(r){this.animations_[i]=null,this.setHint(te.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=s[0].callback;o&&Ur(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const s=this.getCenterInternal();return s!==void 0&&(i=[s[0]-e[0],s[1]-e[1]],vl(i,t-this.getRotation()),If(i,e)),i}calculateCenterZoom(t,e){let i;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const o=e[0]-t*(e[0]-s[0])/r,a=e[1]-t*(e[1]-s[1])/r;i=[o,a]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],s=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Ua(t,this.getProjection())}getCenterInternal(){return this.get(Ue.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return pu(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();mt(e,"The view center is not defined");const i=this.getResolution();mt(i!==void 0,"The view resolution is not defined");const s=this.getRotation();return mt(s!==void 0,"The view rotation is not defined"),za(e,i,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Ue.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(rn(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=Et(t)/e[0],s=re(t)/e[1];return Math.max(i,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,s=Math.log(e/i)/Math.log(t);return function(r){return e/Math.pow(t,r*s)}}getRotation(){return this.get(Ue.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(i/s)/e;return function(o){return Math.log(i/o)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();s=Sa(s,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],e,i)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,s;if(this.resolutions_){const r=_l(this.resolutions_,t,1);e=r,i=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=i/this.resolutions_[r+1]}else i=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(i/t)/Math.log(s)}getResolutionForZoom(t){var e;if((e=this.resolutions_)!=null&&e.length){if(this.resolutions_.length===1)return this.resolutions_[0];const i=At(Math.floor(t),0,this.resolutions_.length-2),s=this.resolutions_[i]/this.resolutions_[i+1];return this.resolutions_[i]/Math.pow(s,At(t-i,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(mt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){mt(!wr(t),"Cannot fit empty extent provided as `geometry`");const s=rn(t,this.getProjection());i=Lh(s)}else if(t.getType()==="Circle"){const s=rn(t.getExtent(),this.getProjection());i=Lh(s),i.rotate(this.getRotation(),cn(s))}else i=t;this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),s=Math.sin(-e),r=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,c=-1/0;for(let d=0,m=r.length;d<m;d+=o){const y=r[d]*i-r[d+1]*s,x=r[d]*s+r[d+1]*i;a=Math.min(a,y),l=Math.min(l,x),h=Math.max(h,y),c=Math.max(c,x)}return[a,l,h,c]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const s=e.padding!==void 0?e.padding:[0,0,0,0],r=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[i[0]-s[1]-s[3],i[1]-s[0]-s[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),d=Math.cos(h),m=cn(a);m[0]+=(s[1]-s[3])/2*l,m[1]+=(s[0]-s[2])/2*l;const y=m[0]*d-m[1]*c,x=m[1]*d+m[0]*c,R=this.getConstrainedCenter([y,x],l),I=e.callback?e.callback:sr;e.duration!==void 0?this.animateInternal({resolution:l,center:R,duration:e.duration,easing:e.easing},I):(this.targetResolution_=l,this.targetCenter_=R,this.applyTargetState_(!1,!0),Ur(I,!0))}centerOn(t,e,i){this.centerOnInternal(bi(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(Sa(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,s){let r;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-i),l=Sa(t,s,[a[0]/2+o[3],a[1]/2+o[0]],e,i);r=[t[0]-l[0],t[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Ua(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&bi(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,s,i);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=bi(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&bi(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,0,r,i),a=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,s,r));this.get(Ue.ROTATION)!==s&&this.set(Ue.ROTATION,s),this.get(Ue.RESOLUTION)!==o&&(this.set(Ue.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Ue.CENTER)||!ho(this.get(Ue.CENTER),a))&&this.set(Ue.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const s=e||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,s,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,r,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==r||!this.getCenterInternal()||!ho(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:a,duration:t,easing:bs,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(te.INTERACTING,1)}endInteraction(t,e,i){i=i&&bi(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.getInteracting()&&(this.setHint(te.INTERACTING,-1),this.resolveConstraints(t,e,i))}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function Ur(n,t){setTimeout(function(){n(t)},0)}function G0(n){if(n.extent!==void 0){const e=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return nc(n.extent,n.constrainOnlyCenter,e)}const t=Tl(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,nc(e,!1,!1)}return M0}function z0(n){let t,e,i,o=n.minZoom!==void 0?n.minZoom:wa,a=n.maxZoom!==void 0?n.maxZoom:28;const l=n.zoomFactor!==void 0?n.zoomFactor:2,h=n.multiWorld!==void 0?n.multiWorld:!1,c=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,d=n.showFullExtent!==void 0?n.showFullExtent:!1,m=Tl(n.projection,"EPSG:3857"),y=m.getExtent();let x=n.constrainOnlyCenter,R=n.extent;if(!h&&!R&&m.isGlobal()&&(x=!1,R=y),n.resolutions!==void 0){const I=n.resolutions;e=I[o],i=I[a]!==void 0?I[a]:I[I.length-1],n.constrainResolution?t=O0(I,c,!x&&R,d):t=sc(e,i,c,!x&&R,d)}else{const M=(y?Math.max(Et(y),re(y)):360*ps.degrees/m.getMetersPerUnit())/Zl/Math.pow(2,wa),v=M/Math.pow(2,28-wa);e=n.maxResolution,e!==void 0?o=0:e=M/Math.pow(l,o),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=e/Math.pow(l,a):i=M/Math.pow(l,a):i=v),a=o+Math.floor(Math.log(e/i)/Math.log(l)),i=e/Math.pow(l,a-o),n.constrainResolution?t=F0(l,e,i,c,!x&&R,d):t=sc(e,i,c,!x&&R,d)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:o,zoomFactor:l}}function $0(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const e=n.constrainRotation;return e===void 0||e===!0?D0():e===!1?rc:typeof e=="number"?k0(e):rc}return Kl}function W0(n){return!(n.sourceCenter&&n.targetCenter&&!ho(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function Sa(n,t,e,i,s){const r=Math.cos(-s);let o=Math.sin(-s),a=n[0]*r-n[1]*o,l=n[1]*r+n[0]*o;a+=(t[0]/2-e[0])*i,l+=(e[1]-t[1]/2)*i,o=-o;const h=a*r-l*o,c=l*r+a*o;return[h,c]}const xt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class ad extends He{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[xt.OPACITY]=t.opacity!==void 0?t.opacity:1,mt(typeof e[xt.OPACITY]=="number","Layer opacity must be a number"),e[xt.VISIBLE]=t.visible!==void 0?t.visible:!0,e[xt.Z_INDEX]=t.zIndex,e[xt.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[xt.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[xt.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[xt.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=At(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return tt()}getLayerStatesArray(t){return tt()}getExtent(){return this.get(xt.EXTENT)}getMaxResolution(){return this.get(xt.MAX_RESOLUTION)}getMinResolution(){return this.get(xt.MIN_RESOLUTION)}getMinZoom(){return this.get(xt.MIN_ZOOM)}getMaxZoom(){return this.get(xt.MAX_ZOOM)}getOpacity(){return this.get(xt.OPACITY)}getSourceState(){return tt()}getVisible(){return this.get(xt.VISIBLE)}getZIndex(){return this.get(xt.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(xt.EXTENT,t)}setMaxResolution(t){this.set(xt.MAX_RESOLUTION,t)}setMinResolution(t){this.set(xt.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(xt.MAX_ZOOM,t)}setMinZoom(t){this.set(xt.MIN_ZOOM,t)}setOpacity(t){mt(typeof t=="number","Layer opacity must be a number"),this.set(xt.OPACITY,t)}setVisible(t){this.set(xt.VISIBLE,t)}setZIndex(t){this.set(xt.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class ea extends ad{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(xt.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(xt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(wt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=ut(t,st.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0)),this.clearRenderer()),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const i=this.getMapInternal();!t&&i&&(t=i.getView()),t instanceof oi?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&i&&(e.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let s;if(e.layerStatesArray){if(s=e.layerStatesArray.find(o=>o.layer===this),!s)return!1}else s=this.getLayerState();const r=this.getExtent();return Vl(s,e.viewState)&&(!r||ge(r,e.extent))}getAttributions(t){var r;if(!this.isVisible(t))return[];const e=(r=this.getSource())==null?void 0:r.getAttributions();if(!e)return[];const i=t instanceof oi?t.getViewStateAndExtent():t;let s=e(i);return Array.isArray(s)||(s=[s]),s}render(t,e){const i=this.getRenderer();return i.prepareFrame(t)?(this.rendered=!0,i.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(xt.MAP,t)}getMapInternal(){return this.get(xt.MAP)}setMap(t){this.mapPrecomposeKey_&&(wt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(wt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ut(t,Ne.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=ut(this,st.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,i=this.getLayerState(!1);mt(!e.some(s=>s.layer===i.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(i)}setSource(t){this.set(xt.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function Vl(n,t){if(!n.visible)return!1;const e=t.resolution;if(e<n.minResolution||e>=n.maxResolution)return!1;const i=t.zoom;return i>n.minZoom&&i<=n.maxZoom}const oc={RENDER_ORDER:"renderOrder"};class ld extends ea{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(oc.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const i=this.getDeclutter();i in t.declutter||(t.declutter[i]=new Yu(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(oc.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?Zu:t;const e=B0(t);this.styleFunction_=t===null?void 0:Cm(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function B0(n){if(n===void 0)return Zu;if(!n)return null;if(typeof n=="function"||n instanceof Ve)return n;if(!Array.isArray(n))return Qh([n]);if(n.length===0)return[];const t=n.length,e=n[0];if(e instanceof Ve){const s=new Array(t);for(let r=0;r<t;++r){const o=n[r];if(!(o instanceof Ve))throw new Error("Expected a list of style instances");s[r]=o}return s}if("style"in e){const s=new Array(t);for(let r=0;r<t;++r){const o=n[r];if(!("style"in o))throw new Error("Expected a list of rules with a style property");s[r]=o}return _0(s)}return Qh(n)}class hd extends ld{constructor(t){super(t)}createRenderer(){return new Ym(this)}}const J={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class ql extends Do{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(st.CHANGE)}release(){this.setState(J.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==J.EMPTY){if(this.state!==J.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){tt()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const s=e-i+1e3/60;return s>=this.transition_?1:od(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}class cd extends ql{constructor(t,e,i,s,r,o){super(t,e,o),this.crossOrigin_=s,this.src_=i,this.key=i,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=J.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=J.ERROR,this.unlistenImage_(),this.image_=X0(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=J.LOADED:this.state=J.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==J.ERROR&&(this.state=J.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==J.IDLE&&(this.state=J.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Xg(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function X0(){const n=Xt(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}class U0{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const s=this.points_[e+2]-this.points_[i+2];if(s<1e3/60)return!1;const r=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class ns extends qt{constructor(t,e,i){super(t),this.map=e,this.frameState=i!==void 0?i:null}}class nn extends ns{constructor(t,e,i,s,r,o){super(t,e,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Ft={SINGLECLICK:"singleclick",CLICK:st.CLICK,DBLCLICK:st.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Ja={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class Y0 extends Do{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=ut(i,Ja.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=ut(i,Ja.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(st.TOUCHMOVE,this.boundHandleTouchMove_,Au?{passive:!1}:!1)}emulateClick_(t){let e=new nn(Ft.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new nn(Ft.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new nn(Ft.SINGLECLICK,this.map_,t);this.dispatchEvent(i)},250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==Ft.POINTERUP||e.type==Ft.POINTERCANCEL){delete this.trackedTouches_[i];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==e.target){delete this.trackedTouches_[s];break}}else(e.type==Ft.POINTERDOWN||e.type==Ft.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new nn(Ft.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(wt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new nn(Ft.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ut(i,Ft.POINTERMOVE,this.handlePointerMove_,this),ut(i,Ft.POINTERUP,this.handlePointerUp_,this),ut(this.element_,Ft.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(ut(this.element_.getRootNode(),Ft.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new nn(Ft.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new nn(Ft.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(wt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(st.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(wt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(wt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Ri={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Qt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},wo=1/0;class j0{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Er(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(i);return delete this.queuedElements_[s],i}enqueue(t){mt(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=wo?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,s=e.length,r=e[t],o=i[t],a=t;for(;t<s>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<s&&i[h]<i[l]?h:l;e[t]=e[c],i[t]=i[c],t=c}e[t]=r,i[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const i=this.elements_,s=this.priorities_,r=i[e],o=s[e];for(;e>t;){const a=this.getParentIndex_(e);if(s[a]>o)i[e]=i[a],s[e]=s[a],e=a;else break}i[e]=r,s[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let s=0;const r=e.length;let o,a,l;for(a=0;a<r;++a)o=e[a],l=t(o),l==wo?delete this.queuedElements_[this.keyFunction_(o)]:(i[s]=l,e[s++]=o);e.length=s,i.length=s,this.heapify_()}}class K0 extends j0{constructor(t,e){super(i=>t.apply(null,i),i=>i[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(st.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===J.LOADED||i===J.ERROR||i===J.EMPTY){i!==J.ERROR&&e.removeEventListener(st.CHANGE,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;){const s=this.dequeue()[0],r=s.getKey();s.getState()===J.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++i,s.load())}}}function Z0(n,t,e,i,s){if(!n||!(e in n.wantedTiles)||!n.wantedTiles[e][t.getKey()])return wo;const r=n.viewState.center,o=i[0]-r[0],a=i[1]-r[1];return 65536*Math.log(s)+Math.sqrt(o*o+a*a)/s}class Lr extends He{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){var t;(t=this.element)==null||t.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){var e;this.map_&&((e=this.element)==null||e.remove());for(let i=0,s=this.listenerKeys.length;i<s;++i)wt(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=t,t){const i=this.target_??t.getOverlayContainerStopEvent();this.element&&i.appendChild(this.element),this.render!==sr&&this.listenerKeys.push(ut(t,Ri.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class ud extends Lr{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const e=t.className!==void 0?t.className:"ol-attribution",i=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:e+"-expand",r=t.collapseLabel!==void 0?t.collapseLabel:"",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=s):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(st.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+br+" "+Bl+(this.collapsed_&&this.collapsible_?" "+Ah:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=this.getMap().getAllLayers(),i=new Set(e.flatMap(s=>s.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>i.add(s)):i.add(this.attributions_)),!this.overrideCollapsible_){const s=!e.some(r=>{var o;return((o=r.getSource())==null?void 0:o.getAttributionsCollapsible())===!1});this.setCollapsible(s)}return Array.from(i)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(s=>mf(()=>s))),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!gn(e,this.renderedAttributions_)){Ou(this.ulElement_);for(let s=0,r=e.length;s<r;++s){const o=document.createElement("li");o.innerHTML=e[s],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Ah),this.collapsed_?Mh(this.collapseLabel_,this.label_):Mh(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class V0 extends Lr{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",i=t.label!==void 0?t.label:"",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(s));const r=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(st.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+br+" "+Bl,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(zr)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:bs}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const s="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(zr);!r&&i===0?this.element.classList.add(zr):r&&i!==0&&this.element.classList.remove(zr)}this.label_.style.transform=s}this.rotation_=i}}class dd extends Lr{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",i=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",r=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof o=="string"?document.createTextNode(o):o),c.addEventListener(st.CLICK,this.handleClick_.bind(this,i),!1);const d=document.createElement("button");d.className=r,d.setAttribute("type","button"),d.title=h,d.appendChild(typeof a=="string"?document.createTextNode(a):a),d.addEventListener(st.CLICK,this.handleClick_.bind(this,-i),!1);const m=e+" "+br+" "+Bl,y=this.element;y.className=m,y.appendChild(c),y.appendChild(d),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const s=i.getZoom();if(s!==void 0){const r=i.getConstrainedZoom(s+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:bs})):i.setZoom(r)}}}function q0(n){n=n||{};const t=new li;return(n.zoom!==void 0?n.zoom:!0)&&t.push(new dd(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&t.push(new V0(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&t.push(new ud(n.attributionOptions)),t}const ac={ACTIVE:"active"};class Mr extends He{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(ac.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(ac.ACTIVE,t)}setMap(t){this.map_=t}}function H0(n,t,e){const i=n.getCenterInternal();if(i){const s=[i[0]+t[0],i[1]+t[1]];n.animateInternal({duration:e!==void 0?e:250,easing:A0,center:n.getConstrainedCenter(s)})}}function Hl(n,t,e,i){const s=n.getZoom();if(s===void 0)return;const r=n.getConstrainedZoom(s+t),o=n.getResolutionForZoom(r);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:o,anchor:e,duration:i!==void 0?i:250,easing:bs})}class J0 extends Mr{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==Ft.DBLCLICK){const i=t.originalEvent,s=t.map,r=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=s.getView();Hl(a,o,r,this.duration_),i.preventDefault(),e=!0}return!e}}function Qa(n){const t=arguments;return function(e){let i=!0;for(let s=0,r=t.length;s<r&&(i=i&&t[s](e),!!i);++s);return i}}const Q0=function(n){const t=n.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},tp=function(n){const t=n.map.getTargetElement(),e=t.getRootNode(),i=n.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(i):t.contains(i)},fd=function(n){const t=n.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?tp(n):!0},ep=nr,gd=function(n){const t=n.originalEvent;return t instanceof PointerEvent&&t.button==0&&!(Lg&&Lu&&t.ctrlKey)},md=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},ip=function(n){const t=n.originalEvent;return Lu?t.metaKey:t.ctrlKey},np=function(n){const t=n.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},pd=function(n){const t=n.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Ca=function(n){const t=n.originalEvent;return t instanceof PointerEvent&&t.pointerType=="mouse"},sp=function(n){const t=n.originalEvent;return t instanceof PointerEvent&&t.isPrimary&&t.button===0};class Pr extends Mr{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Ft.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Ft.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==Ft.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==Ft.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Jl(n){const t=n.length;let e=0,i=0;for(let s=0;s<t;s++)e+=n[s].clientX,i+=n[s].clientY;return{clientX:e/t,clientY:i/t}}class rp extends Pr{constructor(t){super({stopDown:ko}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Qa(md,sp);this.condition_=t.onFocusOnly?Qa(fd,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const i=this.targetPointers,s=e.getEventPixel(Jl(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],a=t.map.getView();Lf(r,a.getResolution()),vl(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=i.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-s*Math.cos(r),a[1]-s*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:bs})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class op extends Pr{constructor(t){t=t||{},super({stopDown:ko}),this.condition_=t.condition?t.condition:Q0,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Ca(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===Kl)return;const s=e.getSize(),r=t.pixel,o=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return Ca(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Ca(t)&&gd(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class ap extends Fo{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+i,s.top=Math.min(t[1],e[1])+i,s.width=Math.abs(e[0]-t[0])+i,s.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,s=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new gi([s])}getGeometry(){return this.geometry_}}const qn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Os extends qt{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}class lp extends Pr{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new ap(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??gd,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const s=i[0]-e[0],r=i[1]-e[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Os(qn.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Os(e?qn.BOXEND:qn.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Os(qn.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Os(qn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new Os(qn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class hp extends lp{constructor(t){t=t||{};const e=t.condition?t.condition:np;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const i=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(s),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;s=s.clone(),s.scale(a*a)}i.fitInternal(s,{duration:this.duration_,easing:bs})}}const xn={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class cp extends Mr{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return md(e)&&pd(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==st.KEYDOWN){const i=t.originalEvent,s=i.key;if(this.condition_(t)&&(s==xn.DOWN||s==xn.LEFT||s==xn.RIGHT||s==xn.UP)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;s==xn.DOWN?h=-a:s==xn.LEFT?l=-a:s==xn.RIGHT?l=a:h=a;const c=[l,h];vl(c,o.getRotation()),H0(o,c,this.duration_),i.preventDefault(),e=!0}}return!e}}class up extends Mr{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!ip(e)&&pd(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==st.KEYDOWN||t.type==st.KEYPRESS){const i=t.originalEvent,s=i.key;if(this.condition_(t)&&(s==="+"||s==="-")){const r=t.map,o=s==="+"?this.delta_:-this.delta_,a=r.getView();Hl(a,o,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}}class dp extends Mr{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:ep;this.condition_=t.onFocusOnly?Qa(fd,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==st.WHEEL)return!0;const i=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let r;if(t.type==st.WHEEL&&(r=s.deltaY,s.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-At(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Hl(e,i,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class fp extends Pr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=ko),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-i.clientY,s.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=r;const o=t.map,a=o.getView();a.getConstraints().rotation!==Kl&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Jl(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class gp extends Pr{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=ko),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],s=this.targetPointers[1],r=i.clientX-s.clientX,o=i.clientY-s.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Jl(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const i=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function mp(n){n=n||{};const t=new li,e=new U0(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&t.push(new op),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&t.push(new J0({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&t.push(new rp({onFocusOnly:n.onFocusOnly,kinetic:e})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&t.push(new fp),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&t.push(new gp({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(t.push(new cp),t.push(new up({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&t.push(new dp({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&t.push(new hp({duration:n.zoomDuration})),t}class sn extends qt{constructor(t,e){super(t),this.layer=e}}const ba={LAYERS:"layers"};class Ts extends ad{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(ba.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new li(i.slice(),{unique:!0}):mt(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new li(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(wt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(ut(t,ue.ADD,this.handleLayersAdd_,this),ut(t,ue.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(wt);Er(this.listenerKeys_);const e=t.getArray();for(let i=0,s=e.length;i<s;i++){const r=e[i];this.registerLayerListeners_(r),this.dispatchEvent(new sn("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[ut(t,gs.PROPERTYCHANGE,this.handleLayerChange_,this),ut(t,st.CHANGE,this.handleLayerChange_,this)];t instanceof Ts&&e.push(ut(t,"addlayer",this.handleLayerGroupAdd_,this),ut(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[gt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new sn("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new sn("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new sn("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=gt(e);this.listenerKeys_[i].forEach(wt),delete this.listenerKeys_[i],this.dispatchEvent(new sn("removelayer",e)),this.changed()}getLayers(){return this.get(ba.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let s=0,r=i.length;s<r;++s)this.dispatchEvent(new sn("removelayer",i[s]))}this.set(ba.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const s=this.getLayerState();let r=s.zIndex;!t&&s.zIndex===void 0&&(r=0);for(let o=i,a=e.length;o<a;o++){const l=e[o];l.opacity*=s.opacity,l.visible=l.visible&&s.visible,l.maxResolution=Math.min(l.maxResolution,s.maxResolution),l.minResolution=Math.max(l.minResolution,s.minResolution),l.minZoom=Math.max(l.minZoom,s.minZoom),l.maxZoom=Math.min(l.maxZoom,s.maxZoom),s.extent!==void 0&&(l.extent!==void 0?l.extent=In(l.extent,s.extent):l.extent=s.extent),l.zIndex===void 0&&(l.zIndex=r)}return e}getSourceState(){return"ready"}}class pp extends Fo{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){tt()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;Di(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),_u(s,i)}forEachFeatureAtCoordinate(t,e,i,s,r,o,a,l){let h;const c=e.viewState;function d(P,O,G,k){return r.call(o,O,P?G:null,k)}const m=c.projection,y=hu(t.slice(),m),x=[[0,0]];if(m.canWrapX()&&s){const P=m.getExtent(),O=Et(P);x.push([-O,0],[O,0])}const R=e.layerStatesArray,I=R.length,M=[],v=[];for(let P=0;P<x.length;P++)for(let O=I-1;O>=0;--O){const G=R[O],k=G.layer;if(k.hasRenderer()&&Vl(G,c)&&a.call(l,k)){const u=k.getRenderer(),f=k.getSource();if(u&&f){const g=f.getWrapX()?y:t,E=d.bind(null,G.managed);v[0]=g[0]+x[P][0],v[1]=g[1]+x[P][1],h=u.forEachFeatureAtCoordinate(v,e,i,E,M)}if(h)return h}}if(M.length===0)return;const A=1/M.length;return M.forEach((P,O)=>P.distanceSq+=O*A),M.sort((P,O)=>P.distanceSq-O.distanceSq),M.some(P=>h=P.callback(P.feature,P.layer,P.geometry)),h}hasFeatureAtCoordinate(t,e,i,s,r,o){return this.forEachFeatureAtCoordinate(t,e,i,s,nr,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(t){tt()}scheduleExpireIconCache(t){Ge.canExpireCache()&&t.postRenderFunctions.push(_p)}}function _p(n,t){Ge.expire()}class yp extends pp{constructor(t){super(t),this.fontChangeListenerKey_=ut(Ti,gs.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=br+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const s=new Hu(t,void 0,e);i.dispatchEvent(s)}}disposeInternal(){wt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Ne.PRECOMPOSE,t);const e=t.layerStatesArray.sort((a,l)=>a.zIndex-l.zIndex);e.some(a=>a.layer instanceof ld&&a.layer.getDeclutter())&&(t.declutter={});const s=t.viewState;this.children_.length=0;const r=[];let o=null;for(let a=0,l=e.length;a<l;++a){const h=e[a];t.layerIndex=a;const c=h.layer,d=c.getSourceState();if(!Vl(h,s)||d!="ready"&&d!="undefined"){c.unrender();continue}const m=c.render(t,o);m&&(m!==o&&(this.children_.push(m),o=m),r.push(h))}this.declutter(t,r),Og(this.element_,this.children_),this.dispatchRenderEvent(Ne.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let i=e.length-1;i>=0;--i){const s=e[i],r=s.layer;r.getDeclutter()&&r.renderDeclutter(t,s)}e.forEach(i=>i.layer.renderDeferred(t))}}}function _d(n){if(n instanceof ea){n.setMapInternal(null);return}n instanceof Ts&&n.getLayers().forEach(_d)}function yd(n,t){if(n instanceof ea){n.setMapInternal(t);return}if(n instanceof Ts){const e=n.getLayers().getArray();for(let i=0,s=e.length;i<s;++i)yd(e[i],t)}}let xp=class extends He{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=Ep(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:Mg,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Ze(),this.pixelToCoordinateTransform_=Ze(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||q0(),this.interactions=e.interactions||mp({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new K0(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Qt.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Qt.VIEW,this.handleViewChanged_),this.addChangeListener(Qt.SIZE,this.handleSizeChanged_),this.addChangeListener(Qt.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof oi)&&t.view.then(function(s){i.setView(new oi(s))}),this.controls.addEventListener(ue.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(ue.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(ue.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(ue.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(ue.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(ue.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){yd(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:nr,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,a,e,null,o,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(s){i.push(s)},e),i}getAllLayers(){const t=[];function e(i){i.forEach(function(s){s instanceof Ts?e(s.getLayers()):t.push(s)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const s=e.layerFilter!==void 0?e.layerFilter:nr,r=e.hitTolerance!==void 0?e.hitTolerance:0,o=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const i=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=i.width/s[0],o=i.height/s[1],a="changedTouches"in t?t.changedTouches[0]:t;return[(a.clientX-i.left)/r,(a.clientY-i.top)/o]}getTarget(){return this.get(Qt.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return Ua(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?jt(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Qt.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof li){e.setLayers(t);return}const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const s=t[e];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const o=s.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=bi(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?jt(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Qt.SIZE)}getView(){return this.get(Qt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,s){return Z0(this.frameState_,t,e,i,s)}handleBrowserEvent(t,e){e=e||t.type;const i=new nn(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===Ja.POINTERDOWN||i===st.WHEEL||i===st.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,o=e.target,a=r instanceof ShadowRoot?r.host===o?r.host.ownerDocument:r:r===s?s.documentElement:r;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const o=s[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let s=this.maxTilesLoading_,r=s;if(t){const o=t.viewHints;if(o[te.ANIMATING]||o[te.INTERACTING]){const a=Date.now()-t.time>8;s=a?0:8,r=a?0:2}}e.getTilesLoading()<s&&(e.reprioritize(),e.loadMoreTiles(s,r))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(Ne.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ne.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ns(Ri.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ns(Ri.LOADSTART,this,t))));const i=this.postRenderFunctions_;if(t)for(let s=0,r=i.length;s<r;++s)i[s](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,s=this.targetChangeHandlerKeys_.length;i<s;++i)wt(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(st.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(st.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new yp(this)),this.mapBrowserEventHandler_=new Y0(this,this.moveTolerance_);for(const r in Ft)this.mapBrowserEventHandler_.addEventListener(Ft[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(st.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(st.WHEEL,this.boundHandleBrowserEvent_,Au?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const r=e.getRootNode();i=r instanceof ShadowRoot?r.host:e}this.targetChangeHandlerKeys_=[ut(i,st.KEYDOWN,this.handleBrowserEvent,this),ut(i,st.KEYPRESS,this.handleBrowserEvent,this)];const s=e.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(wt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(wt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=ut(t,gs.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ut(t,st.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(wt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new sn("addlayer",t)),this.layerGroupPropertyListenerKeys_=[ut(t,gs.PROPERTYCHANGE,this.render,this),ut(t,st.CHANGE,this.render,this),ut(t,"addlayer",this.handleLayerAdd_,this),ut(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const s=t[e].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){_d(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),s=this.frameState_;let r=null;if(e!==void 0&&Bh(e)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:za(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:gt(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=za(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!wr(this.previousExtent_)&&!rr(r.extent,this.previousExtent_))&&(this.dispatchEvent(new ns(Ri.MOVESTART,this,s)),this.previousExtent_=Cs(this.previousExtent_)),this.previousExtent_&&!r.viewHints[te.ANIMATING]&&!r.viewHints[te.INTERACTING]&&!rr(r.extent,this.previousExtent_)&&(this.dispatchEvent(new ns(Ri.MOVEEND,this,r)),tu(r.extent,this.previousExtent_))),this.dispatchEvent(new ns(Ri.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(Ri.LOADSTART)||this.hasListener(Ri.LOADEND)||this.hasListener(Ne.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new sn("removelayer",e)),this.set(Qt.LAYERGROUP,t)}setSize(t){this.set(Qt.SIZE,t)}setTarget(t){this.set(Qt.TARGET,t)}setView(t){if(!t||t instanceof oi){this.set(Qt.VIEW,t);return}this.set(Qt.VIEW,new oi);const e=this;t.then(function(i){e.setView(new oi(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const s=getComputedStyle(t),r=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),o=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(e=[Math.max(0,r),Math.max(0,o)],!Bh(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&lu("No map visible because the map container's width or height are 0."))}const i=this.getSize();e&&(!i||!gn(e,i))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}};function Ep(n){let t=null;n.keyboardEventTarget!==void 0&&(t=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const e={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Ts({layers:n.layers});e[Qt.LAYERGROUP]=i,e[Qt.TARGET]=n.target,e[Qt.VIEW]=n.view instanceof oi?n.view:new oi;let s;n.controls!==void 0&&(Array.isArray(n.controls)?s=new li(n.controls.slice()):(mt(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=n.controls));let r;n.interactions!==void 0&&(Array.isArray(n.interactions)?r=new li(n.interactions.slice()):(mt(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=n.interactions));let o;return n.overlays!==void 0?Array.isArray(n.overlays)?o=new li(n.overlays.slice()):(mt(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=n.overlays):o=new li,{controls:s,interactions:r,keyboardEventTarget:t,overlays:o,values:e}}const Jt={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class vp extends He{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+Zg,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Jt.ELEMENT,this.handleElementChanged),this.addChangeListener(Jt.MAP,this.handleMapChanged),this.addChangeListener(Jt.OFFSET,this.handleOffsetChanged),this.addChangeListener(Jt.POSITION,this.handlePositionChanged),this.addChangeListener(Jt.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(Jt.ELEMENT)}getId(){return this.id}getMap(){return this.get(Jt.MAP)||null}getOffset(){return this.get(Jt.OFFSET)}getPosition(){return this.get(Jt.POSITION)}getPositioning(){return this.get(Jt.POSITIONING)}handleElementChanged(){Ou(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){var e;this.mapPostrenderListenerKey&&((e=this.element)==null||e.remove(),wt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=ut(t,Ri.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(Jt.ELEMENT,t)}setMap(t){this.set(Jt.MAP,t)}setOffset(t){this.set(Jt.OFFSET,t)}setPosition(t){this.set(Jt.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(Jt.POSITION))return;const i=this.getRect(e.getTargetElement(),e.getSize()),s=this.getElement(),r=this.getRect(s,[Pg(s),Ag(s)]);t=t||{};const o=t.margin===void 0?20:t.margin;if(!os(i,r)){const a=r[0]-i[0],l=i[2]-r[2],h=r[1]-i[1],c=i[3]-r[3],d=[0,0];if(a<0?d[0]=a-o:l<0&&(d[0]=Math.abs(l)+o),h<0?d[1]=h-o:c<0&&(d[1]=Math.abs(c)+o),d[0]!==0||d[1]!==0){const m=e.getView().getCenterInternal(),y=e.getPixelFromCoordinateInternal(m);if(!y)return;const x=[y[0]+d[0],y[1]+d[1]],R=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(x),duration:R.duration,easing:R.easing})}}}getRect(t,e){const i=t.getBoundingClientRect(),s=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[s,r,s+e[0],r+e[1]]}setPositioning(t){this.set(Jt.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}const i=t.getPixelFromCoordinate(e),s=t.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(t,e){const i=this.element.style,s=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(t[0]+s[0])+"px",a=Math.round(t[1]+s[1])+"px";let l="0%",h="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?h="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${o}, ${a})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,i.transform=c)}getOptions(){return this.options}}class Ql{constructor(t,e,i,s){this.minX=t,this.maxX=e,this.minY=i,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Hn(n,t,e,i,s){return s!==void 0?(s.minX=n,s.maxX=t,s.minY=e,s.maxY=i,s):new Ql(n,t,e,i)}const Ta="units",wp=[1,2,5],Fs=25.4/.28;class Sp extends Lr{constructor(t){t=t||{};const e=document.createElement("div");e.style.pointerEvents="none",super({element:e,render:t.render,target:t.target}),this.on,this.once,this.un;const i=t.className!==void 0?t.className:t.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+br,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=t.minWidth!==void 0?t.minWidth:64,this.maxWidth_=t.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(Ta,this.handleUnitsChanged_),this.setUnits(t.units||"metric"),this.scaleBar_=t.bar||!1,this.scaleBarSteps_=t.steps||4,this.scaleBarText_=t.text||!1,this.dpi_=t.dpi||void 0}getUnits(){return this.get(Ta)}handleUnitsChanged_(){this.updateElement_()}setUnits(t){this.set(Ta,t)}setDpi(t){this.dpi_=t}updateElement_(){const t=this.viewState_;if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=t.center,i=t.projection,s=this.getUnits(),r=s=="degrees"?"degrees":"m";let o=fo(i,t.resolution,e,r);const a=this.minWidth_*(this.dpi_||Fs)/Fs,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||Fs)/Fs:void 0;let h=a*o,c="";if(s=="degrees"){const A=ps.degrees;h*=A,h<A/60?(c="",o*=3600):h<A?(c="",o*=60):c=""}else if(s=="imperial")h<.9144?(c="in",o/=.0254):h<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if(s=="nautical")o/=1852,c="NM";else if(s=="metric")h<1e-6?(c="nm",o*=1e9):h<.001?(c="m",o*=1e6):h<1?(c="mm",o*=1e3):h<1e3?c="m":(c="km",o/=1e3);else if(s=="us")h<.9144?(c="in",o*=39.37):h<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472);else throw new Error("Invalid units");let d=3*Math.floor(Math.log(a*o)/Math.log(10)),m,y,x,R=0,I,M;for(;;){x=Math.floor(d/3);const A=Math.pow(10,x);if(m=wp[(d%3+3)%3]*A,y=Math.round(m/o),isNaN(y)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&y>=l){m=R,y=I,x=M;break}else if(y>=a)break;R=m,I=y,M=x,++d}const v=this.scaleBar_?this.createScaleBar(y,m,c):m.toFixed(x<0?-x:0)+" "+c;this.renderedHTML_!=v&&(this.innerElement_.innerHTML=v,this.renderedHTML_=v),this.renderedWidth_!=y&&(this.innerElement_.style.width=y+"px",this.renderedWidth_=y),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(t,e,i){const s=this.getScaleForResolution(),r=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,a=t/o,l=[this.createMarker("absolute")];for(let c=0;c<o;++c){const d=c%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${d}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(c%2===0||o===2?this.createStepText(c,t,!1,e,i):"")+"</div>")}return l.push(this.createStepText(o,t,!0,e,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${t}px;">`+r+"</div>":"")+l.join("")}createMarker(t){return`<div class="ol-scale-step-marker" style="position: ${t}; top: ${t==="absolute"?3:-10}px;"></div>`}createStepText(t,e,i,s,r){const a=(t===0?0:Math.round(s/this.scaleBarSteps_*t*100)/100)+(t===0?"":" "+r),l=t===0?-3:e/this.scaleBarSteps_*-1,h=t===0?0:e/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${t===0?"left":"center"};min-width: ${h}px;left: ${i?e+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const t=fo(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),e=this.dpi_||Fs,i=1e3/25.4;return t*i*e}render(t){const e=t.frameState;e?this.viewState_=e.viewState:this.viewState_=null,this.updateElement_()}}function tl(n){return n instanceof Image||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageBitmap?n:null}const Cp=new Error("disposed"),bp=[256,256];class lc extends ql{constructor(t){const e=J.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=tl(this.data_);return t?[t.width,t.height]:bp}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==J.IDLE&&this.state!==J.ERROR)return;this.state=J.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=J.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=J.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Cp),this.controller_=null),super.disposeInternal()}}let Ra;const ds=[];function hc(n,t,e,i,s){n.beginPath(),n.moveTo(0,0),n.lineTo(t,e),n.lineTo(i,s),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(t,i)+1,Math.max(e,s)),n.restore()}function Ia(n,t){return Math.abs(n[t*4]-210)>2||Math.abs(n[t*4+3]-.75*255)>2}function Tp(){if(Ra===void 0){const n=Xt(6,6,ds);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",hc(n,4,5,4,0),hc(n,4,5,0,5);const t=n.getImageData(0,0,3,3).data;Ra=Ia(t,0)||Ia(t,4)||Ia(t,8),Ko(n),ds.push(n.canvas)}return Ra}function cc(n,t,e,i){const s=Xo(e,t,n);let r=fo(t,i,e);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const a=n.getMetersPerUnit();a!==void 0&&(r/=a);const l=n.getExtent();if(!l||ms(l,s)){const h=fo(n,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function Rp(n,t,e,i){const s=cn(e);let r=cc(n,t,s,i);return(!isFinite(r)||r<=0)&&su(e,function(o){return r=cc(n,t,o,i),isFinite(r)&&r>0}),r}function Ip(n,t,e,i,s,r,o,a,l,h,c,d,m,y){const x=Xt(Math.round(e*n),Math.round(e*t),ds);if(d||(x.imageSmoothingEnabled=!1),l.length===0)return x.canvas;x.scale(e,e);function R(O){return Math.round(O*e)/e}x.globalCompositeOperation="lighter";const I=$e();l.forEach(function(O,G,k){iu(I,O.extent)});let M;const v=e/i,A=(d?1:1+Math.pow(2,-24))/v;M=Xt(Math.round(Et(I)*v),Math.round(re(I)*v),ds),d||(M.imageSmoothingEnabled=!1),l.forEach(function(O,G,k){if(O.image.width>0&&O.image.height>0){if(O.clipExtent){M.save();const p=(O.clipExtent[0]-I[0])*v,S=-(O.clipExtent[3]-I[3])*v,C=Et(O.clipExtent)*v,_=re(O.clipExtent)*v;M.rect(d?p:Math.round(p),d?S:Math.round(S),d?C:Math.round(p+C)-Math.round(p),d?_:Math.round(S+_)-Math.round(S)),M.clip()}const u=(O.extent[0]-I[0])*v,f=-(O.extent[3]-I[3])*v,g=Et(O.extent)*v,E=re(O.extent)*v;M.drawImage(O.image,h,h,O.image.width-2*h,O.image.height-2*h,d?u:Math.round(u),d?f:Math.round(f),d?g:Math.round(u+g)-Math.round(u),d?E:Math.round(f+E)-Math.round(f)),O.clipExtent&&M.restore()}});const P=Dn(o);return a.getTriangles().forEach(function(O,G,k){const u=O.source,f=O.target;let g=u[0][0],E=u[0][1],p=u[1][0],S=u[1][1],C=u[2][0],_=u[2][1];const w=R((f[0][0]-P[0])/r),T=R(-(f[0][1]-P[1])/r),b=R((f[1][0]-P[0])/r),L=R(-(f[1][1]-P[1])/r),D=R((f[2][0]-P[0])/r),z=R(-(f[2][1]-P[1])/r),F=g,U=E;g=0,E=0,p-=F,S-=U,C-=F,_-=U;const K=[[p,S,0,0,b-w],[C,_,0,0,D-w],[0,0,p,S,L-T],[0,0,C,_,z-T]],B=Tf(K);if(!B)return;if(x.save(),x.beginPath(),Tp()||!d){x.moveTo(b,L);const q=4,St=w-b,It=T-L;for(let Ct=0;Ct<q;Ct++)x.lineTo(b+R((Ct+1)*St/q),L+R(Ct*It/(q-1))),Ct!=q-1&&x.lineTo(b+R((Ct+1)*St/q),L+R((Ct+1)*It/(q-1)));x.lineTo(D,z)}else x.moveTo(b,L),x.lineTo(w,T),x.lineTo(D,z);x.clip(),x.transform(B[0],B[2],B[1],B[3],w,T),x.translate(I[0]-F,I[3]-U);let X;if(M)X=M.canvas,x.scale(A,-A);else{const q=l[0],St=q.extent;X=q.image,x.scale(Et(St)/X.width,-re(St)/X.height)}x.drawImage(X,0,0),x.restore()}),M&&(Ko(M),ds.push(M.canvas)),c&&(x.save(),x.globalCompositeOperation="source-over",x.strokeStyle="black",x.lineWidth=1,a.getTriangles().forEach(function(O,G,k){const u=O.target,f=(u[0][0]-P[0])/r,g=-(u[0][1]-P[1])/r,E=(u[1][0]-P[0])/r,p=-(u[1][1]-P[1])/r,S=(u[2][0]-P[0])/r,C=-(u[2][1]-P[1])/r;x.beginPath(),x.moveTo(E,p),x.lineTo(f,g),x.lineTo(S,C),x.closePath(),x.stroke()}),x.restore()),x.canvas}const Lp=10,uc=.25;class Mp{constructor(t,e,i,s,r,o,a){this.sourceProj_=t,this.targetProj_=e;let l={};const h=a?ng(A=>jt(a,Xo(A,this.targetProj_,this.sourceProj_))):ys(this.targetProj_,this.sourceProj_);this.transformInv_=function(A){const P=A[0]+"/"+A[1];return l[P]||(l[P]=h(A)),l[P]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&Et(s)>=Et(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Et(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Et(this.targetProj_.getExtent()):null;const c=Dn(i),d=zo(i),m=Go(i),y=No(i),x=this.transformInv_(c),R=this.transformInv_(d),I=this.transformInv_(m),M=this.transformInv_(y),v=Lp+(o?Math.max(0,Math.ceil(Math.log2(Ga(i)/(o*o*256*256)))):0);if(this.addQuad_(c,d,m,y,x,R,I,M,v),this.wrapsXInSource_){let A=1/0;this.triangles_.forEach(function(P,O,G){A=Math.min(A,P.source[0][0],P.source[1][0],P.source[2][0])}),this.triangles_.forEach(P=>{if(Math.max(P.source[0][0],P.source[1][0],P.source[2][0])-A>this.sourceWorldWidth_/2){const O=[[P.source[0][0],P.source[0][1]],[P.source[1][0],P.source[1][1]],[P.source[2][0],P.source[2][1]]];O[0][0]-A>this.sourceWorldWidth_/2&&(O[0][0]-=this.sourceWorldWidth_),O[1][0]-A>this.sourceWorldWidth_/2&&(O[1][0]-=this.sourceWorldWidth_),O[2][0]-A>this.sourceWorldWidth_/2&&(O[2][0]-=this.sourceWorldWidth_);const G=Math.min(O[0][0],O[1][0],O[2][0]);Math.max(O[0][0],O[1][0],O[2][0])-G<this.sourceWorldWidth_/2&&(P.source=O)}})}l={}}addTriangle_(t,e,i,s,r,o){this.triangles_.push({source:[s,r,o],target:[t,e,i]})}addQuad_(t,e,i,s,r,o,a,l,h){const c=fh([r,o,a,l]),d=this.sourceWorldWidth_?Et(c)/this.sourceWorldWidth_:null,m=this.sourceWorldWidth_,y=this.sourceProj_.canWrapX()&&d>.5&&d<1;let x=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const I=fh([t,e,i,s]);x=Et(I)/this.targetWorldWidth_>uc||x}!y&&this.sourceProj_.isGlobal()&&d&&(x=d>uc||x)}if(!x&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!ge(c,this.maxSourceExtent_))return;let R=0;if(!x&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)x=!0;else if(R=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),R!=1&&R!=2&&R!=4&&R!=8)return}if(h>0){if(!x){const I=[(t[0]+i[0])/2,(t[1]+i[1])/2],M=this.transformInv_(I);let v;y?v=(Mn(r[0],m)+Mn(a[0],m))/2-Mn(M[0],m):v=(r[0]+a[0])/2-M[0];const A=(r[1]+a[1])/2-M[1];x=v*v+A*A>this.errorThresholdSquared_}if(x){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const I=[(e[0]+i[0])/2,(e[1]+i[1])/2],M=this.transformInv_(I),v=[(s[0]+t[0])/2,(s[1]+t[1])/2],A=this.transformInv_(v);this.addQuad_(t,e,I,v,r,o,M,A,h-1),this.addQuad_(v,I,i,s,A,M,a,l,h-1)}else{const I=[(t[0]+e[0])/2,(t[1]+e[1])/2],M=this.transformInv_(I),v=[(i[0]+s[0])/2,(i[1]+s[1])/2],A=this.transformInv_(v);this.addQuad_(t,I,v,s,r,M,A,l,h-1),this.addQuad_(I,e,i,v,M,o,a,A,h-1)}return}}if(y){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(R&11)==0&&this.addTriangle_(t,i,s,r,a,l),(R&14)==0&&this.addTriangle_(t,i,e,r,a,o),R&&((R&13)==0&&this.addTriangle_(e,s,t,o,l,r),(R&7)==0&&this.addTriangle_(e,s,i,o,l,a))}calculateSourceExtent(){const t=$e();return this.triangles_.forEach(function(e,i,s){const r=e.source;Qs(t,r[0]),Qs(t,r[1]),Qs(t,r[2])}),t}getTriangles(){return this.triangles_}}const Pp=.5;class xd extends ql{constructor(t,e,i,s,r,o,a,l,h,c,d,m){super(r,J.IDLE,m),this.renderEdges_=d!==void 0?d:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const y=s.getTileCoordExtent(this.wrappedTileCoord_),x=this.targetTileGrid_.getExtent();let R=this.sourceTileGrid_.getExtent();const I=x?In(y,x):y;if(Ga(I)===0){this.state=J.EMPTY;return}const M=t.getExtent();M&&(R?R=In(R,M):R=M);const v=s.getResolution(this.wrappedTileCoord_[0]),A=Rp(t,i,I,v);if(!isFinite(A)||A<=0){this.state=J.EMPTY;return}const P=c!==void 0?c:Pp;if(this.triangulation_=new Mp(t,i,I,R,A*P,v),this.triangulation_.getTriangles().length===0){this.state=J.EMPTY;return}this.sourceZ_=e.getZForResolution(A);let O=this.triangulation_.calculateSourceExtent();if(R&&(t.canWrapX()?(O[1]=At(O[1],R[1],R[3]),O[3]=At(O[3],R[1],R[3])):O=In(O,R)),!Ga(O))this.state=J.EMPTY;else{let G=0,k=0;t.canWrapX()&&(G=Et(M),k=Math.floor((O[0]-M[0])/G)),au(O.slice(),t,!0).forEach(f=>{const g=e.getTileRangeForExtentAndZ(f,this.sourceZ_);for(let E=g.minX;E<=g.maxX;E++)for(let p=g.minY;p<=g.maxY;p++){const S=h(this.sourceZ_,E,p,a);if(S){const C=k*G;this.sourceTiles_.push({tile:S,offset:C})}}++k}),this.sourceTiles_.length===0&&(this.state=J.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{var s;const i=e.tile;if(i&&i.getState()==J.LOADED){const r=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);r[0]+=e.offset,r[2]+=e.offset;const o=(s=this.clipExtent_)==null?void 0:s.slice();o&&(o[0]+=e.offset,o[2]+=e.offset),t.push({extent:r,clipExtent:o,image:i.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=J.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),s=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Ip(s,r,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=J.LOADED}this.changed()}load(){if(this.state==J.IDLE){this.state=J.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const i=e.getState();if(i==J.IDLE||i==J.LOADING){t++;const s=ut(e,st.CHANGE,r=>{const o=e.getState();(o==J.LOADED||o==J.ERROR||o==J.EMPTY)&&(wt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},i,s){e.getState()==J.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(wt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ko(this.canvas_.getContext("2d")),ds.push(this.canvas_),this.canvas_=null),super.release()}}class Ap{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const t=this.pop();t instanceof Fo&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return mt(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return mt(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){var e;return(e=this.entries_[t])==null?void 0:e.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){mt(!(t in this.entries_),"Tried to set a value for a key that is used already");const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}function So(n,t,e,i){return i!==void 0?(i[0]=n,i[1]=t,i[2]=e,i):[n,t,e]}function Op(n,t,e){return n+"/"+t+"/"+e}function Fp(n){return kp(n[0],n[1],n[2])}function kp(n,t,e){return(t<<n)+e}function Dp(n,t){const e=n[0],i=n[1],s=n[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const r=t.getFullTileRange(e);return r?r.containsXY(i,s):!0}function La(n,t,e,i){return`${n},${Op(t,e,i)}`}function Ma(n,t,e){if(!(e in n))return n[e]=new Set([t]),!0;const i=n[e],s=i.has(t);return s||i.add(t),!s}function Np(n,t,e){const i=n[e];return i?i.delete(t):!1}function dc(n,t){const e=n.layerStatesArray[n.layerIndex];e.extent&&(t=In(t,rn(e.extent,n.viewState.projection)));const i=e.layer.getRenderSource();if(!i.getWrapX()){const s=i.getTileGridForProjection(n.viewState.projection).getExtent();s&&(t=In(t,s))}return t}class Gp extends Ju{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=$e(),this.tempTileRange_=new Ql(0,0,0,0),this.tempTileCoord_=So(0,0,0);const i=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new Ap(i),this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,i,s){const r=this.tileCache_,a=this.getLayer().getSource(),l=La(a.getKey(),t,e,i);let h;if(r.containsKey(l))h=r.get(l);else{if(h=a.getTile(t,e,i,s.pixelRatio,s.viewState.projection),!h)return null;r.set(l,h)}return h}getTile(t,e,i,s){const r=this.getOrCreateTile(t,e,i,s);return r||null}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),s=jt(e.pixelToCoordinateTransform,t.slice()),r=i.getExtent();if(r&&!ms(r,s))return null;const o=e.viewState,a=i.getRenderSource(),l=a.getTileGridForProjection(o.projection),h=a.getTilePixelRatio(e.pixelRatio);for(let c=l.getZForResolution(o.resolution);c>=l.getMinZoom();--c){const d=l.getTileCoordForCoordAndZ(s,c),m=this.getTile(c,d[1],d[2],e);if(!m||m.getState()!==J.LOADED)continue;const y=l.getOrigin(c),x=pe(l.getTileSize(c)),R=l.getResolution(c);let I;if(m instanceof cd||m instanceof xd)I=m.getImage();else if(m instanceof lc){if(I=tl(m.getData()),!I)continue}else continue;const M=Math.floor(h*((s[0]-y[0])/R-d[1]*x[0])),v=Math.floor(h*((y[1]-s[1])/R-d[2]*x[1])),A=Math.round(h*a.getGutterForProjection(o.projection));return this.getImageData(I,M+A,v+A)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;const e=this.getLayer().getSource();if(!e)return!1;const i=e.getRevision();return this.renderedRevision_?this.renderedRevision_!==i&&(this.renderedRevision_=i,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedRevision_=i,!0}enqueueTiles(t,e,i,s,r){const o=t.viewState,a=this.getLayer(),l=a.getRenderSource(),h=l.getTileGridForProjection(o.projection),c=gt(l);c in t.wantedTiles||(t.wantedTiles[c]={});const d=t.wantedTiles[c],m=a.getMapInternal(),y=Math.max(i-r,h.getMinZoom(),h.getZForResolution(Math.min(a.getMaxResolution(),m?m.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):h.getResolution(0)),l.zDirection)),x=o.rotation,R=x?ru(o.center,o.resolution,x,t.size):void 0;for(let I=i;I>=y;--I){const M=h.getTileRangeForExtentAndZ(e,I,this.tempTileRange_),v=h.getResolution(I);for(let A=M.minX;A<=M.maxX;++A)for(let P=M.minY;P<=M.maxY;++P){if(x&&!h.tileCoordIntersectsViewport([I,A,P],R))continue;const O=this.getTile(I,A,P,t);if(!O||!Ma(s,O,I))continue;const k=O.getKey();if(d[k]=!0,O.getState()===J.IDLE&&!t.tileQueue.isKeyQueued(k)){const u=So(I,A,P,this.tempTileCoord_);t.tileQueue.enqueue([O,c,h.getTileCoordCenter(u),v])}}}}findStaleTile_(t,e){const i=this.tileCache_,s=t[0],r=t[1],o=t[2],a=this.getStaleKeys();for(let l=0;l<a.length;++l){const h=La(a[l],s,r,o);if(i.containsKey(h)){const c=i.peek(h);if(c.getState()===J.LOADED)return c.endTransition(gt(this)),Ma(e,c,s),!0}}return!1}findAltTiles_(t,e,i,s){const r=t.getTileRangeForTileCoordAndZ(e,i,this.tempTileRange_);if(!r)return!1;let o=!0;const a=this.tileCache_,h=this.getLayer().getRenderSource().getKey();for(let c=r.minX;c<=r.maxX;++c)for(let d=r.minY;d<=r.maxY;++d){const m=La(h,i,c,d);let y=!1;if(a.containsKey(m)){const x=a.peek(m);x.getState()===J.LOADED&&(Ma(s,x,i),y=!0)}y||(o=!1)}return o}renderFrame(t,e){this.renderComplete=!0;const i=t.layerStatesArray[t.layerIndex],s=t.viewState,r=s.projection,o=s.resolution,a=s.center,l=t.pixelRatio,h=this.getLayer(),c=h.getSource(),d=c.getTileGridForProjection(r),m=d.getZForResolution(o,c.zDirection),y=d.getResolution(m),x=c.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==x&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=x):this.renderedSourceKey_=x;let R=t.extent;const I=c.getTilePixelRatio(l);this.prepareContainer(t,e);const M=this.context.canvas.width,v=this.context.canvas.height,A=i.extent&&rn(i.extent);A&&(R=In(R,rn(i.extent)));const P=y*M/2/I,O=y*v/2/I,G=[a[0]-P,a[1]-O,a[0]+P,a[1]+O],k={};this.renderedTiles.length=0;const u=h.getPreload();if(t.nextExtent){const b=d.getZForResolution(s.nextResolution,c.zDirection),L=dc(t,t.nextExtent);this.enqueueTiles(t,L,b,k,u)}const f=dc(t,R);if(this.enqueueTiles(t,f,m,k,0),u>0&&setTimeout(()=>{this.enqueueTiles(t,f,m-1,k,u-1)},0),!(m in k))return this.container;const g=gt(this),E=t.time;for(const b of k[m]){const L=b.getState();if(L===J.EMPTY)continue;const D=b.tileCoord;if(L===J.LOADED&&b.getAlpha(g,E)===1){b.endTransition(g);continue}if(L!==J.ERROR&&(this.renderComplete=!1),this.findStaleTile_(D,k)){Np(k,b,m),t.animate=!0;continue}if(this.findAltTiles_(d,D,m+1,k))continue;const U=d.getMinZoom();for(let K=m-1;K>=U&&!this.findAltTiles_(d,D,K,k);--K);}const p=y/o*l/I,S=this.getRenderContext(t);Di(this.tempTransform,M/2,v/2,p,p,0,-M/2,-v/2),i.extent&&this.clipUnrotated(S,t,A),c.getInterpolate()||(S.imageSmoothingEnabled=!1),this.preRender(S,t);const C=Object.keys(k).map(Number);C.sort(Li);let _;const w=[],T=[];for(let b=C.length-1;b>=0;--b){const L=C[b],D=c.getTilePixelSize(L,l,r),F=d.getResolution(L)/y,U=D[0]*F*p,K=D[1]*F*p,B=d.getTileCoordForCoordAndZ(Dn(G),L),X=d.getTileCoordExtent(B),q=jt(this.tempTransform,[I*(X[0]-G[0])/y,I*(G[3]-X[3])/y]),St=I*c.getGutterForProjection(r);for(const It of k[L]){if(It.getState()!==J.LOADED)continue;const Ct=It.tileCoord,pt=B[1]-Ct[1],Nt=Math.round(q[0]-(pt-1)*U),lt=B[2]-Ct[2],et=Math.round(q[1]-(lt-1)*K),j=Math.round(q[0]-pt*U),_e=Math.round(q[1]-lt*K),Je=Nt-j,Qe=et-_e,mn=C.length===1;let mi=!1;_=[j,_e,j+Je,_e,j+Je,_e+Qe,j,_e+Qe];for(let pi=0,Xi=w.length;pi<Xi;++pi)if(!mn&&L<T[pi]){const Gt=w[pi];ge([j,_e,j+Je,_e+Qe],[Gt[0],Gt[3],Gt[4],Gt[7]])&&(mi||(S.save(),mi=!0),S.beginPath(),S.moveTo(_[0],_[1]),S.lineTo(_[2],_[3]),S.lineTo(_[4],_[5]),S.lineTo(_[6],_[7]),S.moveTo(Gt[6],Gt[7]),S.lineTo(Gt[4],Gt[5]),S.lineTo(Gt[2],Gt[3]),S.lineTo(Gt[0],Gt[1]),S.clip())}w.push(_),T.push(L),this.drawTile(It,t,j,_e,Je,Qe,St,mn),mi&&S.restore(),this.renderedTiles.unshift(It),this.updateUsedTiles(t.usedTiles,c,It)}}if(this.renderedResolution=y,this.extentChanged=!this.renderedExtent_||!rr(this.renderedExtent_,G),this.renderedExtent_=G,this.renderedPixelRatio=l,this.postRender(this.context,t),i.extent&&S.restore(),S.imageSmoothingEnabled=!0,this.renderComplete){const b=(L,D)=>{const z=gt(c),F=D.wantedTiles[z],U=F?Object.keys(F).length:0;this.updateCacheSize(U),this.tileCache_.expireCache()};t.postRenderFunctions.push(b)}return this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,i,s,r,o,a,l){let h;if(t instanceof lc){if(h=tl(t.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(t);if(!h)return;const c=this.getRenderContext(e),d=gt(this),m=e.layerStatesArray[e.layerIndex],y=m.opacity*(l?t.getAlpha(d,e.time):1),x=y!==c.globalAlpha;x&&(c.save(),c.globalAlpha=y),c.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,s,r,o),x&&c.restore(),y!==m.opacity?e.animate=!0:l&&t.endTransition(d)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,i){const s=gt(e);s in t||(t[s]={}),t[s][i.getKey()]=!0}}const Yr={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class zp extends ea{constructor(t){t=t||{};const e=Object.assign({},t),i=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=i,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Yr.PRELOAD)}setPreload(t){this.set(Yr.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Yr.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Yr.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class $p extends zp{constructor(t){super(t)}createRenderer(){return new Gp(this,{cacheSize:this.getCacheSize()})}}const Jn=[0,0,0],Qi=5;class Ed{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,mt(gf(this.resolutions_,(s,r)=>r-s),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!e)e=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,mt(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Dn(i)),mt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,mt(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Zl,mt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,r)=>{const o=new Ql(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o}):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const s=this.getTileRangeForExtentAndZ(t,e);for(let r=s.minX,o=s.maxX;r<=o;++r)for(let a=s.minY,l=s.maxY;a<=l;++a)i([e,r,a])}forEachTileCoordParentTileRange(t,e,i,s){let r,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(o!==void 0&&a!==void 0?(o=Math.floor(o/2),a=Math.floor(a/2),r=Hn(o,o,a,a,i)):r=this.getTileRangeForExtentAndZ(l,h,i),e(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=t[1]*2,o=t[2]*2;return Hn(r,r+1,o,o+1,e)}const s=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],r=t[1],o=t[2];if(e===s)return Hn(r,o,r,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-s),h=Math.floor(r*l),c=Math.floor(o*l);if(e<s)return Hn(h,h,c,c,i);const d=Math.floor(l*(r+1))-1,m=Math.floor(l*(o+1))-1;return Hn(h,d,c,m,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeForExtentAndZ(t,e,i){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Jn);const s=Jn[1],r=Jn[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Jn);const o=Jn[1],a=Jn[2];return Hn(s,o,r,a,i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=pe(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*i,e[1]-(t[2]+.5)*s[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=pe(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*r[0]*s,a=i[1]-(t[2]+1)*r[1]*s,l=o+r[0]*s,h=a+r[1]*s;return ki(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,s,r){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=pe(this.getTileSize(o),this.tmpSize_);let c=a*(t-l[0])/i/h[0],d=a*(l[1]-e)/i/h[1];return s?(c=Dr(c,Qi)-1,d=Dr(d,Qi)-1):(c=kr(c,Qi),d=kr(d,Qi)),So(o,c,d,r)}getTileCoordForXYAndZ_(t,e,i,s,r){const o=this.getOrigin(i),a=this.getResolution(i),l=pe(this.getTileSize(i),this.tmpSize_);let h=(t-o[0])/a/l[0],c=(o[1]-e)/a/l[1];return s?(h=Dr(h,Qi)-1,c=Dr(c,Qi)-1):(h=kr(h,Qi),c=kr(c,Qi)),So(i,h,c,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=_l(this.resolutions_,t,e||0);return At(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Tu(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let s=this.minZoom;s<e;++s)i[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=i}}function vd(n){let t=n.getDefaultTileGrid();return t||(t=Up(n),n.setDefaultTileGrid(t)),t}function Wp(n,t,e){const i=t[0],s=n.getTileCoordCenter(t),r=th(e);if(!ms(r,s)){const o=Et(r),a=Math.ceil((r[0]-s[0])/o);return s[0]+=o*a,n.getTileCoordForCoordAndZ(s,i)}return t}function Bp(n,t,e,i){i=i!==void 0?i:"top-left";const s=wd(n,t,e);return new Ed({extent:n,origin:vf(n,i),resolutions:s,tileSize:e})}function Xp(n){const t=n||{},e=t.extent||kt("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:wd(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Ed(i)}function wd(n,t,e,i){t=t!==void 0?t:N0,e=pe(e!==void 0?e:Zl);const s=re(n),r=Et(n);i=i>0?i:Math.max(r/e[0],s/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Up(n,t,e,i){const s=th(n);return Bp(s,t,e,i)}function th(n){n=kt(n);let t=n.getExtent();if(!t){const e=180*ps.degrees/n.getMetersPerUnit();t=ki(-e,-e,e,e)}return t}const Yp=/\{z\}/g,jp=/\{x\}/g,Kp=/\{y\}/g,Zp=/\{-y\}/g;function Vp(n,t,e,i,s){return n.replace(Yp,t.toString()).replace(jp,e.toString()).replace(Kp,i.toString()).replace(Zp,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-i).toString()})}function qp(n){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(n);if(e){const i=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let r;for(r=i;r<=s;++r)t.push(n.replace(e[0],String.fromCharCode(r)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(n),e){const i=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=i;s++)t.push(n.replace(e[0],s.toString()));return t}return t.push(n),t}function Hp(n,t){return function(e,i,s){if(!e)return;let r;const o=e[0];if(t){const a=t.getFullTileRange(o);a&&(r=a.getHeight()-1)}return Vp(n,o,e[1],e[2],r)}}function Jp(n,t){const e=n.length,i=new Array(e);for(let s=0;s<e;++s)i[s]=Hp(n[s],t);return Qp(i)}function Qp(n){return n.length===1?n[0]:function(t,e,i){if(!t)return;const s=Fp(t),r=Mn(s,n.length);return n[r](t,e,i)}}class t_ extends ju{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&pe(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||gt(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,i,s,r){return tt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:vd(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const s=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),o=pe(s.getTileSize(t),this.tmpSize);return r==1?o:Sm(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const i=e!==void 0?e:this.getProjection(),s=e!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(t=Wp(s,t,i)),Dp(t,s)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class e_ extends qt{constructor(t,e){super(t),this.tile=e}}const Pa={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class eh extends t_{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===eh.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=gt(e),s=e.getState();let r;s==J.LOADING?(this.tileLoadingKeys_[i]=!0,r=Pa.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=s==J.ERROR?Pa.TILELOADERROR:s==J.LOADED?Pa.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new e_(r,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=qp(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Jp(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}}class i_ extends eh{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:n_,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:cd,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!Qr(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Qr(e,t)))return this.tileGrid;const i=gt(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=vd(t)),this.tileGridForProjection[i]}createTile_(t,e,i,s,r,o){const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,r),h=l?this.tileUrlFunction(l,s,r):void 0,c=new this.tileClass(a,h!==void 0?J.IDLE:J.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(st.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,i,s,r){const o=this.getProjection();if(!o||!r||Qr(o,r))return this.getTileInternal(t,e,i,s,o||r);const a=[t,e,i],l=this.getKey(),h=this.getTileGridForProjection(o),c=this.getTileGridForProjection(r),d=this.getTileCoordForTileUrlFunction(a,r),m=new xd(o,h,r,c,a,d,this.getTilePixelRatio(s),this.getGutter(),(y,x,R,I)=>this.getTileInternal(y,x,R,I,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return m.key=l,m}getTileInternal(t,e,i,s,r){const o=this.getKey();return this.createTile_(t,e,i,s,r,o)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){const i=kt(t);if(i){const s=gt(i);s in this.tileGridForProjection||(this.tileGridForProjection[s]=e)}}}function n_(n,t){n.getImage().src=t}class s_ extends i_{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:Xp({extent:th(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const r_='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class o_ extends s_{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[r_];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",s=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:s,wrapX:t.wrapX,zDirection:t.zDirection})}}class a_{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=Ce,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?kt(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=kt(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return tt()}readFeature(t,e){return tt()}readFeatures(t,e){return tt()}readGeometry(t,e){return tt()}readProjection(t){return tt()}writeFeature(t,e){return tt()}writeFeatures(t,e){return tt()}writeGeometry(t,e){return tt()}}function ih(n,t,e){const i=e?kt(e.featureProjection):null,s=e?kt(e.dataProjection):null;let r=n;if(i&&s&&!Qr(i,s)){t&&(r=n.clone());const o=t?i:s,a=t?s:i;o.getUnits()==="tile-pixels"?r.transform(o,a):r.applyTransform(ys(o,a))}if(t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*o)/o;return l};r===n&&(r=n.clone()),r.applyTransform(a)}return r}const l_={Point:Mi,LineString:un,Polygon:gi,MultiPoint:Zo,MultiLineString:ws,MultiPolygon:Ss};function h_(n,t,e){return Array.isArray(t[0])?(Iu(n,0,t,e)||(n=n.slice(),ja(n,0,t,e)),n):(Dl(n,0,t,e)||(n=n.slice(),go(n,0,t,e)),n)}function Sd(n,t){var r;const e=n.geometry;if(!e)return[];if(Array.isArray(e))return e.map(o=>Sd({...n,geometry:o})).flat();const i=e.type==="MultiPolygon"?"Polygon":e.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const s=e.layout.length;return ih(new Re(i,i==="Polygon"?h_(e.flatCoordinates,e.ends,s):e.flatCoordinates,(r=e.ends)==null?void 0:r.flat(),s,n.properties||{},n.id).enableSimplifyTransformed(),!1,t)}function nh(n,t){if(!n)return null;if(Array.isArray(n)){const i=n.map(s=>nh(s,t));return new fr(i)}const e=l_[n.type];return ih(new e(n.flatCoordinates,n.layout||"XY",n.ends),!1,t)}class c_ extends a_{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(jr(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(jr(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return tt()}readFeaturesFromObject(t,e){return tt()}readGeometry(t,e){return this.readGeometryFromObject(jr(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return tt()}readProjection(t){return this.readProjectionFromObject(jr(t))}readProjectionFromObject(t){return tt()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return tt()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return tt()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return tt()}}function jr(n){if(typeof n=="string"){const t=JSON.parse(n);return t||null}return n!==null?n:null}class Cd extends c_{constructor(t){t=t||{},super(),this.dataProjection=kt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=kt(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const s=sh(i.geometry);if(this.featureClass===Re)return Sd({geometry:s,id:i.id,properties:i.properties},e);const r=new Ce;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&r.setGeometryName(i.geometry_name),r.setGeometry(nh(s,e)),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(t,e){const i=t;let s=null;if(i.type==="FeatureCollection"){const r=t;s=[];const o=r.features;for(let a=0,l=o.length;a<l;++a){const h=this.readFeatureFromObject(o[a],e);h&&s.push(h)}}else s=[this.readFeatureFromObject(t,e)];return s.flat()}readGeometryFromObject(t,e){return u_(t,e)}readProjectionFromObject(t){const e=t.crs;let i;if(e)if(e.type=="name")i=kt(e.properties.name);else if(e.type==="EPSG")i=kt("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(i.id=s),!t.hasProperties())return i;const r=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=el(o,e),delete r[t.getGeometryName()]),An(r)||(i.properties=r),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let s=0,r=t.length;s<r;++s)i.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return el(t,this.adaptOptions(e))}}function sh(n,t){if(!n)return null;let e;switch(n.type){case"Point":{e=f_(n);break}case"LineString":{e=g_(n);break}case"Polygon":{e=y_(n);break}case"MultiPoint":{e=p_(n);break}case"MultiLineString":{e=m_(n);break}case"MultiPolygon":{e=__(n);break}case"GeometryCollection":{e=d_(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return e}function u_(n,t){const e=sh(n);return nh(e,t)}function d_(n,t){return n.geometries.map(function(i){return sh(i)})}function f_(n){const t=n.coordinates;return{type:"Point",flatCoordinates:t,layout:Gn(t.length)}}function g_(n){var i;const t=n.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:Gn(((i=t[0])==null?void 0:i.length)||2)}}function m_(n){var r,o;const t=n.coordinates,e=((o=(r=t[0])==null?void 0:r[0])==null?void 0:o.length)||2,i=[],s=Cr(i,0,t,e);return{type:"MultiLineString",flatCoordinates:i,ends:s,layout:Gn(e)}}function p_(n){var e;const t=n.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:Gn(((e=t[0])==null?void 0:e.length)||2)}}function __(n){var r,o;const t=n.coordinates,e=[],i=((o=(r=t[0])==null?void 0:r[0])==null?void 0:o[0].length)||2,s=wu(e,0,t,i);return{type:"MultiPolygon",flatCoordinates:e,ends:s,layout:Gn(i)}}function y_(n){var r,o;const t=n.coordinates,e=[],i=(o=(r=t[0])==null?void 0:r[0])==null?void 0:o.length,s=Cr(e,0,t,i);return{type:"Polygon",flatCoordinates:e,ends:s,layout:Gn(i)}}function el(n,t){n=ih(n,!0,t);const e=n.getType();let i;switch(e){case"Point":{i=C_(n);break}case"LineString":{i=E_(n);break}case"Polygon":{i=b_(n,t);break}case"MultiPoint":{i=w_(n);break}case"MultiLineString":{i=v_(n);break}case"MultiPolygon":{i=S_(n,t);break}case"GeometryCollection":{i=x_(n,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function x_(n,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return el(i,t)})}}function E_(n,t){return{type:"LineString",coordinates:n.getCoordinates()}}function v_(n,t){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function w_(n,t){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function S_(n,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(e)}}function C_(n,t){return{type:"Point",coordinates:n.getCoordinates()}}function b_(n,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(e)}}function bd(n,t,e={}){const i={type:"Feature"};return(e.id===0||e.id)&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.properties=t||{},i.geometry=n,i}function Td(n,t,e={}){for(const s of n){if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(s[s.length-1].length!==s[0].length)throw new Error("First and last Position are not equivalent.");for(let r=0;r<s[s.length-1].length;r++)if(s[s.length-1][r]!==s[0][r])throw new Error("First and last Position are not equivalent.")}return bd({type:"Polygon",coordinates:n},t,e)}function T_(n,t={}){const e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=n,e}function Rd(n,t,e={}){return bd({type:"MultiPolygon",coordinates:n},t,e)}function R_(n,t){var e,i,s,r,o,a,l,h,c,d,m=0,y=n.type==="FeatureCollection",x=n.type==="Feature",R=y?n.features.length:1;for(e=0;e<R;e++){for(a=y?n.features[e].geometry:x?n.geometry:n,h=y?n.features[e].properties:x?n.properties:{},c=y?n.features[e].bbox:x?n.bbox:void 0,d=y?n.features[e].id:x?n.id:void 0,l=a?a.type==="GeometryCollection":!1,o=l?a.geometries.length:1,s=0;s<o;s++){if(r=l?a.geometries[s]:a,r===null){if(t(null,m,h,c,d)===!1)return!1;continue}switch(r.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(r,m,h,c,d)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<r.geometries.length;i++)if(t(r.geometries[i],m,h,c,d)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}m++}}var I_=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Aa=Math.ceil,Oe=Math.floor,he="[BigNumber Error] ",fc=he+"Number primitive has more than 15 significant digits: ",Ye=1e14,it=14,gc=9007199254740991,Oa=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],tn=1e7,we=1e9;function Id(n){var t,e,i,s=v.prototype={constructor:v,toString:null,valueOf:null},r=new v(1),o=20,a=4,l=-7,h=21,c=-1e7,d=1e7,m=!1,y=1,x=0,R={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},I="0123456789abcdefghijklmnopqrstuvwxyz",M=!0;function v(u,f){var g,E,p,S,C,_,w,T,b=this;if(!(b instanceof v))return new v(u,f);if(f==null){if(u&&u._isBigNumber===!0){b.s=u.s,!u.c||u.e>d?b.c=b.e=null:u.e<c?b.c=[b.e=0]:(b.e=u.e,b.c=u.c.slice());return}if((_=typeof u=="number")&&u*0==0){if(b.s=1/u<0?(u=-u,-1):1,u===~~u){for(S=0,C=u;C>=10;C/=10,S++);S>d?b.c=b.e=null:(b.e=S,b.c=[u]);return}T=String(u)}else{if(!I_.test(T=String(u)))return i(b,T,_);b.s=T.charCodeAt(0)==45?(T=T.slice(1),-1):1}(S=T.indexOf("."))>-1&&(T=T.replace(".","")),(C=T.search(/e/i))>0?(S<0&&(S=C),S+=+T.slice(C+1),T=T.substring(0,C)):S<0&&(S=T.length)}else{if(Mt(f,2,I.length,"Base"),f==10&&M)return b=new v(u),G(b,o+b.e+1,a);if(T=String(u),_=typeof u=="number"){if(u*0!=0)return i(b,T,_,f);if(b.s=1/u<0?(T=T.slice(1),-1):1,v.DEBUG&&T.replace(/^0\.0*|\./,"").length>15)throw Error(fc+u)}else b.s=T.charCodeAt(0)===45?(T=T.slice(1),-1):1;for(g=I.slice(0,f),S=C=0,w=T.length;C<w;C++)if(g.indexOf(E=T.charAt(C))<0){if(E=="."){if(C>S){S=w;continue}}else if(!p&&(T==T.toUpperCase()&&(T=T.toLowerCase())||T==T.toLowerCase()&&(T=T.toUpperCase()))){p=!0,C=-1,S=0;continue}return i(b,String(u),_,f)}_=!1,T=e(T,f,10,b.s),(S=T.indexOf("."))>-1?T=T.replace(".",""):S=T.length}for(C=0;T.charCodeAt(C)===48;C++);for(w=T.length;T.charCodeAt(--w)===48;);if(T=T.slice(C,++w)){if(w-=C,_&&v.DEBUG&&w>15&&(u>gc||u!==Oe(u)))throw Error(fc+b.s*u);if((S=S-C-1)>d)b.c=b.e=null;else if(S<c)b.c=[b.e=0];else{if(b.e=S,b.c=[],C=(S+1)%it,S<0&&(C+=it),C<w){for(C&&b.c.push(+T.slice(0,C)),w-=it;C<w;)b.c.push(+T.slice(C,C+=it));C=it-(T=T.slice(C)).length}else C-=w;for(;C--;T+="0");b.c.push(+T)}}else b.c=[b.e=0]}v.clone=Id,v.ROUND_UP=0,v.ROUND_DOWN=1,v.ROUND_CEIL=2,v.ROUND_FLOOR=3,v.ROUND_HALF_UP=4,v.ROUND_HALF_DOWN=5,v.ROUND_HALF_EVEN=6,v.ROUND_HALF_CEIL=7,v.ROUND_HALF_FLOOR=8,v.EUCLID=9,v.config=v.set=function(u){var f,g;if(u!=null)if(typeof u=="object"){if(u.hasOwnProperty(f="DECIMAL_PLACES")&&(g=u[f],Mt(g,0,we,f),o=g),u.hasOwnProperty(f="ROUNDING_MODE")&&(g=u[f],Mt(g,0,8,f),a=g),u.hasOwnProperty(f="EXPONENTIAL_AT")&&(g=u[f],g&&g.pop?(Mt(g[0],-1e9,0,f),Mt(g[1],0,we,f),l=g[0],h=g[1]):(Mt(g,-1e9,we,f),l=-(h=g<0?-g:g))),u.hasOwnProperty(f="RANGE"))if(g=u[f],g&&g.pop)Mt(g[0],-1e9,-1,f),Mt(g[1],1,we,f),c=g[0],d=g[1];else if(Mt(g,-1e9,we,f),g)c=-(d=g<0?-g:g);else throw Error(he+f+" cannot be zero: "+g);if(u.hasOwnProperty(f="CRYPTO"))if(g=u[f],g===!!g)if(g)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))m=g;else throw m=!g,Error(he+"crypto unavailable");else m=g;else throw Error(he+f+" not true or false: "+g);if(u.hasOwnProperty(f="MODULO_MODE")&&(g=u[f],Mt(g,0,9,f),y=g),u.hasOwnProperty(f="POW_PRECISION")&&(g=u[f],Mt(g,0,we,f),x=g),u.hasOwnProperty(f="FORMAT"))if(g=u[f],typeof g=="object")R=g;else throw Error(he+f+" not an object: "+g);if(u.hasOwnProperty(f="ALPHABET"))if(g=u[f],typeof g=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(g))M=g.slice(0,10)=="0123456789",I=g;else throw Error(he+f+" invalid: "+g)}else throw Error(he+"Object expected: "+u);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,h],RANGE:[c,d],CRYPTO:m,MODULO_MODE:y,POW_PRECISION:x,FORMAT:R,ALPHABET:I}},v.isBigNumber=function(u){if(!u||u._isBigNumber!==!0)return!1;if(!v.DEBUG)return!0;var f,g,E=u.c,p=u.e,S=u.s;t:if({}.toString.call(E)=="[object Array]"){if((S===1||S===-1)&&p>=-1e9&&p<=we&&p===Oe(p)){if(E[0]===0){if(p===0&&E.length===1)return!0;break t}if(f=(p+1)%it,f<1&&(f+=it),String(E[0]).length==f){for(f=0;f<E.length;f++)if(g=E[f],g<0||g>=Ye||g!==Oe(g))break t;if(g!==0)return!0}}}else if(E===null&&p===null&&(S===null||S===1||S===-1))return!0;throw Error(he+"Invalid BigNumber: "+u)},v.maximum=v.max=function(){return P(arguments,-1)},v.minimum=v.min=function(){return P(arguments,1)},v.random=function(){var u=9007199254740992,f=Math.random()*u&2097151?function(){return Oe(Math.random()*u)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(g){var E,p,S,C,_,w=0,T=[],b=new v(r);if(g==null?g=o:Mt(g,0,we),C=Aa(g/it),m)if(crypto.getRandomValues){for(E=crypto.getRandomValues(new Uint32Array(C*=2));w<C;)_=E[w]*131072+(E[w+1]>>>11),_>=9e15?(p=crypto.getRandomValues(new Uint32Array(2)),E[w]=p[0],E[w+1]=p[1]):(T.push(_%1e14),w+=2);w=C/2}else if(crypto.randomBytes){for(E=crypto.randomBytes(C*=7);w<C;)_=(E[w]&31)*281474976710656+E[w+1]*1099511627776+E[w+2]*4294967296+E[w+3]*16777216+(E[w+4]<<16)+(E[w+5]<<8)+E[w+6],_>=9e15?crypto.randomBytes(7).copy(E,w):(T.push(_%1e14),w+=7);w=C/7}else throw m=!1,Error(he+"crypto unavailable");if(!m)for(;w<C;)_=f(),_<9e15&&(T[w++]=_%1e14);for(C=T[--w],g%=it,C&&g&&(_=Oa[it-g],T[w]=Oe(C/_)*_);T[w]===0;T.pop(),w--);if(w<0)T=[S=0];else{for(S=-1;T[0]===0;T.splice(0,1),S-=it);for(w=1,_=T[0];_>=10;_/=10,w++);w<it&&(S-=it-w)}return b.e=S,b.c=T,b}}(),v.sum=function(){for(var u=1,f=arguments,g=new v(f[0]);u<f.length;)g=g.plus(f[u++]);return g},e=function(){var u="0123456789";function f(g,E,p,S){for(var C,_=[0],w,T=0,b=g.length;T<b;){for(w=_.length;w--;_[w]*=E);for(_[0]+=S.indexOf(g.charAt(T++)),C=0;C<_.length;C++)_[C]>p-1&&(_[C+1]==null&&(_[C+1]=0),_[C+1]+=_[C]/p|0,_[C]%=p)}return _.reverse()}return function(g,E,p,S,C){var _,w,T,b,L,D,z,F,U=g.indexOf("."),K=o,B=a;for(U>=0&&(b=x,x=0,g=g.replace(".",""),F=new v(E),D=F.pow(g.length-U),x=b,F.c=f(Si(Me(D.c),D.e,"0"),10,p,u),F.e=F.c.length),z=f(g,E,p,C?(_=I,u):(_=u,I)),T=b=z.length;z[--b]==0;z.pop());if(!z[0])return _.charAt(0);if(U<0?--T:(D.c=z,D.e=T,D.s=S,D=t(D,F,K,B,p),z=D.c,L=D.r,T=D.e),w=T+K+1,U=z[w],b=p/2,L=L||w<0||z[w+1]!=null,L=B<4?(U!=null||L)&&(B==0||B==(D.s<0?3:2)):U>b||U==b&&(B==4||L||B==6&&z[w-1]&1||B==(D.s<0?8:7)),w<1||!z[0])g=L?Si(_.charAt(1),-K,_.charAt(0)):_.charAt(0);else{if(z.length=w,L)for(--p;++z[--w]>p;)z[w]=0,w||(++T,z=[1].concat(z));for(b=z.length;!z[--b];);for(U=0,g="";U<=b;g+=_.charAt(z[U++]));g=Si(g,T,_.charAt(0))}return g}}(),t=function(){function u(E,p,S){var C,_,w,T,b=0,L=E.length,D=p%tn,z=p/tn|0;for(E=E.slice();L--;)w=E[L]%tn,T=E[L]/tn|0,C=z*w+T*D,_=D*w+C%tn*tn+b,b=(_/S|0)+(C/tn|0)+z*T,E[L]=_%S;return b&&(E=[b].concat(E)),E}function f(E,p,S,C){var _,w;if(S!=C)w=S>C?1:-1;else for(_=w=0;_<S;_++)if(E[_]!=p[_]){w=E[_]>p[_]?1:-1;break}return w}function g(E,p,S,C){for(var _=0;S--;)E[S]-=_,_=E[S]<p[S]?1:0,E[S]=_*C+E[S]-p[S];for(;!E[0]&&E.length>1;E.splice(0,1));}return function(E,p,S,C,_){var w,T,b,L,D,z,F,U,K,B,X,q,St,It,Ct,pt,Nt,lt=E.s==p.s?1:-1,et=E.c,j=p.c;if(!et||!et[0]||!j||!j[0])return new v(!E.s||!p.s||(et?j&&et[0]==j[0]:!j)?NaN:et&&et[0]==0||!j?lt*0:lt/0);for(U=new v(lt),K=U.c=[],T=E.e-p.e,lt=S+T+1,_||(_=Ye,T=Fe(E.e/it)-Fe(p.e/it),lt=lt/it|0),b=0;j[b]==(et[b]||0);b++);if(j[b]>(et[b]||0)&&T--,lt<0)K.push(1),L=!0;else{for(It=et.length,pt=j.length,b=0,lt+=2,D=Oe(_/(j[0]+1)),D>1&&(j=u(j,D,_),et=u(et,D,_),pt=j.length,It=et.length),St=pt,B=et.slice(0,pt),X=B.length;X<pt;B[X++]=0);Nt=j.slice(),Nt=[0].concat(Nt),Ct=j[0],j[1]>=_/2&&Ct++;do{if(D=0,w=f(j,B,pt,X),w<0){if(q=B[0],pt!=X&&(q=q*_+(B[1]||0)),D=Oe(q/Ct),D>1)for(D>=_&&(D=_-1),z=u(j,D,_),F=z.length,X=B.length;f(z,B,F,X)==1;)D--,g(z,pt<F?Nt:j,F,_),F=z.length,w=1;else D==0&&(w=D=1),z=j.slice(),F=z.length;if(F<X&&(z=[0].concat(z)),g(B,z,X,_),X=B.length,w==-1)for(;f(j,B,pt,X)<1;)D++,g(B,pt<X?Nt:j,X,_),X=B.length}else w===0&&(D++,B=[0]);K[b++]=D,B[0]?B[X++]=et[St]||0:(B=[et[St]],X=1)}while((St++<It||B[0]!=null)&&lt--);L=B[0]!=null,K[0]||K.splice(0,1)}if(_==Ye){for(b=1,lt=K[0];lt>=10;lt/=10,b++);G(U,S+(U.e=b+T*it-1)+1,C,L)}else U.e=T,U.r=+L;return U}}();function A(u,f,g,E){var p,S,C,_,w;if(g==null?g=a:Mt(g,0,8),!u.c)return u.toString();if(p=u.c[0],C=u.e,f==null)w=Me(u.c),w=E==1||E==2&&(C<=l||C>=h)?Zr(w,C):Si(w,C,"0");else if(u=G(new v(u),f,g),S=u.e,w=Me(u.c),_=w.length,E==1||E==2&&(f<=S||S<=l)){for(;_<f;w+="0",_++);w=Zr(w,S)}else if(f-=C,w=Si(w,S,"0"),S+1>_){if(--f>0)for(w+=".";f--;w+="0");}else if(f+=S-_,f>0)for(S+1==_&&(w+=".");f--;w+="0");return u.s<0&&p?"-"+w:w}function P(u,f){for(var g,E,p=1,S=new v(u[0]);p<u.length;p++)E=new v(u[p]),(!E.s||(g=En(S,E))===f||g===0&&S.s===f)&&(S=E);return S}function O(u,f,g){for(var E=1,p=f.length;!f[--p];f.pop());for(p=f[0];p>=10;p/=10,E++);return(g=E+g*it-1)>d?u.c=u.e=null:g<c?u.c=[u.e=0]:(u.e=g,u.c=f),u}i=function(){var u=/^(-?)0([xbo])(?=\w[\w.]*$)/i,f=/^([^.]+)\.$/,g=/^\.([^.]+)$/,E=/^-?(Infinity|NaN)$/,p=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(S,C,_,w){var T,b=_?C:C.replace(p,"");if(E.test(b))S.s=isNaN(b)?null:b<0?-1:1;else{if(!_&&(b=b.replace(u,function(L,D,z){return T=(z=z.toLowerCase())=="x"?16:z=="b"?2:8,!w||w==T?D:L}),w&&(T=w,b=b.replace(f,"$1").replace(g,"0.$1")),C!=b))return new v(b,T);if(v.DEBUG)throw Error(he+"Not a"+(w?" base "+w:"")+" number: "+C);S.s=null}S.c=S.e=null}}();function G(u,f,g,E){var p,S,C,_,w,T,b,L=u.c,D=Oa;if(L){t:{for(p=1,_=L[0];_>=10;_/=10,p++);if(S=f-p,S<0)S+=it,C=f,w=L[T=0],b=Oe(w/D[p-C-1]%10);else if(T=Aa((S+1)/it),T>=L.length)if(E){for(;L.length<=T;L.push(0));w=b=0,p=1,S%=it,C=S-it+1}else break t;else{for(w=_=L[T],p=1;_>=10;_/=10,p++);S%=it,C=S-it+p,b=C<0?0:Oe(w/D[p-C-1]%10)}if(E=E||f<0||L[T+1]!=null||(C<0?w:w%D[p-C-1]),E=g<4?(b||E)&&(g==0||g==(u.s<0?3:2)):b>5||b==5&&(g==4||E||g==6&&(S>0?C>0?w/D[p-C]:0:L[T-1])%10&1||g==(u.s<0?8:7)),f<1||!L[0])return L.length=0,E?(f-=u.e+1,L[0]=D[(it-f%it)%it],u.e=-f||0):L[0]=u.e=0,u;if(S==0?(L.length=T,_=1,T--):(L.length=T+1,_=D[it-S],L[T]=C>0?Oe(w/D[p-C]%D[C])*_:0),E)for(;;)if(T==0){for(S=1,C=L[0];C>=10;C/=10,S++);for(C=L[0]+=_,_=1;C>=10;C/=10,_++);S!=_&&(u.e++,L[0]==Ye&&(L[0]=1));break}else{if(L[T]+=_,L[T]!=Ye)break;L[T--]=0,_=1}for(S=L.length;L[--S]===0;L.pop());}u.e>d?u.c=u.e=null:u.e<c&&(u.c=[u.e=0])}return u}function k(u){var f,g=u.e;return g===null?u.toString():(f=Me(u.c),f=g<=l||g>=h?Zr(f,g):Si(f,g,"0"),u.s<0?"-"+f:f)}return s.absoluteValue=s.abs=function(){var u=new v(this);return u.s<0&&(u.s=1),u},s.comparedTo=function(u,f){return En(this,new v(u,f))},s.decimalPlaces=s.dp=function(u,f){var g,E,p,S=this;if(u!=null)return Mt(u,0,we),f==null?f=a:Mt(f,0,8),G(new v(S),u+S.e+1,f);if(!(g=S.c))return null;if(E=((p=g.length-1)-Fe(this.e/it))*it,p=g[p])for(;p%10==0;p/=10,E--);return E<0&&(E=0),E},s.dividedBy=s.div=function(u,f){return t(this,new v(u,f),o,a)},s.dividedToIntegerBy=s.idiv=function(u,f){return t(this,new v(u,f),0,1)},s.exponentiatedBy=s.pow=function(u,f){var g,E,p,S,C,_,w,T,b,L=this;if(u=new v(u),u.c&&!u.isInteger())throw Error(he+"Exponent not an integer: "+k(u));if(f!=null&&(f=new v(f)),_=u.e>14,!L.c||!L.c[0]||L.c[0]==1&&!L.e&&L.c.length==1||!u.c||!u.c[0])return b=new v(Math.pow(+k(L),_?u.s*(2-Kr(u)):+k(u))),f?b.mod(f):b;if(w=u.s<0,f){if(f.c?!f.c[0]:!f.s)return new v(NaN);E=!w&&L.isInteger()&&f.isInteger(),E&&(L=L.mod(f))}else{if(u.e>9&&(L.e>0||L.e<-1||(L.e==0?L.c[0]>1||_&&L.c[1]>=24e7:L.c[0]<8e13||_&&L.c[0]<=9999975e7)))return S=L.s<0&&Kr(u)?-0:0,L.e>-1&&(S=1/S),new v(w?1/S:S);x&&(S=Aa(x/it+2))}for(_?(g=new v(.5),w&&(u.s=1),T=Kr(u)):(p=Math.abs(+k(u)),T=p%2),b=new v(r);;){if(T){if(b=b.times(L),!b.c)break;S?b.c.length>S&&(b.c.length=S):E&&(b=b.mod(f))}if(p){if(p=Oe(p/2),p===0)break;T=p%2}else if(u=u.times(g),G(u,u.e+1,1),u.e>14)T=Kr(u);else{if(p=+k(u),p===0)break;T=p%2}L=L.times(L),S?L.c&&L.c.length>S&&(L.c.length=S):E&&(L=L.mod(f))}return E?b:(w&&(b=r.div(b)),f?b.mod(f):S?G(b,x,a,C):b)},s.integerValue=function(u){var f=new v(this);return u==null?u=a:Mt(u,0,8),G(f,f.e+1,u)},s.isEqualTo=s.eq=function(u,f){return En(this,new v(u,f))===0},s.isFinite=function(){return!!this.c},s.isGreaterThan=s.gt=function(u,f){return En(this,new v(u,f))>0},s.isGreaterThanOrEqualTo=s.gte=function(u,f){return(f=En(this,new v(u,f)))===1||f===0},s.isInteger=function(){return!!this.c&&Fe(this.e/it)>this.c.length-2},s.isLessThan=s.lt=function(u,f){return En(this,new v(u,f))<0},s.isLessThanOrEqualTo=s.lte=function(u,f){return(f=En(this,new v(u,f)))===-1||f===0},s.isNaN=function(){return!this.s},s.isNegative=function(){return this.s<0},s.isPositive=function(){return this.s>0},s.isZero=function(){return!!this.c&&this.c[0]==0},s.minus=function(u,f){var g,E,p,S,C=this,_=C.s;if(u=new v(u,f),f=u.s,!_||!f)return new v(NaN);if(_!=f)return u.s=-f,C.plus(u);var w=C.e/it,T=u.e/it,b=C.c,L=u.c;if(!w||!T){if(!b||!L)return b?(u.s=-f,u):new v(L?C:NaN);if(!b[0]||!L[0])return L[0]?(u.s=-f,u):new v(b[0]?C:a==3?-0:0)}if(w=Fe(w),T=Fe(T),b=b.slice(),_=w-T){for((S=_<0)?(_=-_,p=b):(T=w,p=L),p.reverse(),f=_;f--;p.push(0));p.reverse()}else for(E=(S=(_=b.length)<(f=L.length))?_:f,_=f=0;f<E;f++)if(b[f]!=L[f]){S=b[f]<L[f];break}if(S&&(p=b,b=L,L=p,u.s=-u.s),f=(E=L.length)-(g=b.length),f>0)for(;f--;b[g++]=0);for(f=Ye-1;E>_;){if(b[--E]<L[E]){for(g=E;g&&!b[--g];b[g]=f);--b[g],b[E]+=Ye}b[E]-=L[E]}for(;b[0]==0;b.splice(0,1),--T);return b[0]?O(u,b,T):(u.s=a==3?-1:1,u.c=[u.e=0],u)},s.modulo=s.mod=function(u,f){var g,E,p=this;return u=new v(u,f),!p.c||!u.s||u.c&&!u.c[0]?new v(NaN):!u.c||p.c&&!p.c[0]?new v(p):(y==9?(E=u.s,u.s=1,g=t(p,u,0,3),u.s=E,g.s*=E):g=t(p,u,0,y),u=p.minus(g.times(u)),!u.c[0]&&y==1&&(u.s=p.s),u)},s.multipliedBy=s.times=function(u,f){var g,E,p,S,C,_,w,T,b,L,D,z,F,U,K,B=this,X=B.c,q=(u=new v(u,f)).c;if(!X||!q||!X[0]||!q[0])return!B.s||!u.s||X&&!X[0]&&!q||q&&!q[0]&&!X?u.c=u.e=u.s=null:(u.s*=B.s,!X||!q?u.c=u.e=null:(u.c=[0],u.e=0)),u;for(E=Fe(B.e/it)+Fe(u.e/it),u.s*=B.s,w=X.length,L=q.length,w<L&&(F=X,X=q,q=F,p=w,w=L,L=p),p=w+L,F=[];p--;F.push(0));for(U=Ye,K=tn,p=L;--p>=0;){for(g=0,D=q[p]%K,z=q[p]/K|0,C=w,S=p+C;S>p;)T=X[--C]%K,b=X[C]/K|0,_=z*T+b*D,T=D*T+_%K*K+F[S]+g,g=(T/U|0)+(_/K|0)+z*b,F[S--]=T%U;F[S]=g}return g?++E:F.splice(0,1),O(u,F,E)},s.negated=function(){var u=new v(this);return u.s=-u.s||null,u},s.plus=function(u,f){var g,E=this,p=E.s;if(u=new v(u,f),f=u.s,!p||!f)return new v(NaN);if(p!=f)return u.s=-f,E.minus(u);var S=E.e/it,C=u.e/it,_=E.c,w=u.c;if(!S||!C){if(!_||!w)return new v(p/0);if(!_[0]||!w[0])return w[0]?u:new v(_[0]?E:p*0)}if(S=Fe(S),C=Fe(C),_=_.slice(),p=S-C){for(p>0?(C=S,g=w):(p=-p,g=_),g.reverse();p--;g.push(0));g.reverse()}for(p=_.length,f=w.length,p-f<0&&(g=w,w=_,_=g,f=p),p=0;f;)p=(_[--f]=_[f]+w[f]+p)/Ye|0,_[f]=Ye===_[f]?0:_[f]%Ye;return p&&(_=[p].concat(_),++C),O(u,_,C)},s.precision=s.sd=function(u,f){var g,E,p,S=this;if(u!=null&&u!==!!u)return Mt(u,1,we),f==null?f=a:Mt(f,0,8),G(new v(S),u,f);if(!(g=S.c))return null;if(p=g.length-1,E=p*it+1,p=g[p]){for(;p%10==0;p/=10,E--);for(p=g[0];p>=10;p/=10,E++);}return u&&S.e+1>E&&(E=S.e+1),E},s.shiftedBy=function(u){return Mt(u,-9007199254740991,gc),this.times("1e"+u)},s.squareRoot=s.sqrt=function(){var u,f,g,E,p,S=this,C=S.c,_=S.s,w=S.e,T=o+4,b=new v("0.5");if(_!==1||!C||!C[0])return new v(!_||_<0&&(!C||C[0])?NaN:C?S:1/0);if(_=Math.sqrt(+k(S)),_==0||_==1/0?(f=Me(C),(f.length+w)%2==0&&(f+="0"),_=Math.sqrt(+f),w=Fe((w+1)/2)-(w<0||w%2),_==1/0?f="5e"+w:(f=_.toExponential(),f=f.slice(0,f.indexOf("e")+1)+w),g=new v(f)):g=new v(_+""),g.c[0]){for(w=g.e,_=w+T,_<3&&(_=0);;)if(p=g,g=b.times(p.plus(t(S,p,T,1))),Me(p.c).slice(0,_)===(f=Me(g.c)).slice(0,_))if(g.e<w&&--_,f=f.slice(_-3,_+1),f=="9999"||!E&&f=="4999"){if(!E&&(G(p,p.e+o+2,0),p.times(p).eq(S))){g=p;break}T+=4,_+=4,E=1}else{(!+f||!+f.slice(1)&&f.charAt(0)=="5")&&(G(g,g.e+o+2,1),u=!g.times(g).eq(S));break}}return G(g,g.e+o+1,a,u)},s.toExponential=function(u,f){return u!=null&&(Mt(u,0,we),u++),A(this,u,f,1)},s.toFixed=function(u,f){return u!=null&&(Mt(u,0,we),u=u+this.e+1),A(this,u,f)},s.toFormat=function(u,f,g){var E,p=this;if(g==null)u!=null&&f&&typeof f=="object"?(g=f,f=null):u&&typeof u=="object"?(g=u,u=f=null):g=R;else if(typeof g!="object")throw Error(he+"Argument not an object: "+g);if(E=p.toFixed(u,f),p.c){var S,C=E.split("."),_=+g.groupSize,w=+g.secondaryGroupSize,T=g.groupSeparator||"",b=C[0],L=C[1],D=p.s<0,z=D?b.slice(1):b,F=z.length;if(w&&(S=_,_=w,w=S,F-=S),_>0&&F>0){for(S=F%_||_,b=z.substr(0,S);S<F;S+=_)b+=T+z.substr(S,_);w>0&&(b+=T+z.slice(S)),D&&(b="-"+b)}E=L?b+(g.decimalSeparator||"")+((w=+g.fractionGroupSize)?L.replace(new RegExp("\\d{"+w+"}\\B","g"),"$&"+(g.fractionGroupSeparator||"")):L):b}return(g.prefix||"")+E+(g.suffix||"")},s.toFraction=function(u){var f,g,E,p,S,C,_,w,T,b,L,D,z=this,F=z.c;if(u!=null&&(_=new v(u),!_.isInteger()&&(_.c||_.s!==1)||_.lt(r)))throw Error(he+"Argument "+(_.isInteger()?"out of range: ":"not an integer: ")+k(_));if(!F)return new v(z);for(f=new v(r),T=g=new v(r),E=w=new v(r),D=Me(F),S=f.e=D.length-z.e-1,f.c[0]=Oa[(C=S%it)<0?it+C:C],u=!u||_.comparedTo(f)>0?S>0?f:T:_,C=d,d=1/0,_=new v(D),w.c[0]=0;b=t(_,f,0,1),p=g.plus(b.times(E)),p.comparedTo(u)!=1;)g=E,E=p,T=w.plus(b.times(p=T)),w=p,f=_.minus(b.times(p=f)),_=p;return p=t(u.minus(g),E,0,1),w=w.plus(p.times(T)),g=g.plus(p.times(E)),w.s=T.s=z.s,S=S*2,L=t(T,E,S,a).minus(z).abs().comparedTo(t(w,g,S,a).minus(z).abs())<1?[T,E]:[w,g],d=C,L},s.toNumber=function(){return+k(this)},s.toPrecision=function(u,f){return u!=null&&Mt(u,1,we),A(this,u,f,2)},s.toString=function(u){var f,g=this,E=g.s,p=g.e;return p===null?E?(f="Infinity",E<0&&(f="-"+f)):f="NaN":(u==null?f=p<=l||p>=h?Zr(Me(g.c),p):Si(Me(g.c),p,"0"):u===10&&M?(g=G(new v(g),o+p+1,a),f=Si(Me(g.c),g.e,"0")):(Mt(u,2,I.length,"Base"),f=e(Si(Me(g.c),p,"0"),10,u,E,!0)),E<0&&g.c[0]&&(f="-"+f)),f},s.valueOf=s.toJSON=function(){return k(this)},s._isBigNumber=!0,s[Symbol.toStringTag]="BigNumber",s[Symbol.for("nodejs.util.inspect.custom")]=s.valueOf,n!=null&&v.set(n),v}function Fe(n){var t=n|0;return n>0||n===t?t:t-1}function Me(n){for(var t,e,i=1,s=n.length,r=n[0]+"";i<s;){for(t=n[i++]+"",e=it-t.length;e--;t="0"+t);r+=t}for(s=r.length;r.charCodeAt(--s)===48;);return r.slice(0,s+1||1)}function En(n,t){var e,i,s=n.c,r=t.c,o=n.s,a=t.s,l=n.e,h=t.e;if(!o||!a)return null;if(e=s&&!s[0],i=r&&!r[0],e||i)return e?i?0:-a:o;if(o!=a)return o;if(e=o<0,i=l==h,!s||!r)return i?0:!s^e?1:-1;if(!i)return l>h^e?1:-1;for(a=(l=s.length)<(h=r.length)?l:h,o=0;o<a;o++)if(s[o]!=r[o])return s[o]>r[o]^e?1:-1;return l==h?0:l>h^e?1:-1}function Mt(n,t,e,i){if(n<t||n>e||n!==Oe(n))throw Error(he+(i||"Argument")+(typeof n=="number"?n<t||n>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function Kr(n){var t=n.c.length-1;return Fe(n.e/it)==t&&n.c[t]%2!=0}function Zr(n,t){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(t<0?"e":"e+")+t}function Si(n,t,e){var i,s;if(t<0){for(s=e+".";++t;s+=e);n=s+n}else if(i=n.length,++t>i){for(s=e,t-=i;--t;s+=e);n+=s}else t<i&&(n=n.slice(0,t)+"."+n.slice(t));return n}var ci=Id(),L_=class{constructor(n){Z(this,"key");Z(this,"left",null);Z(this,"right",null);this.key=n}},ks=class extends L_{constructor(n){super(n)}},M_=class{constructor(){Z(this,"size",0);Z(this,"modificationCount",0);Z(this,"splayCount",0)}splay(n){const t=this.root;if(t==null)return this.compare(n,n),-1;let e=null,i=null,s=null,r=null,o=t;const a=this.compare;let l;for(;;)if(l=a(o.key,n),l>0){let h=o.left;if(h==null||(l=a(h.key,n),l>0&&(o.left=h.right,h.right=o,o=h,h=o.left,h==null)))break;e==null?i=o:e.left=o,e=o,o=h}else if(l<0){let h=o.right;if(h==null||(l=a(h.key,n),l<0&&(o.right=h.left,h.left=o,o=h,h=o.right,h==null)))break;s==null?r=o:s.right=o,s=o,o=h}else break;return s!=null&&(s.right=o.left,o.left=r),e!=null&&(e.left=o.right,o.right=i),this.root!==o&&(this.root=o,this.splayCount++),l}splayMin(n){let t=n,e=t.left;for(;e!=null;){const i=e;t.left=i.right,i.right=t,t=i,e=t.left}return t}splayMax(n){let t=n,e=t.right;for(;e!=null;){const i=e;t.right=i.left,i.left=t,t=i,e=t.right}return t}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let e=this.root;const i=e,s=e.left;if(this.size--,s==null)this.root=e.right;else{const r=e.right;e=this.splayMax(s),e.right=r,this.root=e}return this.modificationCount++,i}addNewRoot(n,t){this.size++,this.modificationCount++;const e=this.root;if(e==null){this.root=n;return}t<0?(n.left=e,n.right=e.right,e.right=null):(n.right=e,n.left=e.left,e.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,t)=>n<t?-1:n>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},Hc,Jc,Co=class Vs extends M_{constructor(e,i){super();Z(this,"root",null);Z(this,"compare");Z(this,"validKey");Z(this,Hc,"[object Set]");this.compare=e??this.defaultCompare(),this.validKey=i??(s=>s!=null&&s!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const i of e)this.delete(i)}forEach(e){const i=this[Symbol.iterator]();let s;for(;s=i.next(),!s.done;)e(s.value,s.value,this)}add(e){const i=this.splay(e);return i!=0&&this.addNewRoot(new ks(e),i),this}addAndReturn(e){const i=this.splay(e);return i!=0&&this.addNewRoot(new ks(e),i),this.root.key}addAll(e){for(const i of e)this.add(i)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let s=this.root.left;if(s==null)return null;let r=s.right;for(;r!=null;)s=r,r=s.right;return s.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let s=this.root.right;if(s==null)return null;let r=s.left;for(;r!=null;)s=r,r=s.left;return s.key}retainAll(e){const i=new Vs(this.compare,this.validKey),s=this.modificationCount;for(const r of e){if(s!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(r)&&this.splay(r)==0&&i.add(this.root.key)}i.size!=this.size&&(this.root=i.root,this.size=i.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const i=new Vs(this.compare,this.validKey);for(const s of this)e.has(s)&&i.add(s);return i}difference(e){const i=new Vs(this.compare,this.validKey);for(const s of this)e.has(s)||i.add(s);return i}union(e){const i=this.clone();return i.addAll(e),i}clone(){const e=new Vs(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function i(r,o){let a,l;do{if(a=r.left,l=r.right,a!=null){const h=new ks(a.key);o.left=h,i(a,h)}if(l!=null){const h=new ks(l.key);o.right=h,r=l,o=h}}while(l!=null)}const s=new ks(e.key);return i(e,s),s}toSet(){return this.clone()}entries(){return new A_(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Jc=Symbol.iterator,Hc=Symbol.toStringTag,Jc)](){return new P_(this.wrap())}},Ld=class{constructor(n){Z(this,"tree");Z(this,"path",new Array);Z(this,"modificationCount",null);Z(this,"splayCount");this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let e=this.tree.getRoot();for(;e!=null;)this.path.push(e),e=e.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],t=n.right;if(t!=null){for(;t!=null;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},P_=class extends Ld{getValue(n){return n.key}},A_=class extends Ld{getValue(n){return[n.key,n.key]}},Md=n=>()=>n,il=n=>{const t=n?(e,i)=>i.minus(e).abs().isLessThanOrEqualTo(n):Md(!1);return(e,i)=>t(e,i)?0:e.comparedTo(i)};function O_(n){const t=n?(e,i,s,r,o)=>e.exponentiatedBy(2).isLessThanOrEqualTo(r.minus(i).exponentiatedBy(2).plus(o.minus(s).exponentiatedBy(2)).times(n)):Md(!1);return(e,i,s)=>{const r=e.x,o=e.y,a=s.x,l=s.y,h=o.minus(l).times(i.x.minus(a)).minus(r.minus(a).times(i.y.minus(l)));return t(h,r,o,a,l)?0:h.comparedTo(0)}}var F_=n=>n,k_=n=>{if(n){const t=new Co(il(n)),e=new Co(il(n)),i=(r,o)=>o.addAndReturn(r),s=r=>({x:i(r.x,t),y:i(r.y,e)});return s({x:new ci(0),y:new ci(0)}),s}return F_},nl=n=>({set:t=>{Ni=nl(t)},reset:()=>nl(n),compare:il(n),snap:k_(n),orient:O_(n)}),Ni=nl(),Ds=(n,t)=>n.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(n.ur.y),sl=(n,t)=>{if(t.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(t.ll.y))return null;const e=n.ll.x.isLessThan(t.ll.x)?t.ll.x:n.ll.x,i=n.ur.x.isLessThan(t.ur.x)?n.ur.x:t.ur.x,s=n.ll.y.isLessThan(t.ll.y)?t.ll.y:n.ll.y,r=n.ur.y.isLessThan(t.ur.y)?n.ur.y:t.ur.y;return{ll:{x:e,y:s},ur:{x:i,y:r}}},to=(n,t)=>n.x.times(t.y).minus(n.y.times(t.x)),Pd=(n,t)=>n.x.times(t.x).plus(n.y.times(t.y)),bo=n=>Pd(n,n).sqrt(),D_=(n,t,e)=>{const i={x:t.x.minus(n.x),y:t.y.minus(n.y)},s={x:e.x.minus(n.x),y:e.y.minus(n.y)};return to(s,i).div(bo(s)).div(bo(i))},N_=(n,t,e)=>{const i={x:t.x.minus(n.x),y:t.y.minus(n.y)},s={x:e.x.minus(n.x),y:e.y.minus(n.y)};return Pd(s,i).div(bo(s)).div(bo(i))},mc=(n,t,e)=>t.y.isZero()?null:{x:n.x.plus(t.x.div(t.y).times(e.minus(n.y))),y:e},pc=(n,t,e)=>t.x.isZero()?null:{x:e,y:n.y.plus(t.y.div(t.x).times(e.minus(n.x)))},G_=(n,t,e,i)=>{if(t.x.isZero())return pc(e,i,n.x);if(i.x.isZero())return pc(n,t,e.x);if(t.y.isZero())return mc(e,i,n.y);if(i.y.isZero())return mc(n,t,e.y);const s=to(t,i);if(s.isZero())return null;const r={x:e.x.minus(n.x),y:e.y.minus(n.y)},o=to(r,t).div(s),a=to(r,i).div(s),l=n.x.plus(a.times(t.x)),h=e.x.plus(o.times(i.x)),c=n.y.plus(a.times(t.y)),d=e.y.plus(o.times(i.y)),m=l.plus(h).div(2),y=c.plus(d).div(2);return{x:m,y}},ni=class Ad{constructor(t,e){Z(this,"point");Z(this,"isLeft");Z(this,"segment");Z(this,"otherSE");Z(this,"consumedBy");t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}static compare(t,e){const i=Ad.comparePoints(t.point,e.point);return i!==0?i:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:To.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x.isLessThan(e.x)?-1:t.x.isGreaterThan(e.x)?1:t.y.isLessThan(e.y)?-1:t.y.isGreaterThan(e.y)?1:0}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let i=0,s=e.length;i<s;i++){const r=e[i];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const i=this.point.events[e];if(i.segment.consumedBy===void 0)for(let s=e+1;s<t;s++){const r=this.point.events[s];r.consumedBy===void 0&&i.otherSE.point.events===r.otherSE.point.events&&i.segment.consume(r.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,i=this.point.events.length;e<i;e++){const s=this.point.events[e];s!==this&&!s.segment.ringOut&&s.segment.isInResult()&&t.push(s)}return t}getLeftmostComparator(t){const e=new Map,i=s=>{const r=s.otherSE;e.set(s,{sine:D_(this.point,t.point,r.point),cosine:N_(this.point,t.point,r.point)})};return(s,r)=>{e.has(s)||i(s),e.has(r)||i(r);const{sine:o,cosine:a}=e.get(s),{sine:l,cosine:h}=e.get(r);return o.isGreaterThanOrEqualTo(0)&&l.isGreaterThanOrEqualTo(0)?a.isLessThan(h)?1:a.isGreaterThan(h)?-1:0:o.isLessThan(0)&&l.isLessThan(0)?a.isLessThan(h)?-1:a.isGreaterThan(h)?1:0:l.isLessThan(o)?-1:l.isGreaterThan(o)?1:0}}},z_=class rl{constructor(t){Z(this,"events");Z(this,"poly");Z(this,"_isExteriorRing");Z(this,"_enclosingRing");this.events=t;for(let e=0,i=t.length;e<i;e++)t[e].segment.ringOut=this;this.poly=null}static factory(t){const e=[];for(let i=0,s=t.length;i<s;i++){const r=t[i];if(!r.isInResult()||r.ringOut)continue;let o=null,a=r.leftSE,l=r.rightSE;const h=[a],c=a.point,d=[];for(;o=a,a=l,h.push(a),a.point!==c;)for(;;){const m=a.getAvailableLinkedEvents();if(m.length===0){const R=h[0].point,I=h[h.length-1].point;throw new Error(`Unable to complete output ring starting at [${R.x}, ${R.y}]. Last matching segment found ends at [${I.x}, ${I.y}].`)}if(m.length===1){l=m[0].otherSE;break}let y=null;for(let R=0,I=d.length;R<I;R++)if(d[R].point===a.point){y=R;break}if(y!==null){const R=d.splice(y)[0],I=h.splice(R.index);I.unshift(I[0].otherSE),e.push(new rl(I.reverse()));continue}d.push({index:h.length,point:a.point});const x=a.getLeftmostComparator(o);l=m.sort(x)[0].otherSE;break}e.push(new rl(h))}return e}getGeom(){let t=this.events[0].point;const e=[t];for(let h=1,c=this.events.length-1;h<c;h++){const d=this.events[h].point,m=this.events[h+1].point;Ni.orient(d,t,m)!==0&&(e.push(d),t=d)}if(e.length===1)return null;const i=e[0],s=e[1];Ni.orient(i,t,s)===0&&e.shift(),e.push(e[0]);const r=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:e.length-1,a=this.isExteriorRing()?e.length:-1,l=[];for(let h=o;h!=a;h+=r)l.push([e[h].x.toNumber(),e[h].y.toNumber()]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var s,r;let t=this.events[0];for(let o=1,a=this.events.length;o<a;o++){const l=this.events[o];ni.compare(t,l)>0&&(t=l)}let e=t.segment.prevInResult(),i=e?e.prevInResult():null;for(;;){if(!e)return null;if(!i)return e.ringOut;if(i.ringOut!==e.ringOut)return((s=i.ringOut)==null?void 0:s.enclosingRing())!==e.ringOut?e.ringOut:(r=e.ringOut)==null?void 0:r.enclosingRing();e=i.prevInResult(),i=e?e.prevInResult():null}}},_c=class{constructor(n){Z(this,"exteriorRing");Z(this,"interiorRings");this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const t=[n];for(let e=0,i=this.interiorRings.length;e<i;e++){const s=this.interiorRings[e].getGeom();s!==null&&t.push(s)}return t}},$_=class{constructor(n){Z(this,"rings");Z(this,"polys");this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let t=0,e=this.polys.length;t<e;t++){const i=this.polys[t].getGeom();i!==null&&n.push(i)}return n}_composePolys(n){var e;const t=[];for(let i=0,s=n.length;i<s;i++){const r=n[i];if(!r.poly)if(r.isExteriorRing())t.push(new _c(r));else{const o=r.enclosingRing();o!=null&&o.poly||t.push(new _c(o)),(e=o==null?void 0:o.poly)==null||e.addInterior(r)}}return t}},W_=class{constructor(n,t=To.compare){Z(this,"queue");Z(this,"tree");Z(this,"segments");this.queue=n,this.tree=new Co(t),this.segments=[]}process(n){const t=n.segment,e=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(t),e;n.isLeft&&this.tree.add(t);let i=t,s=t;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do s=this.tree.firstAfter(s);while(s!=null&&s.consumedBy!=null);if(n.isLeft){let r=null;if(i){const a=i.getIntersection(t);if(a!==null&&(t.isAnEndpoint(a)||(r=a),!i.isAnEndpoint(a))){const l=this._splitSafely(i,a);for(let h=0,c=l.length;h<c;h++)e.push(l[h])}}let o=null;if(s){const a=s.getIntersection(t);if(a!==null&&(t.isAnEndpoint(a)||(o=a),!s.isAnEndpoint(a))){const l=this._splitSafely(s,a);for(let h=0,c=l.length;h<c;h++)e.push(l[h])}}if(r!==null||o!==null){let a=null;r===null?a=o:o===null?a=r:a=ni.comparePoints(r,o)<=0?r:o,this.queue.delete(t.rightSE),e.push(t.rightSE);const l=t.split(a);for(let h=0,c=l.length;h<c;h++)e.push(l[h])}e.length>0?(this.tree.delete(t),e.push(n)):(this.segments.push(t),t.prev=i)}else{if(i&&s){const r=i.getIntersection(s);if(r!==null){if(!i.isAnEndpoint(r)){const o=this._splitSafely(i,r);for(let a=0,l=o.length;a<l;a++)e.push(o[a])}if(!s.isAnEndpoint(r)){const o=this._splitSafely(s,r);for(let a=0,l=o.length;a<l;a++)e.push(o[a])}}}this.tree.delete(t)}return e}_splitSafely(n,t){this.tree.delete(n);const e=n.rightSE;this.queue.delete(e);const i=n.split(t);return i.push(e),n.consumedBy===void 0&&this.tree.add(n),i}},B_=class{constructor(){Z(this,"type");Z(this,"numMultiPolys")}run(n,t,e){qs.type=n;const i=[new xc(t,!0)];for(let h=0,c=e.length;h<c;h++)i.push(new xc(e[h],!1));if(qs.numMultiPolys=i.length,qs.type==="difference"){const h=i[0];let c=1;for(;c<i.length;)sl(i[c].bbox,h.bbox)!==null?c++:i.splice(c,1)}if(qs.type==="intersection")for(let h=0,c=i.length;h<c;h++){const d=i[h];for(let m=h+1,y=i.length;m<y;m++)if(sl(d.bbox,i[m].bbox)===null)return[]}const s=new Co(ni.compare);for(let h=0,c=i.length;h<c;h++){const d=i[h].getSweepEvents();for(let m=0,y=d.length;m<y;m++)s.add(d[m])}const r=new W_(s);let o=null;for(s.size!=0&&(o=s.first(),s.delete(o));o;){const h=r.process(o);for(let c=0,d=h.length;c<d;c++){const m=h[c];m.consumedBy===void 0&&s.add(m)}s.size!=0?(o=s.first(),s.delete(o)):o=null}Ni.reset();const a=z_.factory(r.segments);return new $_(a).getGeom()}},qs=new B_,ol=qs,X_=0,To=class eo{constructor(t,e,i,s){Z(this,"id");Z(this,"leftSE");Z(this,"rightSE");Z(this,"rings");Z(this,"windings");Z(this,"ringOut");Z(this,"consumedBy");Z(this,"prev");Z(this,"_prevInResult");Z(this,"_beforeState");Z(this,"_afterState");Z(this,"_isInResult");this.id=++X_,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=i,this.windings=s}static compare(t,e){const i=t.leftSE.point.x,s=e.leftSE.point.x,r=t.rightSE.point.x,o=e.rightSE.point.x;if(o.isLessThan(i))return 1;if(r.isLessThan(s))return-1;const a=t.leftSE.point.y,l=e.leftSE.point.y,h=t.rightSE.point.y,c=e.rightSE.point.y;if(i.isLessThan(s)){if(l.isLessThan(a)&&l.isLessThan(h))return 1;if(l.isGreaterThan(a)&&l.isGreaterThan(h))return-1;const d=t.comparePoint(e.leftSE.point);if(d<0)return 1;if(d>0)return-1;const m=e.comparePoint(t.rightSE.point);return m!==0?m:-1}if(i.isGreaterThan(s)){if(a.isLessThan(l)&&a.isLessThan(c))return-1;if(a.isGreaterThan(l)&&a.isGreaterThan(c))return 1;const d=e.comparePoint(t.leftSE.point);if(d!==0)return d;const m=t.comparePoint(e.rightSE.point);return m<0?1:m>0?-1:1}if(a.isLessThan(l))return-1;if(a.isGreaterThan(l))return 1;if(r.isLessThan(o)){const d=e.comparePoint(t.rightSE.point);if(d!==0)return d}if(r.isGreaterThan(o)){const d=t.comparePoint(e.rightSE.point);if(d<0)return 1;if(d>0)return-1}if(!r.eq(o)){const d=h.minus(a),m=r.minus(i),y=c.minus(l),x=o.minus(s);if(d.isGreaterThan(m)&&y.isLessThan(x))return 1;if(d.isLessThan(m)&&y.isGreaterThan(x))return-1}return r.isGreaterThan(o)?1:r.isLessThan(o)||h.isLessThan(c)?-1:h.isGreaterThan(c)?1:t.id<e.id?-1:t.id>e.id?1:0}static fromRing(t,e,i){let s,r,o;const a=ni.comparePoints(t,e);if(a<0)s=t,r=e,o=1;else if(a>0)s=e,r=t,o=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const l=new ni(s,!0),h=new ni(r,!1);return new eo(l,h,[i],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(e)?t:e},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(e)?t:e}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return Ni.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){const e=this.bbox(),i=t.bbox(),s=sl(e,i);if(s===null)return null;const r=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,l=t.rightSE.point,h=Ds(e,a)&&this.comparePoint(a)===0,c=Ds(i,r)&&t.comparePoint(r)===0,d=Ds(e,l)&&this.comparePoint(l)===0,m=Ds(i,o)&&t.comparePoint(o)===0;if(c&&h)return m&&!d?o:!m&&d?l:null;if(c)return d&&r.x.eq(l.x)&&r.y.eq(l.y)?null:r;if(h)return m&&o.x.eq(a.x)&&o.y.eq(a.y)?null:a;if(m&&d)return null;if(m)return o;if(d)return l;const y=G_(r,this.vector(),a,t.vector());return y===null||!Ds(s,y)?null:Ni.snap(y)}split(t){const e=[],i=t.events!==void 0,s=new ni(t,!0),r=new ni(t,!1),o=this.rightSE;this.replaceRightSE(r),e.push(r),e.push(s);const a=new eo(s,o,this.rings.slice(),this.windings.slice());return ni.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),ni.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(s.checkForConsuming(),r.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,i=this.windings.length;e<i;e++)this.windings[e]*=-1}consume(t){let e=this,i=t;for(;e.consumedBy;)e=e.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const s=eo.compare(e,i);if(s!==0){if(s>0){const r=e;e=i,i=r}if(e.prev===i){const r=e;e=i,i=r}for(let r=0,o=i.rings.length;r<o;r++){const a=i.rings[r],l=i.windings[r],h=e.rings.indexOf(a);h===-1?(e.rings.push(a),e.windings.push(l)):e.windings[h]+=l}i.rings=null,i.windings=null,i.consumedBy=e,i.leftSE.consumedBy=e.leftSE,i.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,i=this._afterState.windings,s=this._afterState.multiPolys;for(let a=0,l=this.rings.length;a<l;a++){const h=this.rings[a],c=this.windings[a],d=e.indexOf(h);d===-1?(e.push(h),i.push(c)):i[d]+=c}const r=[],o=[];for(let a=0,l=e.length;a<l;a++){if(i[a]===0)continue;const h=e[a],c=h.poly;if(o.indexOf(c)===-1)if(h.isExterior)r.push(c);else{o.indexOf(c)===-1&&o.push(c);const d=r.indexOf(h.poly);d!==-1&&r.splice(d,1)}}for(let a=0,l=r.length;a<l;a++){const h=r[a].multiPoly;s.indexOf(h)===-1&&s.push(h)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(ol.type){case"union":{const i=t.length===0,s=e.length===0;this._isInResult=i!==s;break}case"intersection":{let i,s;t.length<e.length?(i=t.length,s=e.length):(i=e.length,s=t.length),this._isInResult=s===ol.numMultiPolys&&i<s;break}case"xor":{const i=Math.abs(t.length-e.length);this._isInResult=i%2===1;break}case"difference":{const i=s=>s.length===1&&s[0].isSubject;this._isInResult=i(t)!==i(e);break}}return this._isInResult}},yc=class{constructor(n,t,e){Z(this,"poly");Z(this,"isExterior");Z(this,"segments");Z(this,"bbox");if(!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=e,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Ni.snap({x:new ci(n[0][0]),y:new ci(n[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let s=i;for(let r=1,o=n.length;r<o;r++){if(typeof n[r][0]!="number"||typeof n[r][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=Ni.snap({x:new ci(n[r][0]),y:new ci(n[r][1])});a.x.eq(s.x)&&a.y.eq(s.y)||(this.segments.push(To.fromRing(s,a,this)),a.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.x),a.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.y),a.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.x),a.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.y),s=a)}(!i.x.eq(s.x)||!i.y.eq(s.y))&&this.segments.push(To.fromRing(s,i,this))}getSweepEvents(){const n=[];for(let t=0,e=this.segments.length;t<e;t++){const i=this.segments[t];n.push(i.leftSE),n.push(i.rightSE)}return n}},U_=class{constructor(n,t){Z(this,"multiPoly");Z(this,"exteriorRing");Z(this,"interiorRings");Z(this,"bbox");if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new yc(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,i=n.length;e<i;e++){const s=new yc(n[e],this,!1);s.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=t}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let t=0,e=this.interiorRings.length;t<e;t++){const i=this.interiorRings[t].getSweepEvents();for(let s=0,r=i.length;s<r;s++)n.push(i[s])}return n}},xc=class{constructor(n,t){Z(this,"isSubject");Z(this,"polys");Z(this,"bbox");if(!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new ci(Number.POSITIVE_INFINITY),y:new ci(Number.POSITIVE_INFINITY)},ur:{x:new ci(Number.NEGATIVE_INFINITY),y:new ci(Number.NEGATIVE_INFINITY)}};for(let e=0,i=n.length;e<i;e++){const s=new U_(n[e],this);s.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=t}getSweepEvents(){const n=[];for(let t=0,e=this.polys.length;t<e;t++){const i=this.polys[t].getSweepEvents();for(let s=0,r=i.length;s<r;s++)n.push(i[s])}return n}},Y_=(n,...t)=>ol.run("intersection",n,t);Ni.set;function j_(n,t={}){const e=[];if(R_(n,s=>{e.push(s.coordinates)}),e.length<2)throw new Error("Must specify at least 2 geometries");const i=Y_(e[0],...e.slice(1));return i.length===0?null:i.length===1?Td(i[0],t.properties):Rd(i,t.properties)}const Pn={dogPark:new Ve({fill:new fi({color:"rgba(196, 111, 247, 0.76)"}),stroke:new Oi({color:"#8a0fd5c2",width:1})}),filtered:new Ve({fill:new fi({color:"rgba(255, 20, 147, 0.4)"}),stroke:new Oi({color:"#FF1493",width:2})}),hovered:new Ve({fill:new fi({color:"rgba(255, 0, 255, 0.7)"}),stroke:new Oi({color:"rgb(255, 0, 255)",width:1})})},K_=n=>n?n.startsWith("http://")||n.startsWith("https://")?n:"https://"+n:"",Z_=(n,t,e,i,s,r,o,a,l,h)=>{const c=`${i} ${s}`;return`
      <div class="popup-title">${n}</div> 
      <p><strong>Address:</strong> ${t}</p>
      <p>${e}</p>
      <p>${l?"Enclosed ":"Not enclosed"}</p>
      <p><strong>Local Government:</strong> ${c}</p>
      <p><strong>Phone:</strong> ${r}</p>
      <p><strong>Email:</strong> ${o}</p>
      <p><strong>Website:</strong> <a href="${K_(a)}" target="_blank">${a}</a></p>
      <button onclick="window.open('https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(h)}', '_blank')" style="background: #6600cc; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;">Get Directions <i class= 'fas fa-paw'></i>
    </button>
    `};var V_=Object.defineProperty,Od=n=>{throw TypeError(n)},q_=(n,t,e)=>t in n?V_(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,Y=(n,t,e)=>q_(n,typeof t!="symbol"?t+"":t,e),Fd=(n,t,e)=>t.has(n)||Od("Cannot "+e),zt=(n,t,e)=>(Fd(n,t,"read from private field"),e?e.call(n):t.get(n)),Ec=(n,t,e)=>t.has(n)?Od("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),vc=(n,t,e,i)=>(Fd(n,t,"write to private field"),t.set(n,e),e);function Ot(){}function H_(n,t){for(const e in t)n[e]=t[e];return n}function kd(n){return n()}function wc(){return Object.create(null)}function Bi(n){n.forEach(kd)}function Dd(n){return typeof n=="function"}function $n(n,t){return n!=n?t==t:n!==t||n&&typeof n=="object"||typeof n=="function"}let Vr;function ee(n,t){return n===t?!0:(Vr||(Vr=document.createElement("a")),Vr.href=t,n===Vr.href)}function J_(n){return Object.keys(n).length===0}function Q_(n,t,e,i){if(n){const s=Nd(n,t,e,i);return n[0](s)}}function Nd(n,t,e,i){return n[1]&&i?H_(e.ctx.slice(),n[1](i(t))):e.ctx}function ty(n,t,e,i){return n[2],t.dirty}function ey(n,t,e,i,s,r){if(s){const o=Nd(t,e,i,r);n.p(o,s)}}function iy(n){if(n.ctx.length>32){const t=[],e=n.ctx.length/32;for(let i=0;i<e;i++)t[i]=-1;return t}return-1}function Ro(n){return n??""}function ct(n,t){n.appendChild(t)}function Rt(n,t,e){n.insertBefore(t,e||null)}function bt(n){n.parentNode&&n.parentNode.removeChild(n)}function vt(n){return document.createElement(n)}function Fi(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function dn(n){return document.createTextNode(n)}function be(){return dn(" ")}function ny(){return dn("")}function Bt(n,t,e,i){return n.addEventListener(t,e,i),()=>n.removeEventListener(t,e,i)}function sy(n){return function(t){return t.preventDefault(),n.call(this,t)}}function $(n,t,e){e==null?n.removeAttribute(t):n.getAttribute(t)!==e&&n.setAttribute(t,e)}function ry(n){return Array.from(n.childNodes)}function pr(n,t){t=""+t,n.data!==t&&(n.data=t)}function Sc(n,t){n.value=t??""}function hs(n,t,e){n.classList.toggle(t,!!e)}function oy(n,t,{bubbles:e=!1,cancelable:i=!1}={}){return new CustomEvent(n,{detail:t,bubbles:e,cancelable:i})}let _r;function er(n){_r=n}function Gd(){if(!_r)throw new Error("Function called outside component initialization");return _r}function ay(n){Gd().$$.on_destroy.push(n)}function zd(){const n=Gd();return(t,e,{cancelable:i=!1}={})=>{const s=n.$$.callbacks[t];if(s){const r=oy(t,e,{cancelable:i});return s.slice().forEach(o=>{o.call(n,r)}),!r.defaultPrevented}return!0}}function ly(n,t){const e=n.$$.callbacks[t.type];e&&e.slice().forEach(i=>i.call(this,t))}const ss=[],al=[];let fs=[];const Cc=[],hy=Promise.resolve();let ll=!1;function cy(){ll||(ll=!0,hy.then($d))}function hl(n){fs.push(n)}const Fa=new Set;let Qn=0;function $d(){if(Qn!==0)return;const n=_r;do{try{for(;Qn<ss.length;){const t=ss[Qn];Qn++,er(t),uy(t.$$)}}catch(t){throw ss.length=0,Qn=0,t}for(er(null),ss.length=0,Qn=0;al.length;)al.pop()();for(let t=0;t<fs.length;t+=1){const e=fs[t];Fa.has(e)||(Fa.add(e),e())}fs.length=0}while(ss.length);for(;Cc.length;)Cc.pop()();ll=!1,Fa.clear(),er(n)}function uy(n){if(n.fragment!==null){n.update(),Bi(n.before_update);const t=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,t),n.after_update.forEach(hl)}}function dy(n){const t=[],e=[];fs.forEach(i=>n.indexOf(i)===-1?t.push(i):e.push(i)),e.forEach(i=>i()),fs=t}const io=new Set;let Rn;function no(){Rn={r:0,c:[],p:Rn}}function so(){Rn.r||Bi(Rn.c),Rn=Rn.p}function Dt(n,t){n&&n.i&&(io.delete(n),n.i(t))}function Yt(n,t,e,i){if(n&&n.o){if(io.has(n))return;io.add(n),Rn.c.push(()=>{io.delete(n),i&&(e&&n.d(1),i())}),n.o(t)}else i&&i()}function bc(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function fy(n,t){Yt(n,1,1,()=>{t.delete(n.key)})}function gy(n,t,e,i,s,r,o,a,l,h,c,d){let m=n.length,y=r.length,x=m;const R={};for(;x--;)R[n[x].key]=x;const I=[],M=new Map,v=new Map,A=[];for(x=y;x--;){const k=d(s,r,x),u=e(k);let f=o.get(u);f?A.push(()=>f.p(k,t)):(f=h(u,k),f.c()),M.set(u,I[x]=f),u in R&&v.set(u,Math.abs(x-R[u]))}const P=new Set,O=new Set;function G(k){Dt(k,1),k.m(a,c),o.set(k.key,k),c=k.first,y--}for(;m&&y;){const k=I[y-1],u=n[m-1],f=k.key,g=u.key;k===u?(c=k.first,m--,y--):M.has(g)?!o.has(f)||P.has(f)?G(k):O.has(g)?m--:v.get(f)>v.get(g)?(O.add(f),G(k)):(P.add(g),m--):(l(u,o),m--)}for(;m--;){const k=n[m];M.has(k.key)||l(k,o)}for(;y;)G(I[y-1]);return Bi(A),I}function fn(n){n&&n.c()}function Gi(n,t,e){const{fragment:i,after_update:s}=n.$$;i&&i.m(t,e),hl(()=>{const r=n.$$.on_mount.map(kd).filter(Dd);n.$$.on_destroy?n.$$.on_destroy.push(...r):Bi(r),n.$$.on_mount=[]}),s.forEach(hl)}function zi(n,t){const e=n.$$;e.fragment!==null&&(dy(e.after_update),Bi(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function my(n,t){n.$$.dirty[0]===-1&&(ss.push(n),cy(),n.$$.dirty.fill(0)),n.$$.dirty[t/31|0]|=1<<t%31}function Wn(n,t,e,i,s,r,o=null,a=[-1]){const l=_r;er(n);const h=n.$$={fragment:null,ctx:[],props:r,update:Ot,not_equal:s,bound:wc(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:wc(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};o&&o(h.root);let c=!1;if(h.ctx=e?e(n,t.props||{},(d,m,...y)=>{const x=y.length?y[0]:m;return h.ctx&&s(h.ctx[d],h.ctx[d]=x)&&(!h.skip_bound&&h.bound[d]&&h.bound[d](x),c&&my(n,d)),m}):[],h.update(),c=!0,Bi(h.before_update),h.fragment=i?i(h.ctx):!1,t.target){if(t.hydrate){const d=ry(t.target);h.fragment&&h.fragment.l(d),d.forEach(bt)}else h.fragment&&h.fragment.c();t.intro&&Dt(n.$$.fragment),Gi(n,t.target,t.anchor),$d()}er(l)}class Bn{constructor(){Y(this,"$$"),Y(this,"$$set")}$destroy(){zi(this,1),this.$destroy=Ot}$on(t,e){if(!Dd(e))return Ot;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(e),()=>{const s=i.indexOf(e);s!==-1&&i.splice(s,1)}}$set(t){this.$$set&&!J_(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const py="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(py);function _y(n){let t,e;return{c(){t=Fi("svg"),e=Fi("path"),$(e,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),$(t,"viewBox","0 0 14 14"),$(t,"width","13"),$(t,"height","13"),$(t,"class","svelte-en2qvf")},m(i,s){Rt(i,t,s),ct(t,e)},p:Ot,i:Ot,o:Ot,d(i){i&&bt(t)}}}class Wd extends Bn{constructor(t){super(),Wn(this,t,null,_y,$n,{})}}function yy(n){let t,e;return{c(){t=Fi("svg"),e=Fi("path"),$(e,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),$(t,"viewBox","0 0 30 30"),$(t,"fill","none"),$(t,"xmlns","http://www.w3.org/2000/svg"),$(t,"class","svelte-d2loi5")},m(i,s){Rt(i,t,s),ct(t,e)},p:Ot,i:Ot,o:Ot,d(i){i&&bt(t)}}}class Bd extends Bn{constructor(t){super(),Wn(this,t,null,yy,$n,{})}}function xy(n){let t,e;return{c(){t=vt("img"),ee(t.src,e=n[3]+"area.svg")||$(t,"src",e),$(t,"alt",n[7]),$(t,"title",n[7]),$(t,"class","svelte-w9y5n9")},m(i,s){Rt(i,t,s)},p(i,s){s&8&&!ee(t.src,e=i[3]+"area.svg")&&$(t,"src",e),s&128&&$(t,"alt",i[7]),s&128&&$(t,"title",i[7])},d(i){i&&bt(t)}}}function Ey(n){let t,e;return{c(){t=vt("img"),ee(t.src,e=n[3]+"reverse.svg")||$(t,"src",e),$(t,"alt",n[7]),$(t,"title",n[7]),$(t,"class","svelte-w9y5n9")},m(i,s){Rt(i,t,s)},p(i,s){s&8&&!ee(t.src,e=i[3]+"reverse.svg")&&$(t,"src",e),s&128&&$(t,"alt",i[7]),s&128&&$(t,"title",i[7])},d(i){i&&bt(t)}}}function vy(n){let t,e;return{c(){t=vt("img"),ee(t.src,e=n[3]+"poi.svg")||$(t,"src",e),$(t,"alt",n[7]),$(t,"title",n[7]),$(t,"class","svelte-w9y5n9")},m(i,s){Rt(i,t,s)},p(i,s){s&8&&!ee(t.src,e=i[3]+"poi.svg")&&$(t,"src",e),s&128&&$(t,"alt",i[7]),s&128&&$(t,"title",i[7])},d(i){i&&bt(t)}}}function wy(n){let t,e;return{c(){t=vt("img"),ee(t.src,e=n[3]+"postal_code.svg")||$(t,"src",e),$(t,"alt",n[7]),$(t,"title",n[7]),$(t,"class","svelte-w9y5n9")},m(i,s){Rt(i,t,s)},p(i,s){s&8&&!ee(t.src,e=i[3]+"postal_code.svg")&&$(t,"src",e),s&128&&$(t,"alt",i[7]),s&128&&$(t,"title",i[7])},d(i){i&&bt(t)}}}function Sy(n){let t,e;return{c(){t=vt("img"),ee(t.src,e=n[3]+"street.svg")||$(t,"src",e),$(t,"alt",n[7]),$(t,"title",n[7]),$(t,"class","svelte-w9y5n9")},m(i,s){Rt(i,t,s)},p(i,s){s&8&&!ee(t.src,e=i[3]+"street.svg")&&$(t,"src",e),s&128&&$(t,"alt",i[7]),s&128&&$(t,"title",i[7])},d(i){i&&bt(t)}}}function Cy(n){let t,e;return{c(){t=vt("img"),ee(t.src,e=n[3]+"road.svg")||$(t,"src",e),$(t,"alt",n[7]),$(t,"title",n[7]),$(t,"class","svelte-w9y5n9")},m(i,s){Rt(i,t,s)},p(i,s){s&8&&!ee(t.src,e=i[3]+"road.svg")&&$(t,"src",e),s&128&&$(t,"alt",i[7]),s&128&&$(t,"title",i[7])},d(i){i&&bt(t)}}}function by(n){let t,e;return{c(){t=vt("img"),ee(t.src,e=n[3]+"housenumber.svg")||$(t,"src",e),$(t,"alt",n[7]),$(t,"title",n[7]),$(t,"class","svelte-w9y5n9")},m(i,s){Rt(i,t,s)},p(i,s){s&8&&!ee(t.src,e=i[3]+"housenumber.svg")&&$(t,"src",e),s&128&&$(t,"alt",i[7]),s&128&&$(t,"title",i[7])},d(i){i&&bt(t)}}}function Ty(n){let t,e,i,s;return{c(){t=vt("img"),ee(t.src,e=n[5])||$(t,"src",e),$(t,"alt",n[4]),$(t,"title",n[7]),$(t,"class","svelte-w9y5n9")},m(r,o){Rt(r,t,o),i||(s=Bt(t,"error",n[14]),i=!0)},p(r,o){o&32&&!ee(t.src,e=r[5])&&$(t,"src",e),o&16&&$(t,"alt",r[4]),o&128&&$(t,"title",r[7])},d(r){r&&bt(t),i=!1,s()}}}function Ry(n){let t,e;return{c(){t=vt("div"),$(t,"class","sprite-icon svelte-w9y5n9"),$(t,"style",e=`
        width: ${n[6].width/Pe}px;
        height: ${n[6].height/Pe}px;
        background-image: url(${n[3]}sprite${cl}.png);
        background-position: -${n[6].x/Pe}px -${n[6].y/Pe}px;
        background-size: ${ai.width/Pe}px ${ai.height/Pe}px;
      `),$(t,"title",n[7])},m(i,s){Rt(i,t,s)},p(i,s){s&72&&e!==(e=`
        width: ${i[6].width/Pe}px;
        height: ${i[6].height/Pe}px;
        background-image: url(${i[3]}sprite${cl}.png);
        background-position: -${i[6].x/Pe}px -${i[6].y/Pe}px;
        background-size: ${ai.width/Pe}px ${ai.height/Pe}px;
      `)&&$(t,"style",e),s&128&&$(t,"title",i[7])},d(i){i&&bt(t)}}}function Tc(n){let t,e;return{c(){t=vt("span"),e=dn(n[7]),$(t,"class","secondary svelte-w9y5n9")},m(i,s){Rt(i,t,s),ct(t,e)},p(i,s){s&128&&pr(e,i[7])},d(i){i&&bt(t)}}}function Iy(n){let t,e,i,s,r,o,a,l,h,c=(n[8]?n[0].place_name:n[0].place_name.replace(/,.*/,""))+"",d,m,y=n[2]==="always"||n[2]!=="never"&&!n[0].address&&!n[0].id.startsWith("road.")&&!n[0].id.startsWith("address.")&&!n[0].id.startsWith("postal_code.")&&(!n[0].id.startsWith("poi.")||!n[5])&&!n[8],x,R,I=(n[8]?"":n[0].place_name.replace(/[^,]*,?\s*/,""))+"",M,v,A,P,O,G;function k(E,p){return p&1&&(e=null),p&1&&(i=null),p&1&&(s=null),p&1&&(r=null),ai&&E[6]?Ry:E[5]?Ty:E[0].address?by:(e==null&&(e=!!E[0].id.startsWith("road.")),e?Cy:(i==null&&(i=!!E[0].id.startsWith("address.")),i?Sy:(s==null&&(s=!!E[0].id.startsWith("postal_code.")),s?wy:(r==null&&(r=!!E[0].id.startsWith("poi.")),r?vy:E[8]?Ey:xy))))}let u=k(n,-1),f=u(n),g=y&&Tc(n);return{c(){t=vt("li"),f.c(),o=be(),a=vt("span"),l=vt("span"),h=vt("span"),d=dn(c),m=be(),g&&g.c(),x=be(),R=vt("span"),M=dn(I),$(h,"class","primary svelte-w9y5n9"),$(l,"class","svelte-w9y5n9"),$(R,"class","line2 svelte-w9y5n9"),$(a,"class","texts svelte-w9y5n9"),$(t,"tabindex","-1"),$(t,"role","option"),$(t,"aria-selected",v=n[1]==="selected"),$(t,"aria-checked",A=n[1]==="picked"),$(t,"class",P=Ro(n[1])+" svelte-w9y5n9")},m(E,p){Rt(E,t,p),f.m(t,null),ct(t,o),ct(t,a),ct(a,l),ct(l,h),ct(h,d),ct(l,m),g&&g.m(l,null),ct(a,x),ct(a,R),ct(R,M),O||(G=[Bt(t,"mouseenter",n[13]),Bt(t,"focus",n[15]),Bt(t,"click",n[16])],O=!0)},p(E,[p]){u===(u=k(E,p))&&f?f.p(E,p):(f.d(1),f=u(E),f&&(f.c(),f.m(t,o))),p&257&&c!==(c=(E[8]?E[0].place_name:E[0].place_name.replace(/,.*/,""))+"")&&pr(d,c),p&293&&(y=E[2]==="always"||E[2]!=="never"&&!E[0].address&&!E[0].id.startsWith("road.")&&!E[0].id.startsWith("address.")&&!E[0].id.startsWith("postal_code.")&&(!E[0].id.startsWith("poi.")||!E[5])&&!E[8]),y?g?g.p(E,p):(g=Tc(E),g.c(),g.m(l,null)):g&&(g.d(1),g=null),p&257&&I!==(I=(E[8]?"":E[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&pr(M,I),p&2&&v!==(v=E[1]==="selected")&&$(t,"aria-selected",v),p&2&&A!==(A=E[1]==="picked")&&$(t,"aria-checked",A),p&2&&P!==(P=Ro(E[1])+" svelte-w9y5n9")&&$(t,"class",P)},i:Ot,o:Ot,d(E){E&&bt(t),f.d(),g&&g.d(),O=!1,Bi(G)}}}const Xd=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,cl=Xd?"@2x":"",Pe=Xd?2:1;let ai,qr;function Ly(n,t,e){let i,s,r,{feature:o}=t,{style:a="default"}=t,{showPlaceType:l}=t,{missingIconsCache:h}=t,{iconsBaseUrl:c}=t;const d=zd();let m,y,x,R;function I(){qr??(qr=fetch(`${c}sprite${cl}.json`).then(u=>u.json()).then(u=>{ai=u}).catch(()=>{ai=null}))}function M(){y&&h.add(y),v()}function v(){ai!==void 0?A():(I(),qr==null||qr.then(A))}function A(){do{if(R--,e(4,m=i==null?void 0:i[R]),e(6,x=m?ai==null?void 0:ai.icons[m]:void 0),x)break;e(5,y=m?c+m.replace(/ /g,"_")+".svg":void 0)}while(R>-1&&(!y||h.has(y)))}function P(u){ly.call(this,n,u)}const O=()=>M(),G=()=>d("select",void 0),k=u=>{document.activeElement!==u.target&&d("select",void 0)};return n.$$set=u=>{"feature"in u&&e(0,o=u.feature),"style"in u&&e(1,a=u.style),"showPlaceType"in u&&e(2,l=u.showPlaceType),"missingIconsCache"in u&&e(11,h=u.missingIconsCache),"iconsBaseUrl"in u&&e(3,c=u.iconsBaseUrl)},n.$$.update=()=>{var u,f,g,E,p;n.$$.dirty&1&&e(12,i=(u=o.properties)==null?void 0:u.categories),n.$$.dirty&1&&e(8,s=o.place_type[0]==="reverse"),n.$$.dirty&1&&e(7,r=((g=(f=o.properties)==null?void 0:f.categories)==null?void 0:g.join(", "))??((p=(E=o.properties)==null?void 0:E.place_type_name)==null?void 0:p[0])??o.place_type[0]),n.$$.dirty&4096&&(R=(i==null?void 0:i.length)??0,v())},[o,a,l,c,m,y,x,r,s,d,M,h,i,P,O,G,k]}class My extends Bn{constructor(t){super(),Wn(this,t,Ly,Iy,$n,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}}function Py(n){let t;return{c(){t=vt("div"),t.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',$(t,"class","svelte-7cmwmc")},m(e,i){Rt(e,t,i)},p:Ot,i:Ot,o:Ot,d(e){e&&bt(t)}}}class Ay extends Bn{constructor(t){super(),Wn(this,t,null,Py,$n,{})}}function Oy(n){let t,e;return{c(){t=Fi("svg"),e=Fi("path"),$(e,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),$(t,"viewBox","0 0 60.006 21.412"),$(t,"width","14"),$(t,"height","20"),$(t,"class","svelte-en2qvf")},m(i,s){Rt(i,t,s),ct(t,e)},p:Ot,i:Ot,o:Ot,d(i){i&&bt(t)}}}class Fy extends Bn{constructor(t){super(),Wn(this,t,null,Oy,$n,{})}}function ky(n){let t,e,i;return{c(){t=Fi("svg"),e=Fi("circle"),i=Fi("path"),$(e,"cx","4.789"),$(e,"cy","4.787"),$(e,"r","3.85"),$(e,"class","svelte-1aq105l"),$(i,"d","M12.063 12.063 7.635 7.635"),$(i,"class","svelte-1aq105l"),$(t,"xmlns","http://www.w3.org/2000/svg"),$(t,"width","13"),$(t,"height","13"),$(t,"viewBox","0 0 13 13"),$(t,"class","svelte-1aq105l")},m(s,r){Rt(s,t,r),ct(t,e),ct(t,i)},p:Ot,i:Ot,o:Ot,d(s){s&&bt(t)}}}class Dy extends Bn{constructor(t){super(),Wn(this,t,null,ky,$n,{})}}function Ny(n,t,e){const i=t[1],s=t[0],r=i-s;return n===i&&e?n:((n-s)%r+r)%r+s}function Io(n){const t=[...n];return t[2]<t[0]&&(Math.abs((t[0]+t[2]+360)/2)>Math.abs((t[0]-360+t[2])/2)?t[0]-=360:t[2]+=360),t}let Ns;async function Gy(n,t,e){const i=n==null?void 0:n.getCenterAndZoom();for(const s of t??[])if(!(i&&(s.minZoom!=null&&s.minZoom>i[0]||s.maxZoom!=null&&s.maxZoom<i[0]))){if(s.type==="fixed")return s.coordinates.join(",");t:if(s.type==="client-geolocation"){if(Ns&&s.cachedLocationExpiry&&Ns.time+s.cachedLocationExpiry>Date.now()){if(!Ns.coords)break t;return Ns.coords}let r;try{return r=await new Promise((o,a)=>{e.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(l=>{o([l.coords.longitude,l.coords.latitude].map(h=>h.toFixed(6)).join(","))},l=>{a(l)},s)}),r}catch{}finally{s.cachedLocationExpiry&&(Ns={time:Date.now(),coords:r})}if(e.signal.aborted)return}if(s.type==="server-geolocation")return"ip";if(i&&s.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const zy=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,Rc=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,Ic=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,Lc=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Mc=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,Pc=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function $y(n){if(!["DMS","DM","DD"].includes(n))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const t=this.decimalCoordinates.split(",").map(y=>Number(y.trim())),e=Number(t[0]),i=Number(t[1]),s=Math.abs(e),r=Math.abs(i),o=e>0?"N":"S",a=i>0?"E":"W";let l;n=="DD"&&(l=`${s} ${o}, ${r} ${a}`);const h=Math.floor(s),c=Math.floor(r),d=(s-h)*60,m=(r-c)*60;if(n=="DM"){let y=Ac(d,3).toFixed(3).padStart(6,"0"),x=Ac(m,3).toFixed(3).padStart(6,"0");y.endsWith(".000")&&x.endsWith(".000")&&(y=y.replace(/\.000$/,""),x=x.replace(/\.000$/,"")),l=`${h} ${y}' ${o}, ${c} ${x}' ${a}`}if(n=="DMS"){const y=Math.floor(d),x=Math.floor(m);let R=((d-y)*60).toFixed(1).padStart(4,"0"),I=((m-x)*60).toFixed(1).padStart(4,"0");const M=y.toString().padStart(2,"0"),v=x.toString().padStart(2,"0");R.endsWith(".0")&&I.endsWith(".0")&&(R=R.replace(/\.0$/,""),I=I.replace(/\.0$/,"")),l=`${h} ${M}' ${R}" ${o}, ${c} ${v}' ${I}" ${a}`}return l}else throw new Error("no decimal coordinates to convert")}function Ac(n,t){const e=Math.pow(10,t);return Math.round((n+Number.EPSILON)*e)/e}function rh(n,t){t||(t=5),n=n.replace(/\s+/g," ").trim();let e=null,i=null,s="",r="",o=null,a=[],l=!1;if(zy.test(n))throw new Error("invalid coordinate value");if(Rc.test(n))if(a=Rc.exec(n),l=Gs(a),l)e=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(e*=-1),i=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(i*=-1),o="DM";else throw new Error("invalid coordinate format");else if(Ic.test(n))if(a=Ic.exec(n),l=Gs(a),l){if(e=a[2],i=a[6],e.includes(",")&&(e=e.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),o="DD",Number(Math.round(e))==Number(e))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");a[1]?(s=a[1],r=a[5]):a[4]&&(s=a[4],r=a[8])}else throw new Error("invalid decimal coordinate format");else if(Lc.test(n))if(a=Lc.exec(n),l=Gs(a),l)e=Math.abs(parseInt(a[2])),a[4]&&(e+=a[4]/60,o="DM"),a[6]&&(e+=a[6].replace(",",".")/3600,o="DMS"),parseInt(a[2])<0&&(e=-1*e),i=Math.abs(parseInt(a[9])),a[11]&&(i+=a[11]/60),a[13]&&(i+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(i=-1*i),a[1]?(s=a[1],r=a[8]):a[7]&&(s=a[7],r=a[14]);else throw new Error("invalid DMS coordinates format");else if(Mc.test(n))if(a=Mc.exec(n),l=Gs(a),l)e=Math.abs(parseInt(a[2])),a[4]&&(e+=a[4]/60,o="DM"),a[6]&&(e+=a[6]/3600,o="DMS"),parseInt(a[2])<0&&(e=-1*e),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12]/60),a[14]&&(i+=a[14]/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(s=a[1],r=a[9]):a[8]&&(s=a[8],r=a[16]);else throw new Error("invalid DMS coordinates format");else if(Pc.test(n)){if(a=Pc.exec(n),l=Gs(a),a.filter(h=>h).length<=5)throw new Error("invalid coordinates format");if(l)e=Math.abs(parseInt(a[2])),a[4]&&(e+=a[4].replace(",",".")/60,o="DM"),a[6]&&(e+=a[6].replace(",",".")/3600,o="DMS"),parseInt(a[2])<0&&(e=-1*e),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12].replace(",",".")/60),a[14]&&(i+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(s=a[1],r=a[9]):a[8]&&(s=a[8],r=a[16]);else throw new Error("invalid coordinates format")}if(l){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(e)>=90)throw new Error("invalid latitude value");if(s&&!r||!s&&r)throw new Error("invalid coordinates value");if(s&&s==r)throw new Error("invalid coordinates format");e.toString().includes(",")&&(e=e.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let h=/S|SOUTH/i;h.test(s)&&e>0&&(e=-1*e),h=/W|WEST/i,h.test(r)&&i>0&&(i=-1*i);const c=a[0].trim();let d,m;const y=/[,/;\u0020]/g,x=c.match(y);if(x==null){const M=Math.floor(n.length/2);d=c.substring(0,M).trim(),m=c.substring(M).trim()}else{let M;x.length%2==1?M=Math.floor(x.length/2):M=x.length/2-1;let v=0;if(M==0)v=c.indexOf(x[0]),d=c.substring(0,v).trim(),m=c.substring(v+1).trim();else{let A=0,P=0;for(;A<=M;)v=c.indexOf(x[A],P),P=v+1,A++;d=c.substring(0,v).trim(),m=c.substring(v+1).trim()}}const R=d.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");const I=m.split(".");if(I.length==2&&I[1]==0&&I[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(d)||/^\d+$/.test(m))throw new Error("degree only coordinate/s provided");return e=Number(Number(e).toFixed(t)),i=Number(Number(i).toFixed(t)),Object.freeze({verbatimCoordinates:c,verbatimLatitude:d,verbatimLongitude:m,decimalLatitude:e,decimalLongitude:i,decimalCoordinates:`${e},${i}`,originalFormat:o,closeEnough:Wy,toCoordinateFormat:$y})}else throw new Error("coordinates pattern match failed")}function Gs(n){if(!isNaN(n[0]))return!1;const t=[...n];if(t.shift(),t.length%2>0)return!1;const e=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,s=t.length/2;for(let r=0;r<s;r++){const o=t[r],a=t[r+s],l=e.test(o)&&e.test(a),h=i.test(o)&&i.test(a),c=o==a;if(!(o==null&&a==null)){if(o==null||a==null)return!1;if(l||h||c)continue;return!1}}return!0}function Oc(n,t){const e=Math.abs(n-t);return Number(e.toFixed(6))<=1e-5}function Wy(n){if(!n)throw new Error("coords must be provided");if(n.includes(",")){const t=n.split(",");if(Number(t[0])==NaN||Number(t[1])==NaN)throw new Error("coords are not valid decimals");return Oc(this.decimalLatitude,Number(t[0]))&&Oc(this.decimalLongitude,t[1])}else throw new Error("coords being tested must be separated by a comma")}const By=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});rh.to=By;const Xy=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Uy={decimalLatitude:40.123,decimalLongitude:-74.123},Yy=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],jy=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Ky(){const n=[];return Xy.forEach(t=>{t.decimalLatitude?n.push(t):n.push({...t,...Uy})}),[...n,...Yy,...jy]}const Zy=Ky();rh.formats=Zy.map(n=>n.verbatimCoordinates);const Vy=rh;function Fc(n,t,e){const i=n.slice();return i[97]=t[e],i[99]=e,i}function kc(n){let t,e;return t=new Ay({}),{c(){fn(t.$$.fragment)},m(i,s){Gi(t,i,s),e=!0},i(i){e||(Dt(t.$$.fragment,i),e=!0)},o(i){Yt(t.$$.fragment,i),e=!1},d(i){zi(t,i)}}}function Dc(n){let t,e,i,s,r;return e=new Fy({}),{c(){t=vt("button"),fn(e.$$.fragment),$(t,"type","button"),$(t,"title",n[10]),$(t,"class","svelte-bz0zu3"),hs(t,"active",n[0])},m(o,a){Rt(o,t,a),Gi(e,t,null),i=!0,s||(r=Bt(t,"click",n[79]),s=!0)},p(o,a){(!i||a[0]&1024)&&$(t,"title",o[10]),(!i||a[0]&1)&&hs(t,"active",o[0])},i(o){i||(Dt(e.$$.fragment,o),i=!0)},o(o){Yt(e.$$.fragment,o),i=!1},d(o){o&&bt(t),zi(e),s=!1,r()}}}function qy(n){let t,e=[],i=new Map,s,r,o,a=bc(n[13]);const l=h=>h[97].id+(h[97].address?","+h[97].address:"");for(let h=0;h<a.length;h+=1){let c=Fc(n,a,h),d=l(c);i.set(d,e[h]=Nc(d,c))}return{c(){t=vt("ul");for(let h=0;h<e.length;h+=1)e[h].c();$(t,"class","options svelte-bz0zu3"),$(t,"role","listbox")},m(h,c){Rt(h,t,c);for(let d=0;d<e.length;d+=1)e[d]&&e[d].m(t,null);s=!0,r||(o=[Bt(t,"mouseleave",n[27]),Bt(t,"blur",n[83]),Bt(t,"keydown",n[23])],r=!0)},p(h,c){c[0]&102823936&&(a=bc(h[13]),no(),e=gy(e,c,l,1,h,a,i,t,fy,Nc,null,Fc),so())},i(h){if(!s){for(let c=0;c<a.length;c+=1)Dt(e[c]);s=!0}},o(h){for(let c=0;c<e.length;c+=1)Yt(e[c]);s=!1},d(h){h&&bt(t);for(let c=0;c<e.length;c+=1)e[c].d();r=!1,Bi(o)}}}function Hy(n){let t,e,i,s,r,o;return e=new Bd({}),{c(){t=vt("div"),fn(e.$$.fragment),i=be(),s=vt("div"),r=dn(n[8]),$(s,"class","svelte-bz0zu3"),$(t,"class","no-results svelte-bz0zu3")},m(a,l){Rt(a,t,l),Gi(e,t,null),ct(t,i),ct(t,s),ct(s,r),o=!0},p(a,l){(!o||l[0]&256)&&pr(r,a[8])},i(a){o||(Dt(e.$$.fragment,a),o=!0)},o(a){Yt(e.$$.fragment,a),o=!1},d(a){a&&bt(t),zi(e)}}}function Jy(n){let t="",e;return{c(){e=dn(t)},m(i,s){Rt(i,e,s)},p:Ot,i:Ot,o:Ot,d(i){i&&bt(e)}}}function Qy(n){let t,e,i,s,r,o,a,l,h,c,d;return e=new Bd({}),l=new Wd({}),{c(){t=vt("div"),fn(e.$$.fragment),i=be(),s=vt("div"),r=dn(n[7]),o=be(),a=vt("button"),fn(l.$$.fragment),$(s,"class","svelte-bz0zu3"),$(a,"class","svelte-bz0zu3"),$(t,"class","error svelte-bz0zu3")},m(m,y){Rt(m,t,y),Gi(e,t,null),ct(t,i),ct(t,s),ct(s,r),ct(t,o),ct(t,a),Gi(l,a,null),h=!0,c||(d=Bt(a,"click",n[80]),c=!0)},p(m,y){(!h||y[0]&128)&&pr(r,m[7])},i(m){h||(Dt(e.$$.fragment,m),Dt(l.$$.fragment,m),h=!0)},o(m){Yt(e.$$.fragment,m),Yt(l.$$.fragment,m),h=!1},d(m){m&&bt(t),zi(e),zi(l),c=!1,d()}}}function Nc(n,t){var e;let i,s,r;function o(){return t[81](t[99])}function a(){return t[82](t[97])}return s=new My({props:{feature:t[97],showPlaceType:t[11],style:t[15]===t[99]?"selected":((e=t[14])==null?void 0:e.id)===t[97].id?"picked":"default",missingIconsCache:t[21],iconsBaseUrl:t[12]}}),s.$on("mouseenter",o),s.$on("select",a),{key:n,first:null,c(){i=ny(),fn(s.$$.fragment),this.first=i},m(l,h){Rt(l,i,h),Gi(s,l,h),r=!0},p(l,h){var c;t=l;const d={};h[0]&8192&&(d.feature=t[97]),h[0]&2048&&(d.showPlaceType=t[11]),h[0]&57344&&(d.style=t[15]===t[99]?"selected":((c=t[14])==null?void 0:c.id)===t[97].id?"picked":"default"),h[0]&4096&&(d.iconsBaseUrl=t[12]),s.$set(d)},i(l){r||(Dt(s.$$.fragment,l),r=!0)},o(l){Yt(s.$$.fragment,l),r=!1},d(l){l&&bt(i),zi(s,l)}}}function t1(n){let t,e,i,s,r,o,a,l,h,c,d,m,y,x,R,I,M,v,A,P,O,G=!1;r=new Dy({}),d=new Wd({});let k=n[20]&&kc(),u=n[6]==="button"&&Dc(n);const f=n[70].default,g=Q_(f,n,n[69],null),E=[Qy,Jy,Hy,qy],p=[];function S(C,_){var w,T;return C[19]?0:!C[16]&&!C[4]?1:((w=C[13])==null?void 0:w.length)===0?2:(T=C[13])!=null&&T.length&&(C[16]||C[4])?3:-1}return~(I=S(n))&&(M=p[I]=E[I](n)),{c(){t=be(),e=vt("form"),i=vt("div"),s=vt("button"),fn(r.$$.fragment),o=be(),a=vt("input"),l=be(),h=vt("div"),c=vt("button"),fn(d.$$.fragment),m=be(),k&&k.c(),y=be(),u&&u.c(),x=be(),g&&g.c(),R=be(),M&&M.c(),$(s,"class","search-button svelte-bz0zu3"),$(s,"type","button"),$(a,"placeholder",n[9]),$(a,"aria-label",n[9]),$(a,"class","svelte-bz0zu3"),$(c,"type","button"),$(c,"title",n[3]),$(c,"class","svelte-bz0zu3"),$(h,"class","clear-button-container svelte-bz0zu3"),hs(h,"displayable",n[1]!==""),$(i,"class","input-group svelte-bz0zu3"),$(e,"class",v=Ro(n[2])+" svelte-bz0zu3"),hs(e,"can-collapse",n[5]&&n[1]==="")},m(C,_){Rt(C,t,_),Rt(C,e,_),ct(e,i),ct(i,s),Gi(r,s,null),ct(i,o),ct(i,a),n[72](a),Sc(a,n[1]),ct(i,l),ct(i,h),ct(h,c),Gi(d,c,null),ct(h,m),k&&k.m(h,null),ct(i,y),u&&u.m(i,null),ct(i,x),g&&g.m(i,null),ct(e,R),~I&&p[I].m(e,null),A=!0,P||(O=[Bt(s,"click",n[71]),Bt(a,"input",n[73]),Bt(a,"focus",n[74]),Bt(a,"blur",n[75]),Bt(a,"click",n[76]),Bt(a,"keydown",n[23]),Bt(a,"input",n[24]),Bt(a,"change",n[77]),Bt(c,"click",n[78]),Bt(e,"submit",sy(n[22]))],P=!0)},p(C,_){(!A||_[0]&512)&&$(a,"placeholder",C[9]),(!A||_[0]&512)&&$(a,"aria-label",C[9]),_[0]&2&&a.value!==C[1]&&Sc(a,C[1]),(!A||_[0]&8)&&$(c,"title",C[3]),C[20]?k?_[0]&1048576&&Dt(k,1):(k=kc(),k.c(),Dt(k,1),k.m(h,null)):k&&(no(),Yt(k,1,1,()=>{k=null}),so()),(!A||_[0]&2)&&hs(h,"displayable",C[1]!==""),C[6]==="button"?u?(u.p(C,_),_[0]&64&&Dt(u,1)):(u=Dc(C),u.c(),Dt(u,1),u.m(i,x)):u&&(no(),Yt(u,1,1,()=>{u=null}),so()),g&&g.p&&(!A||_[2]&128)&&ey(g,f,C,C[69],A?ty(f,C[69]):iy(C[69]),null);let w=I;I=S(C),I===w?~I&&p[I].p(C,_):(M&&(no(),Yt(p[w],1,1,()=>{p[w]=null}),so()),~I?(M=p[I],M?M.p(C,_):(M=p[I]=E[I](C),M.c()),Dt(M,1),M.m(e,null)):M=null),(!A||_[0]&4&&v!==(v=Ro(C[2])+" svelte-bz0zu3"))&&$(e,"class",v),(!A||_[0]&38)&&hs(e,"can-collapse",C[5]&&C[1]==="")},i(C){A||(Dt(G),Dt(r.$$.fragment,C),Dt(d.$$.fragment,C),Dt(k),Dt(u),Dt(g,C),Dt(M),A=!0)},o(C){Yt(G),Yt(r.$$.fragment,C),Yt(d.$$.fragment,C),Yt(k),Yt(u),Yt(g,C),Yt(M),A=!1},d(C){C&&(bt(t),bt(e)),zi(r),n[72](null),zi(d),k&&k.d(),u&&u.d(),g&&g.d(C),~I&&p[I].d(),P=!1,Bi(O)}}}function e1(n,t,e){let i,s,r,{$$slots:o={},$$scope:a}=t;const l={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:h=void 0}=t,{apiKey:c}=t,{bbox:d=void 0}=t,{clearButtonTitle:m="clear"}=t,{clearOnBlur:y=!1}=t,{clearListOnPick:x=!1}=t,{keepListOpen:R=!1}=t,{collapsed:I=!1}=t,{country:M=void 0}=t,{debounceSearch:v=200}=t,{enableReverse:A="never"}=t,{errorMessage:P="Something went wrong"}=t,{filter:O=()=>!0}=t,{flyTo:G=!0}=t,{fuzzyMatch:k=!0}=t,{language:u=void 0}=t,{limit:f=void 0}=t;const g=41415112612;let{reverseGeocodingLimit:E=g}=t,{mapController:p=void 0}=t,{minLength:S=2}=t,{noResultsMessage:C="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=t,{placeholder:_="Search"}=t,{proximity:w=[{type:"server-geolocation"}]}=t,{reverseActive:T=A==="always"}=t,{reverseButtonTitle:b="toggle reverse geocoding"}=t,{searchValue:L=""}=t,{pickedResultStyle:D="full-geometry"}=t,{showPlaceType:z="if-needed"}=t,{showResultsWhileTyping:F=!0}=t,{selectFirst:U=!0}=t,{flyToSelected:K=!1}=t,{markerOnSelected:B=!0}=t,{types:X=void 0}=t;const q=[];let{reverseGeocodingTypes:St=q}=t,{exhaustiveReverseGeocoding:It=!1}=t,{excludeTypes:Ct=!1}=t;const pt=void 0;let{reverseGeocodingExcludeTypes:Nt=pt}=t,{zoom:lt=l}=t,{apiUrl:et="https://api.maptiler.com/geocoding"}=t,{fetchParameters:j={}}=t,{iconsBaseUrl:_e="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.6/icons/"}=t,{adjustUrlQuery:Je=()=>{}}=t,{adjustUrl:Qe=()=>{}}=t;function mn(N){ye.focus(N)}function mi(){ye.blur()}function pi(N,_t=!0,Zt=!1){e(1,L=N),_t?(e(15,dt=-1),Un()):(ie(void 0,!Zt,Zt),setTimeout(()=>{ye.focus(),ye.select()}))}function Xi(){e(13,at=void 0),e(14,V=void 0),e(15,dt=-1)}function Gt(){e(64,Lt=[]),e(14,V=void 0)}let at,Lt,V,pn="",ye,dt=-1,xe,Ui=[],Yi,ji,_i,Xn,Ee=!1;const Ar=new Set,ti=zd();ay(()=>{p&&(p.setEventHandler(void 0),p.indicateReverse(!1),p.setSelectedMarker(-1),p.setFeatures(void 0,void 0,!1))});function Un(N){if(e(17,Ee=!1),ji&&(clearTimeout(ji),ji=void 0),dt>-1&&at)e(14,V=at[dt]),e(1,L=V.place_type[0]==="reverse"?V.place_name:V.place_name.replace(/,.*/,"")),e(19,xe=void 0),e(64,Lt=void 0),e(15,dt=-1);else if(L){const _t=N||!yi(L);xi(L,{exact:!0}).then(()=>{e(64,Lt=at),e(14,V=void 0),_t&&_n()}).catch(Zt=>e(19,xe=Zt))}}function yi(N){try{return Vy(N,6)}catch{return!1}}async function xi(N,{byId:_t=!1,exact:Zt=!1}={}){var le,ve,ei;e(19,xe=void 0),Yi==null||Yi.abort();const ii=new AbortController;e(20,Yi=ii);try{const yt=yi(N),Rs=new URL(et+"/"+encodeURIComponent(yt?yt.decimalLongitude+","+yt.decimalLatitude:N)+".json"),Ie=Rs.searchParams;u!==void 0&&Ie.set("language",Array.isArray(u)?u.join(","):u??"");const[sa]=(p==null?void 0:p.getCenterAndZoom())??[];let Zi=(le=!yt||St===q?X:St)==null?void 0:le.map(Ht=>typeof Ht=="string"?Ht:sa===void 0||(Ht[0]??0)<=sa&&sa<(Ht[1]??1/0)?Ht[2]:void 0).filter(Ht=>Ht!==void 0);Zi&&(Zi=[...new Set(Zi)],Ie.set("types",Zi.join(",")));const ch=!yt||Nt===pt?Ct:Nt;if(ch&&Ie.set("excludeTypes",String(ch)),d&&Ie.set("bbox",d.map(Ht=>Ht.toFixed(6)).join(",")),M&&Ie.set("country",Array.isArray(M)?M.join(","):M),!_t&&!yt){const Ht=await Gy(p,w,ii);Ht&&Ie.set("proximity",Ht),(Zt||!F)&&Ie.set("autocomplete","false"),Ie.set("fuzzyMatch",String(k))}const Is=E===g?f:E;Is!==void 0&&Is>1&&(Zi==null?void 0:Zi.length)!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),yt?(Is===1||Is!==void 0&&(It||(Zi==null?void 0:Zi.length)===1))&&Ie.set("limit",String(Is)):f!==void 0&&Ie.set("limit",String(f)),c&&Ie.set("key",c),Je(Ie),Qe(Rs);const lf=Rs.searchParams.get("types")===""&&Rs.searchParams.get("excludeTypes")!=="true",Or=Rs.toString();if(Or===pn){_t?(x&&e(13,at=void 0),e(14,V=Ui[0])):(e(13,at=Ui),((ve=at[dt])==null?void 0:ve.id)!==(s==null?void 0:s.id)&&e(15,dt=-1));return}pn=Or;let Ls;if(lf)Ls={type:"FeatureCollection",features:[]};else{const Ht=await fetch(Or,{signal:ii.signal,...j});if(!Ht.ok)throw new Error(await Ht.text());Ls=await Ht.json()}ti("response",{url:Or,featureCollection:Ls}),_t?(x&&e(13,at=void 0),e(14,V=Ls.features[0]),Ui=[V]):(e(13,at=Ls.features.filter(O)),yt&&at.unshift({type:"Feature",properties:{},id:"reverse_"+yt.decimalLongitude+"_"+yt.decimalLatitude,text:yt.decimalLatitude+", "+yt.decimalLongitude,place_name:yt.decimalLatitude+", "+yt.decimalLongitude,place_type:["reverse"],center:[yt.decimalLongitude,yt.decimalLatitude],bbox:[yt.decimalLongitude,yt.decimalLatitude,yt.decimalLongitude,yt.decimalLatitude],geometry:{type:"Point",coordinates:[yt.decimalLongitude,yt.decimalLatitude]}}),Ui=at,((ei=at[dt])==null?void 0:ei.id)!==(s==null?void 0:s.id)&&e(15,dt=-1),yt&&ye.focus())}catch(yt){if(yt&&typeof yt=="object"&&"name"in yt&&yt.name==="AbortError")return;throw yt}finally{ii===Yi&&e(20,Yi=void 0)}}function _n(){var N;if(!(Lt!=null&&Lt.length)||!G)return;const _t=[180,90,-180,-90],Zt=!Lt.some(ve=>!ve.matching_text);let le;for(const ve of Lt){const ei=Ki(ve);if(le=le===void 0?ei:ei===void 0?le:Math.max(le,ei),Zt||!ve.matching_text)for(const ii of[0,1,2,3])_t[ii]=Math[ii<2?"min":"max"](_t[ii],((N=ve.bbox)==null?void 0:N[ii])??ve.center[ii%2])}p&&Lt.length>0&&(V&&_t[0]===_t[2]&&_t[1]===_t[3]?p.flyTo(V.center,Ki(V)):p.fitBounds(Io(_t),50,le))}function Yn(){!V||!p||(!V.bbox||V.bbox[0]===V.bbox[2]&&V.bbox[1]===V.bbox[3]?p.flyTo(V.center,Ki(V)):p.fitBounds(Io(V.bbox),50,Ki(V)))}function Ki(N){var _t;if(!N.bbox||N.bbox[0]!==N.bbox[2]&&N.bbox[1]!==N.bbox[3])return;const Zt=N.id.replace(/\..*/,"");return(Array.isArray((_t=N.properties)==null?void 0:_t.categories)?N.properties.categories.reduce((le,ve)=>{const ei=lt[Zt+"."+ve];return le===void 0?ei:ei===void 0?le:Math.max(le,ei)},void 0):void 0)??lt[Zt]}function oe(N){e(0,T=A==="always"),e(13,at=void 0),e(14,V=void 0),e(15,dt=-1),pi(N[1].toFixed(6)+", "+Ny(N[0],[-180,180],!0).toFixed(6),!1,!0)}function Ei(N){if(!at)return;let _t=N.key==="ArrowDown"?1:N.key==="ArrowUp"?-1:0;_t&&(ye.focus(),e(17,Ee=!0),N.preventDefault(),V&&dt===-1&&e(15,dt=at.findIndex(Zt=>Zt.id===(V==null?void 0:V.id))),dt===(V||U?0:-1)&&_t===-1&&e(15,dt=at.length),e(15,dt+=_t),dt>=at.length&&e(15,dt=-1),dt<0&&(V||U)&&e(15,dt=0))}function ie(N,_t=!0,Zt=!1){if(e(19,xe=void 0),e(14,V=void 0),e(17,Ee=!0),F||Zt){if(ji&&clearTimeout(ji),L.length<S)return;const le=L;ji=window.setTimeout(()=>{xi(le).catch(ve=>e(19,xe=ve))},_t?v:0)}else e(13,at=void 0),e(19,xe=void 0)}function ae(N){V&&(V==null?void 0:V.id)===(N==null?void 0:N.id)?Yn():(e(14,V=N),e(1,L=N.place_name))}function ne(N){e(15,dt=N)}function We(){(!U||V)&&e(15,dt=-1),K&&Yn()}const Be=()=>ye.focus();function Tt(N){al[N?"unshift":"push"](()=>{ye=N,e(18,ye)})}function Kt(){L=this.value,e(1,L),e(17,Ee),e(31,y),e(16,_i)}const Xe=()=>e(17,Ee=!0),na=()=>e(17,Ee=!1),Qd=()=>e(17,Ee=!0),tf=()=>e(14,V=void 0),ef=()=>{e(1,L=""),e(14,V=void 0),ye.focus()},nf=()=>e(0,T=!T),sf=()=>e(19,xe=void 0),rf=N=>ne(N),of=N=>ae(N),af=()=>{};return n.$$set=N=>{"class"in N&&e(2,h=N.class),"apiKey"in N&&e(29,c=N.apiKey),"bbox"in N&&e(30,d=N.bbox),"clearButtonTitle"in N&&e(3,m=N.clearButtonTitle),"clearOnBlur"in N&&e(31,y=N.clearOnBlur),"clearListOnPick"in N&&e(32,x=N.clearListOnPick),"keepListOpen"in N&&e(4,R=N.keepListOpen),"collapsed"in N&&e(5,I=N.collapsed),"country"in N&&e(33,M=N.country),"debounceSearch"in N&&e(34,v=N.debounceSearch),"enableReverse"in N&&e(6,A=N.enableReverse),"errorMessage"in N&&e(7,P=N.errorMessage),"filter"in N&&e(35,O=N.filter),"flyTo"in N&&e(36,G=N.flyTo),"fuzzyMatch"in N&&e(37,k=N.fuzzyMatch),"language"in N&&e(38,u=N.language),"limit"in N&&e(39,f=N.limit),"reverseGeocodingLimit"in N&&e(40,E=N.reverseGeocodingLimit),"mapController"in N&&e(41,p=N.mapController),"minLength"in N&&e(42,S=N.minLength),"noResultsMessage"in N&&e(8,C=N.noResultsMessage),"placeholder"in N&&e(9,_=N.placeholder),"proximity"in N&&e(43,w=N.proximity),"reverseActive"in N&&e(0,T=N.reverseActive),"reverseButtonTitle"in N&&e(10,b=N.reverseButtonTitle),"searchValue"in N&&e(1,L=N.searchValue),"pickedResultStyle"in N&&e(44,D=N.pickedResultStyle),"showPlaceType"in N&&e(11,z=N.showPlaceType),"showResultsWhileTyping"in N&&e(45,F=N.showResultsWhileTyping),"selectFirst"in N&&e(46,U=N.selectFirst),"flyToSelected"in N&&e(47,K=N.flyToSelected),"markerOnSelected"in N&&e(48,B=N.markerOnSelected),"types"in N&&e(49,X=N.types),"reverseGeocodingTypes"in N&&e(50,St=N.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in N&&e(51,It=N.exhaustiveReverseGeocoding),"excludeTypes"in N&&e(52,Ct=N.excludeTypes),"reverseGeocodingExcludeTypes"in N&&e(53,Nt=N.reverseGeocodingExcludeTypes),"zoom"in N&&e(54,lt=N.zoom),"apiUrl"in N&&e(55,et=N.apiUrl),"fetchParameters"in N&&e(56,j=N.fetchParameters),"iconsBaseUrl"in N&&e(12,_e=N.iconsBaseUrl),"adjustUrlQuery"in N&&e(57,Je=N.adjustUrlQuery),"adjustUrl"in N&&e(58,Qe=N.adjustUrl),"$$scope"in N&&e(69,a=N.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&64&&e(0,T=A==="always"),n.$$.dirty[0]&16384|n.$$.dirty[1]&8192&&D!=="marker-only"&&V&&!V.address&&V.geometry.type==="Point"&&V.place_type[0]!=="reverse"&&xi(V.id,{byId:!0}).catch(N=>e(19,xe=N)),n.$$.dirty[0]&16384|n.$$.dirty[1]&1058|n.$$.dirty[2]&8&&(p&&V&&V.id!==Xn&&G&&(Yn(),x&&e(13,at=void 0),e(64,Lt=void 0),e(15,dt=-1)),e(65,Xn=V==null?void 0:V.id)),n.$$.dirty[0]&196608|n.$$.dirty[1]&1&&setTimeout(()=>{e(16,_i=Ee),y&&!_i&&e(1,L="")}),n.$$.dirty[0]&8194|n.$$.dirty[1]&2048&&L.length<S&&(e(13,at=void 0),e(19,xe=void 0),e(64,Lt=at)),n.$$.dirty[0]&57344|n.$$.dirty[1]&32768&&U&&at!=null&&at.length&&dt==-1&&!V&&e(15,dt=0),n.$$.dirty[0]&8192|n.$$.dirty[2]&4&&Lt!==at&&e(64,Lt=void 0),n.$$.dirty[0]&73729|n.$$.dirty[1]&1024|n.$$.dirty[2]&4&&p&&p.setEventHandler(N=>{switch(N.type){case"mapClick":T&&oe(N.coordinates);break;case"markerClick":{const _t=at==null?void 0:at.find(Zt=>Zt.id===N.id);_t&&ae(_t)}break;case"markerMouseEnter":Lt&&e(15,dt=_i?(at==null?void 0:at.findIndex(_t=>_t.id===N.id))??-1:-1);break;case"markerMouseLeave":Lt&&e(15,dt=-1);break}}),n.$$.dirty[0]&40960&&e(66,s=at==null?void 0:at[dt]),n.$$.dirty[1]&66592|n.$$.dirty[2]&16&&p&&s&&G&&K&&p.flyTo(s.center,Ki(s)),n.$$.dirty[1]&8192&&e(68,i=D==="full-geometry-including-polygon-center-marker"),n.$$.dirty[1]&132096|n.$$.dirty[2]&64&&(B||p==null||p.setFeatures(void 0,void 0,i)),n.$$.dirty[0]&16384|n.$$.dirty[1]&132096|n.$$.dirty[2]&84&&p&&B&&!Lt&&(p.setFeatures(s?[s]:void 0,V,i),p.setSelectedMarker(s?0:-1)),n.$$.dirty[0]&16384|n.$$.dirty[1]&1024|n.$$.dirty[2]&68&&p&&p.setFeatures(Lt,V,i),n.$$.dirty[0]&32768|n.$$.dirty[1]&1024|n.$$.dirty[2]&4&&Lt&&p&&p.setSelectedMarker(dt),n.$$.dirty[0]&2|n.$$.dirty[1]&1024&&p){const N=yi(L);p.setReverseMarker(N?[N.decimalLongitude,N.decimalLatitude]:void 0)}n.$$.dirty[2]&16&&ti("select",{feature:s}),n.$$.dirty[0]&16384&&ti("pick",{feature:V}),n.$$.dirty[0]&73744&&e(67,r=!!(at!=null&&at.length)&&(_i||R)),n.$$.dirty[2]&32&&ti("optionsvisibilitychange",{optionsVisible:r}),n.$$.dirty[0]&8192&&ti("featureslisted",{features:at}),n.$$.dirty[2]&4&&ti("featuresmarked",{features:Lt}),n.$$.dirty[0]&1&&ti("reversetoggle",{reverse:T}),n.$$.dirty[0]&2&&ti("querychange",{query:L}),n.$$.dirty[0]&1|n.$$.dirty[1]&1024&&p&&p.indicateReverse(T)},[T,L,h,m,R,I,A,P,C,_,b,z,_e,at,V,dt,_i,Ee,ye,xe,Yi,Ar,Un,Ei,ie,ae,ne,We,l,c,d,y,x,M,v,O,G,k,u,f,E,p,S,w,D,F,U,K,B,X,St,It,Ct,Nt,lt,et,j,Je,Qe,mn,mi,pi,Xi,Gt,Lt,Xn,s,r,i,a,o,Be,Tt,Kt,Xe,na,Qd,tf,ef,nf,sf,rf,of,af]}let i1=class extends Bn{constructor(n){super(),Wn(this,n,e1,t1,$n,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}};function Lo(n,t,e={}){const i={type:"Feature"};return(e.id===0||e.id)&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.properties=t||{},i.geometry=n,i}function oh(n,t,e={}){for(const i of n){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<i[i.length-1].length;s++)if(i[i.length-1][s]!==i[0][s])throw new Error("First and last Position are not equivalent.")}return Lo({type:"Polygon",coordinates:n},t,e)}function ul(n,t={}){const e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=n,e}function Ud(n,t,e={}){return Lo({type:"MultiPolygon",coordinates:n},t,e)}function Yd(n,t,e){if(n!==null)for(var i,s,r,o,a,l,h,c=0,d=0,m,y=n.type,x=y==="FeatureCollection",R=y==="Feature",I=x?n.features.length:1,M=0;M<I;M++){h=x?n.features[M].geometry:R?n.geometry:n,m=h?h.type==="GeometryCollection":!1,a=m?h.geometries.length:1;for(var v=0;v<a;v++){var A=0,P=0;if(o=m?h.geometries[v]:h,o!==null){l=o.coordinates;var O=o.type;switch(c=0,O){case null:break;case"Point":if(t(l,d,M,A,P)===!1)return!1;d++,A++;break;case"LineString":case"MultiPoint":for(i=0;i<l.length;i++){if(t(l[i],d,M,A,P)===!1)return!1;d++,O==="MultiPoint"&&A++}O==="LineString"&&A++;break;case"Polygon":case"MultiLineString":for(i=0;i<l.length;i++){for(s=0;s<l[i].length-c;s++){if(t(l[i][s],d,M,A,P)===!1)return!1;d++}O==="MultiLineString"&&A++,O==="Polygon"&&P++}O==="Polygon"&&A++;break;case"MultiPolygon":for(i=0;i<l.length;i++){for(P=0,s=0;s<l[i].length;s++){for(r=0;r<l[i][s].length-c;r++){if(t(l[i][s][r],d,M,A,P)===!1)return!1;d++}P++}A++}break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(Yd(o.geometries[i],t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ah(n,t){var e,i,s,r,o,a,l,h,c,d,m=0,y=n.type==="FeatureCollection",x=n.type==="Feature",R=y?n.features.length:1;for(e=0;e<R;e++){for(a=y?n.features[e].geometry:x?n.geometry:n,h=y?n.features[e].properties:x?n.properties:{},c=y?n.features[e].bbox:x?n.bbox:void 0,d=y?n.features[e].id:x?n.id:void 0,l=a?a.type==="GeometryCollection":!1,o=l?a.geometries.length:1,s=0;s<o;s++){if(r=l?a.geometries[s]:a,r===null){if(t(null,m,h,c,d)===!1)return!1;continue}switch(r.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(r,m,h,c,d)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<r.geometries.length;i++)if(t(r.geometries[i],m,h,c,d)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}m++}}function n1(n,t){ah(n,function(e,i,s,r,o){var a=e===null?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return t(Lo(e,s,{bbox:r,id:o}),i,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var h=0;h<e.coordinates.length;h++){var c=e.coordinates[h],d={type:l,coordinates:c};if(t(Lo(d,s),i,h)===!1)return!1}})}function s1(n,t={}){if(n.bbox!=null&&t.recompute!==!0)return n.bbox;const e=[1/0,1/0,-1/0,-1/0];return Yd(n,i=>{e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])}),e}var Gc=s1,r1=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,ka=Math.ceil,ke=Math.floor,ce="[BigNumber Error] ",zc=ce+"Number primitive has more than 15 significant digits: ",je=1e14,nt=14,$c=9007199254740991,Da=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],en=1e7,Se=1e9;function jd(n){var t,e,i,s=v.prototype={constructor:v,toString:null,valueOf:null},r=new v(1),o=20,a=4,l=-7,h=21,c=-1e7,d=1e7,m=!1,y=1,x=0,R={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},I="0123456789abcdefghijklmnopqrstuvwxyz",M=!0;function v(u,f){var g,E,p,S,C,_,w,T,b=this;if(!(b instanceof v))return new v(u,f);if(f==null){if(u&&u._isBigNumber===!0){b.s=u.s,!u.c||u.e>d?b.c=b.e=null:u.e<c?b.c=[b.e=0]:(b.e=u.e,b.c=u.c.slice());return}if((_=typeof u=="number")&&u*0==0){if(b.s=1/u<0?(u=-u,-1):1,u===~~u){for(S=0,C=u;C>=10;C/=10,S++);S>d?b.c=b.e=null:(b.e=S,b.c=[u]);return}T=String(u)}else{if(!r1.test(T=String(u)))return i(b,T,_);b.s=T.charCodeAt(0)==45?(T=T.slice(1),-1):1}(S=T.indexOf("."))>-1&&(T=T.replace(".","")),(C=T.search(/e/i))>0?(S<0&&(S=C),S+=+T.slice(C+1),T=T.substring(0,C)):S<0&&(S=T.length)}else{if(Pt(f,2,I.length,"Base"),f==10&&M)return b=new v(u),G(b,o+b.e+1,a);if(T=String(u),_=typeof u=="number"){if(u*0!=0)return i(b,T,_,f);if(b.s=1/u<0?(T=T.slice(1),-1):1,v.DEBUG&&T.replace(/^0\.0*|\./,"").length>15)throw Error(zc+u)}else b.s=T.charCodeAt(0)===45?(T=T.slice(1),-1):1;for(g=I.slice(0,f),S=C=0,w=T.length;C<w;C++)if(g.indexOf(E=T.charAt(C))<0){if(E=="."){if(C>S){S=w;continue}}else if(!p&&(T==T.toUpperCase()&&(T=T.toLowerCase())||T==T.toLowerCase()&&(T=T.toUpperCase()))){p=!0,C=-1,S=0;continue}return i(b,String(u),_,f)}_=!1,T=e(T,f,10,b.s),(S=T.indexOf("."))>-1?T=T.replace(".",""):S=T.length}for(C=0;T.charCodeAt(C)===48;C++);for(w=T.length;T.charCodeAt(--w)===48;);if(T=T.slice(C,++w)){if(w-=C,_&&v.DEBUG&&w>15&&(u>$c||u!==ke(u)))throw Error(zc+b.s*u);if((S=S-C-1)>d)b.c=b.e=null;else if(S<c)b.c=[b.e=0];else{if(b.e=S,b.c=[],C=(S+1)%nt,S<0&&(C+=nt),C<w){for(C&&b.c.push(+T.slice(0,C)),w-=nt;C<w;)b.c.push(+T.slice(C,C+=nt));C=nt-(T=T.slice(C)).length}else C-=w;for(;C--;T+="0");b.c.push(+T)}}else b.c=[b.e=0]}v.clone=jd,v.ROUND_UP=0,v.ROUND_DOWN=1,v.ROUND_CEIL=2,v.ROUND_FLOOR=3,v.ROUND_HALF_UP=4,v.ROUND_HALF_DOWN=5,v.ROUND_HALF_EVEN=6,v.ROUND_HALF_CEIL=7,v.ROUND_HALF_FLOOR=8,v.EUCLID=9,v.config=v.set=function(u){var f,g;if(u!=null)if(typeof u=="object"){if(u.hasOwnProperty(f="DECIMAL_PLACES")&&(g=u[f],Pt(g,0,Se,f),o=g),u.hasOwnProperty(f="ROUNDING_MODE")&&(g=u[f],Pt(g,0,8,f),a=g),u.hasOwnProperty(f="EXPONENTIAL_AT")&&(g=u[f],g&&g.pop?(Pt(g[0],-1e9,0,f),Pt(g[1],0,Se,f),l=g[0],h=g[1]):(Pt(g,-1e9,Se,f),l=-(h=g<0?-g:g))),u.hasOwnProperty(f="RANGE"))if(g=u[f],g&&g.pop)Pt(g[0],-1e9,-1,f),Pt(g[1],1,Se,f),c=g[0],d=g[1];else if(Pt(g,-1e9,Se,f),g)c=-(d=g<0?-g:g);else throw Error(ce+f+" cannot be zero: "+g);if(u.hasOwnProperty(f="CRYPTO"))if(g=u[f],g===!!g)if(g)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))m=g;else throw m=!g,Error(ce+"crypto unavailable");else m=g;else throw Error(ce+f+" not true or false: "+g);if(u.hasOwnProperty(f="MODULO_MODE")&&(g=u[f],Pt(g,0,9,f),y=g),u.hasOwnProperty(f="POW_PRECISION")&&(g=u[f],Pt(g,0,Se,f),x=g),u.hasOwnProperty(f="FORMAT"))if(g=u[f],typeof g=="object")R=g;else throw Error(ce+f+" not an object: "+g);if(u.hasOwnProperty(f="ALPHABET"))if(g=u[f],typeof g=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(g))M=g.slice(0,10)=="0123456789",I=g;else throw Error(ce+f+" invalid: "+g)}else throw Error(ce+"Object expected: "+u);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[l,h],RANGE:[c,d],CRYPTO:m,MODULO_MODE:y,POW_PRECISION:x,FORMAT:R,ALPHABET:I}},v.isBigNumber=function(u){if(!u||u._isBigNumber!==!0)return!1;if(!v.DEBUG)return!0;var f,g,E=u.c,p=u.e,S=u.s;t:if({}.toString.call(E)=="[object Array]"){if((S===1||S===-1)&&p>=-1e9&&p<=Se&&p===ke(p)){if(E[0]===0){if(p===0&&E.length===1)return!0;break t}if(f=(p+1)%nt,f<1&&(f+=nt),String(E[0]).length==f){for(f=0;f<E.length;f++)if(g=E[f],g<0||g>=je||g!==ke(g))break t;if(g!==0)return!0}}}else if(E===null&&p===null&&(S===null||S===1||S===-1))return!0;throw Error(ce+"Invalid BigNumber: "+u)},v.maximum=v.max=function(){return P(arguments,-1)},v.minimum=v.min=function(){return P(arguments,1)},v.random=function(){var u=9007199254740992,f=Math.random()*u&2097151?function(){return ke(Math.random()*u)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(g){var E,p,S,C,_,w=0,T=[],b=new v(r);if(g==null?g=o:Pt(g,0,Se),C=ka(g/nt),m)if(crypto.getRandomValues){for(E=crypto.getRandomValues(new Uint32Array(C*=2));w<C;)_=E[w]*131072+(E[w+1]>>>11),_>=9e15?(p=crypto.getRandomValues(new Uint32Array(2)),E[w]=p[0],E[w+1]=p[1]):(T.push(_%1e14),w+=2);w=C/2}else if(crypto.randomBytes){for(E=crypto.randomBytes(C*=7);w<C;)_=(E[w]&31)*281474976710656+E[w+1]*1099511627776+E[w+2]*4294967296+E[w+3]*16777216+(E[w+4]<<16)+(E[w+5]<<8)+E[w+6],_>=9e15?crypto.randomBytes(7).copy(E,w):(T.push(_%1e14),w+=7);w=C/7}else throw m=!1,Error(ce+"crypto unavailable");if(!m)for(;w<C;)_=f(),_<9e15&&(T[w++]=_%1e14);for(C=T[--w],g%=nt,C&&g&&(_=Da[nt-g],T[w]=ke(C/_)*_);T[w]===0;T.pop(),w--);if(w<0)T=[S=0];else{for(S=-1;T[0]===0;T.splice(0,1),S-=nt);for(w=1,_=T[0];_>=10;_/=10,w++);w<nt&&(S-=nt-w)}return b.e=S,b.c=T,b}}(),v.sum=function(){for(var u=1,f=arguments,g=new v(f[0]);u<f.length;)g=g.plus(f[u++]);return g},e=function(){var u="0123456789";function f(g,E,p,S){for(var C,_=[0],w,T=0,b=g.length;T<b;){for(w=_.length;w--;_[w]*=E);for(_[0]+=S.indexOf(g.charAt(T++)),C=0;C<_.length;C++)_[C]>p-1&&(_[C+1]==null&&(_[C+1]=0),_[C+1]+=_[C]/p|0,_[C]%=p)}return _.reverse()}return function(g,E,p,S,C){var _,w,T,b,L,D,z,F,U=g.indexOf("."),K=o,B=a;for(U>=0&&(b=x,x=0,g=g.replace(".",""),F=new v(E),D=F.pow(g.length-U),x=b,F.c=f(Ci(Ae(D.c),D.e,"0"),10,p,u),F.e=F.c.length),z=f(g,E,p,C?(_=I,u):(_=u,I)),T=b=z.length;z[--b]==0;z.pop());if(!z[0])return _.charAt(0);if(U<0?--T:(D.c=z,D.e=T,D.s=S,D=t(D,F,K,B,p),z=D.c,L=D.r,T=D.e),w=T+K+1,U=z[w],b=p/2,L=L||w<0||z[w+1]!=null,L=B<4?(U!=null||L)&&(B==0||B==(D.s<0?3:2)):U>b||U==b&&(B==4||L||B==6&&z[w-1]&1||B==(D.s<0?8:7)),w<1||!z[0])g=L?Ci(_.charAt(1),-K,_.charAt(0)):_.charAt(0);else{if(z.length=w,L)for(--p;++z[--w]>p;)z[w]=0,w||(++T,z=[1].concat(z));for(b=z.length;!z[--b];);for(U=0,g="";U<=b;g+=_.charAt(z[U++]));g=Ci(g,T,_.charAt(0))}return g}}(),t=function(){function u(E,p,S){var C,_,w,T,b=0,L=E.length,D=p%en,z=p/en|0;for(E=E.slice();L--;)w=E[L]%en,T=E[L]/en|0,C=z*w+T*D,_=D*w+C%en*en+b,b=(_/S|0)+(C/en|0)+z*T,E[L]=_%S;return b&&(E=[b].concat(E)),E}function f(E,p,S,C){var _,w;if(S!=C)w=S>C?1:-1;else for(_=w=0;_<S;_++)if(E[_]!=p[_]){w=E[_]>p[_]?1:-1;break}return w}function g(E,p,S,C){for(var _=0;S--;)E[S]-=_,_=E[S]<p[S]?1:0,E[S]=_*C+E[S]-p[S];for(;!E[0]&&E.length>1;E.splice(0,1));}return function(E,p,S,C,_){var w,T,b,L,D,z,F,U,K,B,X,q,St,It,Ct,pt,Nt,lt=E.s==p.s?1:-1,et=E.c,j=p.c;if(!et||!et[0]||!j||!j[0])return new v(!E.s||!p.s||(et?j&&et[0]==j[0]:!j)?NaN:et&&et[0]==0||!j?lt*0:lt/0);for(U=new v(lt),K=U.c=[],T=E.e-p.e,lt=S+T+1,_||(_=je,T=De(E.e/nt)-De(p.e/nt),lt=lt/nt|0),b=0;j[b]==(et[b]||0);b++);if(j[b]>(et[b]||0)&&T--,lt<0)K.push(1),L=!0;else{for(It=et.length,pt=j.length,b=0,lt+=2,D=ke(_/(j[0]+1)),D>1&&(j=u(j,D,_),et=u(et,D,_),pt=j.length,It=et.length),St=pt,B=et.slice(0,pt),X=B.length;X<pt;B[X++]=0);Nt=j.slice(),Nt=[0].concat(Nt),Ct=j[0],j[1]>=_/2&&Ct++;do{if(D=0,w=f(j,B,pt,X),w<0){if(q=B[0],pt!=X&&(q=q*_+(B[1]||0)),D=ke(q/Ct),D>1)for(D>=_&&(D=_-1),z=u(j,D,_),F=z.length,X=B.length;f(z,B,F,X)==1;)D--,g(z,pt<F?Nt:j,F,_),F=z.length,w=1;else D==0&&(w=D=1),z=j.slice(),F=z.length;if(F<X&&(z=[0].concat(z)),g(B,z,X,_),X=B.length,w==-1)for(;f(j,B,pt,X)<1;)D++,g(B,pt<X?Nt:j,X,_),X=B.length}else w===0&&(D++,B=[0]);K[b++]=D,B[0]?B[X++]=et[St]||0:(B=[et[St]],X=1)}while((St++<It||B[0]!=null)&&lt--);L=B[0]!=null,K[0]||K.splice(0,1)}if(_==je){for(b=1,lt=K[0];lt>=10;lt/=10,b++);G(U,S+(U.e=b+T*nt-1)+1,C,L)}else U.e=T,U.r=+L;return U}}();function A(u,f,g,E){var p,S,C,_,w;if(g==null?g=a:Pt(g,0,8),!u.c)return u.toString();if(p=u.c[0],C=u.e,f==null)w=Ae(u.c),w=E==1||E==2&&(C<=l||C>=h)?Jr(w,C):Ci(w,C,"0");else if(u=G(new v(u),f,g),S=u.e,w=Ae(u.c),_=w.length,E==1||E==2&&(f<=S||S<=l)){for(;_<f;w+="0",_++);w=Jr(w,S)}else if(f-=C,w=Ci(w,S,"0"),S+1>_){if(--f>0)for(w+=".";f--;w+="0");}else if(f+=S-_,f>0)for(S+1==_&&(w+=".");f--;w+="0");return u.s<0&&p?"-"+w:w}function P(u,f){for(var g,E,p=1,S=new v(u[0]);p<u.length;p++)E=new v(u[p]),(!E.s||(g=vn(S,E))===f||g===0&&S.s===f)&&(S=E);return S}function O(u,f,g){for(var E=1,p=f.length;!f[--p];f.pop());for(p=f[0];p>=10;p/=10,E++);return(g=E+g*nt-1)>d?u.c=u.e=null:g<c?u.c=[u.e=0]:(u.e=g,u.c=f),u}i=function(){var u=/^(-?)0([xbo])(?=\w[\w.]*$)/i,f=/^([^.]+)\.$/,g=/^\.([^.]+)$/,E=/^-?(Infinity|NaN)$/,p=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(S,C,_,w){var T,b=_?C:C.replace(p,"");if(E.test(b))S.s=isNaN(b)?null:b<0?-1:1;else{if(!_&&(b=b.replace(u,function(L,D,z){return T=(z=z.toLowerCase())=="x"?16:z=="b"?2:8,!w||w==T?D:L}),w&&(T=w,b=b.replace(f,"$1").replace(g,"0.$1")),C!=b))return new v(b,T);if(v.DEBUG)throw Error(ce+"Not a"+(w?" base "+w:"")+" number: "+C);S.s=null}S.c=S.e=null}}();function G(u,f,g,E){var p,S,C,_,w,T,b,L=u.c,D=Da;if(L){t:{for(p=1,_=L[0];_>=10;_/=10,p++);if(S=f-p,S<0)S+=nt,C=f,w=L[T=0],b=ke(w/D[p-C-1]%10);else if(T=ka((S+1)/nt),T>=L.length)if(E){for(;L.length<=T;L.push(0));w=b=0,p=1,S%=nt,C=S-nt+1}else break t;else{for(w=_=L[T],p=1;_>=10;_/=10,p++);S%=nt,C=S-nt+p,b=C<0?0:ke(w/D[p-C-1]%10)}if(E=E||f<0||L[T+1]!=null||(C<0?w:w%D[p-C-1]),E=g<4?(b||E)&&(g==0||g==(u.s<0?3:2)):b>5||b==5&&(g==4||E||g==6&&(S>0?C>0?w/D[p-C]:0:L[T-1])%10&1||g==(u.s<0?8:7)),f<1||!L[0])return L.length=0,E?(f-=u.e+1,L[0]=D[(nt-f%nt)%nt],u.e=-f||0):L[0]=u.e=0,u;if(S==0?(L.length=T,_=1,T--):(L.length=T+1,_=D[nt-S],L[T]=C>0?ke(w/D[p-C]%D[C])*_:0),E)for(;;)if(T==0){for(S=1,C=L[0];C>=10;C/=10,S++);for(C=L[0]+=_,_=1;C>=10;C/=10,_++);S!=_&&(u.e++,L[0]==je&&(L[0]=1));break}else{if(L[T]+=_,L[T]!=je)break;L[T--]=0,_=1}for(S=L.length;L[--S]===0;L.pop());}u.e>d?u.c=u.e=null:u.e<c&&(u.c=[u.e=0])}return u}function k(u){var f,g=u.e;return g===null?u.toString():(f=Ae(u.c),f=g<=l||g>=h?Jr(f,g):Ci(f,g,"0"),u.s<0?"-"+f:f)}return s.absoluteValue=s.abs=function(){var u=new v(this);return u.s<0&&(u.s=1),u},s.comparedTo=function(u,f){return vn(this,new v(u,f))},s.decimalPlaces=s.dp=function(u,f){var g,E,p,S=this;if(u!=null)return Pt(u,0,Se),f==null?f=a:Pt(f,0,8),G(new v(S),u+S.e+1,f);if(!(g=S.c))return null;if(E=((p=g.length-1)-De(this.e/nt))*nt,p=g[p])for(;p%10==0;p/=10,E--);return E<0&&(E=0),E},s.dividedBy=s.div=function(u,f){return t(this,new v(u,f),o,a)},s.dividedToIntegerBy=s.idiv=function(u,f){return t(this,new v(u,f),0,1)},s.exponentiatedBy=s.pow=function(u,f){var g,E,p,S,C,_,w,T,b,L=this;if(u=new v(u),u.c&&!u.isInteger())throw Error(ce+"Exponent not an integer: "+k(u));if(f!=null&&(f=new v(f)),_=u.e>14,!L.c||!L.c[0]||L.c[0]==1&&!L.e&&L.c.length==1||!u.c||!u.c[0])return b=new v(Math.pow(+k(L),_?u.s*(2-Hr(u)):+k(u))),f?b.mod(f):b;if(w=u.s<0,f){if(f.c?!f.c[0]:!f.s)return new v(NaN);E=!w&&L.isInteger()&&f.isInteger(),E&&(L=L.mod(f))}else{if(u.e>9&&(L.e>0||L.e<-1||(L.e==0?L.c[0]>1||_&&L.c[1]>=24e7:L.c[0]<8e13||_&&L.c[0]<=9999975e7)))return S=L.s<0&&Hr(u)?-0:0,L.e>-1&&(S=1/S),new v(w?1/S:S);x&&(S=ka(x/nt+2))}for(_?(g=new v(.5),w&&(u.s=1),T=Hr(u)):(p=Math.abs(+k(u)),T=p%2),b=new v(r);;){if(T){if(b=b.times(L),!b.c)break;S?b.c.length>S&&(b.c.length=S):E&&(b=b.mod(f))}if(p){if(p=ke(p/2),p===0)break;T=p%2}else if(u=u.times(g),G(u,u.e+1,1),u.e>14)T=Hr(u);else{if(p=+k(u),p===0)break;T=p%2}L=L.times(L),S?L.c&&L.c.length>S&&(L.c.length=S):E&&(L=L.mod(f))}return E?b:(w&&(b=r.div(b)),f?b.mod(f):S?G(b,x,a,C):b)},s.integerValue=function(u){var f=new v(this);return u==null?u=a:Pt(u,0,8),G(f,f.e+1,u)},s.isEqualTo=s.eq=function(u,f){return vn(this,new v(u,f))===0},s.isFinite=function(){return!!this.c},s.isGreaterThan=s.gt=function(u,f){return vn(this,new v(u,f))>0},s.isGreaterThanOrEqualTo=s.gte=function(u,f){return(f=vn(this,new v(u,f)))===1||f===0},s.isInteger=function(){return!!this.c&&De(this.e/nt)>this.c.length-2},s.isLessThan=s.lt=function(u,f){return vn(this,new v(u,f))<0},s.isLessThanOrEqualTo=s.lte=function(u,f){return(f=vn(this,new v(u,f)))===-1||f===0},s.isNaN=function(){return!this.s},s.isNegative=function(){return this.s<0},s.isPositive=function(){return this.s>0},s.isZero=function(){return!!this.c&&this.c[0]==0},s.minus=function(u,f){var g,E,p,S,C=this,_=C.s;if(u=new v(u,f),f=u.s,!_||!f)return new v(NaN);if(_!=f)return u.s=-f,C.plus(u);var w=C.e/nt,T=u.e/nt,b=C.c,L=u.c;if(!w||!T){if(!b||!L)return b?(u.s=-f,u):new v(L?C:NaN);if(!b[0]||!L[0])return L[0]?(u.s=-f,u):new v(b[0]?C:a==3?-0:0)}if(w=De(w),T=De(T),b=b.slice(),_=w-T){for((S=_<0)?(_=-_,p=b):(T=w,p=L),p.reverse(),f=_;f--;p.push(0));p.reverse()}else for(E=(S=(_=b.length)<(f=L.length))?_:f,_=f=0;f<E;f++)if(b[f]!=L[f]){S=b[f]<L[f];break}if(S&&(p=b,b=L,L=p,u.s=-u.s),f=(E=L.length)-(g=b.length),f>0)for(;f--;b[g++]=0);for(f=je-1;E>_;){if(b[--E]<L[E]){for(g=E;g&&!b[--g];b[g]=f);--b[g],b[E]+=je}b[E]-=L[E]}for(;b[0]==0;b.splice(0,1),--T);return b[0]?O(u,b,T):(u.s=a==3?-1:1,u.c=[u.e=0],u)},s.modulo=s.mod=function(u,f){var g,E,p=this;return u=new v(u,f),!p.c||!u.s||u.c&&!u.c[0]?new v(NaN):!u.c||p.c&&!p.c[0]?new v(p):(y==9?(E=u.s,u.s=1,g=t(p,u,0,3),u.s=E,g.s*=E):g=t(p,u,0,y),u=p.minus(g.times(u)),!u.c[0]&&y==1&&(u.s=p.s),u)},s.multipliedBy=s.times=function(u,f){var g,E,p,S,C,_,w,T,b,L,D,z,F,U,K,B=this,X=B.c,q=(u=new v(u,f)).c;if(!X||!q||!X[0]||!q[0])return!B.s||!u.s||X&&!X[0]&&!q||q&&!q[0]&&!X?u.c=u.e=u.s=null:(u.s*=B.s,!X||!q?u.c=u.e=null:(u.c=[0],u.e=0)),u;for(E=De(B.e/nt)+De(u.e/nt),u.s*=B.s,w=X.length,L=q.length,w<L&&(F=X,X=q,q=F,p=w,w=L,L=p),p=w+L,F=[];p--;F.push(0));for(U=je,K=en,p=L;--p>=0;){for(g=0,D=q[p]%K,z=q[p]/K|0,C=w,S=p+C;S>p;)T=X[--C]%K,b=X[C]/K|0,_=z*T+b*D,T=D*T+_%K*K+F[S]+g,g=(T/U|0)+(_/K|0)+z*b,F[S--]=T%U;F[S]=g}return g?++E:F.splice(0,1),O(u,F,E)},s.negated=function(){var u=new v(this);return u.s=-u.s||null,u},s.plus=function(u,f){var g,E=this,p=E.s;if(u=new v(u,f),f=u.s,!p||!f)return new v(NaN);if(p!=f)return u.s=-f,E.minus(u);var S=E.e/nt,C=u.e/nt,_=E.c,w=u.c;if(!S||!C){if(!_||!w)return new v(p/0);if(!_[0]||!w[0])return w[0]?u:new v(_[0]?E:p*0)}if(S=De(S),C=De(C),_=_.slice(),p=S-C){for(p>0?(C=S,g=w):(p=-p,g=_),g.reverse();p--;g.push(0));g.reverse()}for(p=_.length,f=w.length,p-f<0&&(g=w,w=_,_=g,f=p),p=0;f;)p=(_[--f]=_[f]+w[f]+p)/je|0,_[f]=je===_[f]?0:_[f]%je;return p&&(_=[p].concat(_),++C),O(u,_,C)},s.precision=s.sd=function(u,f){var g,E,p,S=this;if(u!=null&&u!==!!u)return Pt(u,1,Se),f==null?f=a:Pt(f,0,8),G(new v(S),u,f);if(!(g=S.c))return null;if(p=g.length-1,E=p*nt+1,p=g[p]){for(;p%10==0;p/=10,E--);for(p=g[0];p>=10;p/=10,E++);}return u&&S.e+1>E&&(E=S.e+1),E},s.shiftedBy=function(u){return Pt(u,-9007199254740991,$c),this.times("1e"+u)},s.squareRoot=s.sqrt=function(){var u,f,g,E,p,S=this,C=S.c,_=S.s,w=S.e,T=o+4,b=new v("0.5");if(_!==1||!C||!C[0])return new v(!_||_<0&&(!C||C[0])?NaN:C?S:1/0);if(_=Math.sqrt(+k(S)),_==0||_==1/0?(f=Ae(C),(f.length+w)%2==0&&(f+="0"),_=Math.sqrt(+f),w=De((w+1)/2)-(w<0||w%2),_==1/0?f="5e"+w:(f=_.toExponential(),f=f.slice(0,f.indexOf("e")+1)+w),g=new v(f)):g=new v(_+""),g.c[0]){for(w=g.e,_=w+T,_<3&&(_=0);;)if(p=g,g=b.times(p.plus(t(S,p,T,1))),Ae(p.c).slice(0,_)===(f=Ae(g.c)).slice(0,_))if(g.e<w&&--_,f=f.slice(_-3,_+1),f=="9999"||!E&&f=="4999"){if(!E&&(G(p,p.e+o+2,0),p.times(p).eq(S))){g=p;break}T+=4,_+=4,E=1}else{(!+f||!+f.slice(1)&&f.charAt(0)=="5")&&(G(g,g.e+o+2,1),u=!g.times(g).eq(S));break}}return G(g,g.e+o+1,a,u)},s.toExponential=function(u,f){return u!=null&&(Pt(u,0,Se),u++),A(this,u,f,1)},s.toFixed=function(u,f){return u!=null&&(Pt(u,0,Se),u=u+this.e+1),A(this,u,f)},s.toFormat=function(u,f,g){var E,p=this;if(g==null)u!=null&&f&&typeof f=="object"?(g=f,f=null):u&&typeof u=="object"?(g=u,u=f=null):g=R;else if(typeof g!="object")throw Error(ce+"Argument not an object: "+g);if(E=p.toFixed(u,f),p.c){var S,C=E.split("."),_=+g.groupSize,w=+g.secondaryGroupSize,T=g.groupSeparator||"",b=C[0],L=C[1],D=p.s<0,z=D?b.slice(1):b,F=z.length;if(w&&(S=_,_=w,w=S,F-=S),_>0&&F>0){for(S=F%_||_,b=z.substr(0,S);S<F;S+=_)b+=T+z.substr(S,_);w>0&&(b+=T+z.slice(S)),D&&(b="-"+b)}E=L?b+(g.decimalSeparator||"")+((w=+g.fractionGroupSize)?L.replace(new RegExp("\\d{"+w+"}\\B","g"),"$&"+(g.fractionGroupSeparator||"")):L):b}return(g.prefix||"")+E+(g.suffix||"")},s.toFraction=function(u){var f,g,E,p,S,C,_,w,T,b,L,D,z=this,F=z.c;if(u!=null&&(_=new v(u),!_.isInteger()&&(_.c||_.s!==1)||_.lt(r)))throw Error(ce+"Argument "+(_.isInteger()?"out of range: ":"not an integer: ")+k(_));if(!F)return new v(z);for(f=new v(r),T=g=new v(r),E=w=new v(r),D=Ae(F),S=f.e=D.length-z.e-1,f.c[0]=Da[(C=S%nt)<0?nt+C:C],u=!u||_.comparedTo(f)>0?S>0?f:T:_,C=d,d=1/0,_=new v(D),w.c[0]=0;b=t(_,f,0,1),p=g.plus(b.times(E)),p.comparedTo(u)!=1;)g=E,E=p,T=w.plus(b.times(p=T)),w=p,f=_.minus(b.times(p=f)),_=p;return p=t(u.minus(g),E,0,1),w=w.plus(p.times(T)),g=g.plus(p.times(E)),w.s=T.s=z.s,S=S*2,L=t(T,E,S,a).minus(z).abs().comparedTo(t(w,g,S,a).minus(z).abs())<1?[T,E]:[w,g],d=C,L},s.toNumber=function(){return+k(this)},s.toPrecision=function(u,f){return u!=null&&Pt(u,1,Se),A(this,u,f,2)},s.toString=function(u){var f,g=this,E=g.s,p=g.e;return p===null?E?(f="Infinity",E<0&&(f="-"+f)):f="NaN":(u==null?f=p<=l||p>=h?Jr(Ae(g.c),p):Ci(Ae(g.c),p,"0"):u===10&&M?(g=G(new v(g),o+p+1,a),f=Ci(Ae(g.c),g.e,"0")):(Pt(u,2,I.length,"Base"),f=e(Ci(Ae(g.c),p,"0"),10,u,E,!0)),E<0&&g.c[0]&&(f="-"+f)),f},s.valueOf=s.toJSON=function(){return k(this)},s._isBigNumber=!0,s[Symbol.toStringTag]="BigNumber",s[Symbol.for("nodejs.util.inspect.custom")]=s.valueOf,n!=null&&v.set(n),v}function De(n){var t=n|0;return n>0||n===t?t:t-1}function Ae(n){for(var t,e,i=1,s=n.length,r=n[0]+"";i<s;){for(t=n[i++]+"",e=nt-t.length;e--;t="0"+t);r+=t}for(s=r.length;r.charCodeAt(--s)===48;);return r.slice(0,s+1||1)}function vn(n,t){var e,i,s=n.c,r=t.c,o=n.s,a=t.s,l=n.e,h=t.e;if(!o||!a)return null;if(e=s&&!s[0],i=r&&!r[0],e||i)return e?i?0:-a:o;if(o!=a)return o;if(e=o<0,i=l==h,!s||!r)return i?0:!s^e?1:-1;if(!i)return l>h^e?1:-1;for(a=(l=s.length)<(h=r.length)?l:h,o=0;o<a;o++)if(s[o]!=r[o])return s[o]>r[o]^e?1:-1;return l==h?0:l>h^e?1:-1}function Pt(n,t,e,i){if(n<t||n>e||n!==ke(n))throw Error(ce+(i||"Argument")+(typeof n=="number"?n<t||n>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(n))}function Hr(n){var t=n.c.length-1;return De(n.e/nt)==t&&n.c[t]%2!=0}function Jr(n,t){return(n.length>1?n.charAt(0)+"."+n.slice(1):n)+(t<0?"e":"e+")+t}function Ci(n,t,e){var i,s;if(t<0){for(s=e+".";++t;s+=e);n=s+n}else if(i=n.length,++t>i){for(s=e,t-=i;--t;s+=e);n+=s}else t<i&&(n=n.slice(0,t)+"."+n.slice(t));return n}var ui=jd(),o1=class{constructor(n){Y(this,"key"),Y(this,"left",null),Y(this,"right",null),this.key=n}},zs=class extends o1{constructor(n){super(n)}},a1=class{constructor(){Y(this,"size",0),Y(this,"modificationCount",0),Y(this,"splayCount",0)}splay(n){const t=this.root;if(t==null)return this.compare(n,n),-1;let e=null,i=null,s=null,r=null,o=t;const a=this.compare;let l;for(;;)if(l=a(o.key,n),l>0){let h=o.left;if(h==null||(l=a(h.key,n),l>0&&(o.left=h.right,h.right=o,o=h,h=o.left,h==null)))break;e==null?i=o:e.left=o,e=o,o=h}else if(l<0){let h=o.right;if(h==null||(l=a(h.key,n),l<0&&(o.right=h.left,h.left=o,o=h,h=o.right,h==null)))break;s==null?r=o:s.right=o,s=o,o=h}else break;return s!=null&&(s.right=o.left,o.left=r),e!=null&&(e.left=o.right,o.right=i),this.root!==o&&(this.root=o,this.splayCount++),l}splayMin(n){let t=n,e=t.left;for(;e!=null;){const i=e;t.left=i.right,i.right=t,t=i,e=t.left}return t}splayMax(n){let t=n,e=t.right;for(;e!=null;){const i=e;t.right=i.left,i.left=t,t=i,e=t.right}return t}_delete(n){if(this.root==null||this.splay(n)!=0)return null;let t=this.root;const e=t,i=t.left;if(this.size--,i==null)this.root=t.right;else{const s=t.right;t=this.splayMax(i),t.right=s,this.root=t}return this.modificationCount++,e}addNewRoot(n,t){this.size++,this.modificationCount++;const e=this.root;if(e==null){this.root=n;return}t<0?(n.left=e,n.right=e.right,e.right=null):(n.right=e,n.left=e.left,e.left=null),this.root=n}_first(){const n=this.root;return n==null?null:(this.root=this.splayMin(n),this.root)}_last(){const n=this.root;return n==null?null:(this.root=this.splayMax(n),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(n){return this.validKey(n)&&this.splay(n)==0}defaultCompare(){return(n,t)=>n<t?-1:n>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:n=>{this.root=n},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:n=>{this.splayCount=n},splay:n=>this.splay(n),has:n=>this.has(n)}}},Wc,Bc,Mo=class Hs extends a1{constructor(t,e){super(),Y(this,"root",null),Y(this,"compare"),Y(this,"validKey"),Y(this,Wc,"[object Set]"),this.compare=t??this.defaultCompare(),this.validKey=e??(i=>i!=null&&i!=null)}delete(t){return this.validKey(t)?this._delete(t)!=null:!1}deleteAll(t){for(const e of t)this.delete(e)}forEach(t){const e=this[Symbol.iterator]();let i;for(;i=e.next(),!i.done;)t(i.value,i.value,this)}add(t){const e=this.splay(t);return e!=0&&this.addNewRoot(new zs(t),e),this}addAndReturn(t){const e=this.splay(t);return e!=0&&this.addNewRoot(new zs(t),e),this.root.key}addAll(t){for(const e of t)this.add(e)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)<0)return this.root.key;let e=this.root.left;if(e==null)return null;let i=e.right;for(;i!=null;)e=i,i=e.right;return e.key}firstAfter(t){if(t==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(t)>0)return this.root.key;let e=this.root.right;if(e==null)return null;let i=e.left;for(;i!=null;)e=i,i=e.left;return e.key}retainAll(t){const e=new Hs(this.compare,this.validKey),i=this.modificationCount;for(const s of t){if(i!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(s)&&this.splay(s)==0&&e.add(this.root.key)}e.size!=this.size&&(this.root=e.root,this.size=e.size,this.modificationCount++)}lookup(t){return!this.validKey(t)||this.splay(t)!=0?null:this.root.key}intersection(t){const e=new Hs(this.compare,this.validKey);for(const i of this)t.has(i)&&e.add(i);return e}difference(t){const e=new Hs(this.compare,this.validKey);for(const i of this)t.has(i)||e.add(i);return e}union(t){const e=this.clone();return e.addAll(t),e}clone(){const t=new Hs(this.compare,this.validKey);return t.size=this.size,t.root=this.copyNode(this.root),t}copyNode(t){if(t==null)return null;function e(s,r){let o,a;do{if(o=s.left,a=s.right,o!=null){const l=new zs(o.key);r.left=l,e(o,l)}if(a!=null){const l=new zs(a.key);r.right=l,s=a,r=l}}while(a!=null)}const i=new zs(t.key);return e(t,i),i}toSet(){return this.clone()}entries(){return new h1(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(Bc=Symbol.iterator,Wc=Symbol.toStringTag,Bc)](){return new l1(this.wrap())}},Kd=class{constructor(n){Y(this,"tree"),Y(this,"path",new Array),Y(this,"modificationCount",null),Y(this,"splayCount"),this.tree=n,this.splayCount=n.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const n=this.path[this.path.length-1];return this.getValue(n)}rebuildPath(n){this.path.splice(0,this.path.length),this.tree.splay(n),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(n){for(;n!=null;)this.path.push(n),n=n.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let e=this.tree.getRoot();for(;e!=null;)this.path.push(e),e=e.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let n=this.path[this.path.length-1],t=n.right;if(t!=null){for(;t!=null;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===n;)n=this.path.pop();return this.path.length>0}},l1=class extends Kd{getValue(n){return n.key}},h1=class extends Kd{getValue(n){return[n.key,n.key]}},Zd=n=>()=>n,dl=n=>{const t=n?(e,i)=>i.minus(e).abs().isLessThanOrEqualTo(n):Zd(!1);return(e,i)=>t(e,i)?0:e.comparedTo(i)};function c1(n){const t=n?(e,i,s,r,o)=>e.exponentiatedBy(2).isLessThanOrEqualTo(r.minus(i).exponentiatedBy(2).plus(o.minus(s).exponentiatedBy(2)).times(n)):Zd(!1);return(e,i,s)=>{const r=e.x,o=e.y,a=s.x,l=s.y,h=o.minus(l).times(i.x.minus(a)).minus(r.minus(a).times(i.y.minus(l)));return t(h,r,o,a,l)?0:h.comparedTo(0)}}var u1=n=>n,d1=n=>{if(n){const t=new Mo(dl(n)),e=new Mo(dl(n)),i=(r,o)=>o.addAndReturn(r),s=r=>({x:i(r.x,t),y:i(r.y,e)});return s({x:new ui(0),y:new ui(0)}),s}return u1},fl=n=>({set:t=>{$i=fl(t)},reset:()=>fl(n),compare:dl(n),snap:d1(n),orient:c1(n)}),$i=fl(),$s=(n,t)=>n.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(n.ur.x)&&n.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(n.ur.y),gl=(n,t)=>{if(t.ur.x.isLessThan(n.ll.x)||n.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(n.ll.y)||n.ur.y.isLessThan(t.ll.y))return null;const e=n.ll.x.isLessThan(t.ll.x)?t.ll.x:n.ll.x,i=n.ur.x.isLessThan(t.ur.x)?n.ur.x:t.ur.x,s=n.ll.y.isLessThan(t.ll.y)?t.ll.y:n.ll.y,r=n.ur.y.isLessThan(t.ur.y)?n.ur.y:t.ur.y;return{ll:{x:e,y:s},ur:{x:i,y:r}}},ro=(n,t)=>n.x.times(t.y).minus(n.y.times(t.x)),Vd=(n,t)=>n.x.times(t.x).plus(n.y.times(t.y)),Po=n=>Vd(n,n).sqrt(),f1=(n,t,e)=>{const i={x:t.x.minus(n.x),y:t.y.minus(n.y)},s={x:e.x.minus(n.x),y:e.y.minus(n.y)};return ro(s,i).div(Po(s)).div(Po(i))},g1=(n,t,e)=>{const i={x:t.x.minus(n.x),y:t.y.minus(n.y)},s={x:e.x.minus(n.x),y:e.y.minus(n.y)};return Vd(s,i).div(Po(s)).div(Po(i))},Xc=(n,t,e)=>t.y.isZero()?null:{x:n.x.plus(t.x.div(t.y).times(e.minus(n.y))),y:e},Uc=(n,t,e)=>t.x.isZero()?null:{x:e,y:n.y.plus(t.y.div(t.x).times(e.minus(n.x)))},m1=(n,t,e,i)=>{if(t.x.isZero())return Uc(e,i,n.x);if(i.x.isZero())return Uc(n,t,e.x);if(t.y.isZero())return Xc(e,i,n.y);if(i.y.isZero())return Xc(n,t,e.y);const s=ro(t,i);if(s.isZero())return null;const r={x:e.x.minus(n.x),y:e.y.minus(n.y)},o=ro(r,t).div(s),a=ro(r,i).div(s),l=n.x.plus(a.times(t.x)),h=e.x.plus(o.times(i.x)),c=n.y.plus(a.times(t.y)),d=e.y.plus(o.times(i.y)),m=l.plus(h).div(2),y=c.plus(d).div(2);return{x:m,y}},si=class qd{constructor(t,e){Y(this,"point"),Y(this,"isLeft"),Y(this,"segment"),Y(this,"otherSE"),Y(this,"consumedBy"),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}static compare(t,e){const i=qd.comparePoints(t.point,e.point);return i!==0?i:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:Oo.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x.isLessThan(e.x)?-1:t.x.isGreaterThan(e.x)?1:t.y.isLessThan(e.y)?-1:t.y.isGreaterThan(e.y)?1:0}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let i=0,s=e.length;i<s;i++){const r=e[i];this.point.events.push(r),r.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const i=this.point.events[e];if(i.segment.consumedBy===void 0)for(let s=e+1;s<t;s++){const r=this.point.events[s];r.consumedBy===void 0&&i.otherSE.point.events===r.otherSE.point.events&&i.segment.consume(r.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,i=this.point.events.length;e<i;e++){const s=this.point.events[e];s!==this&&!s.segment.ringOut&&s.segment.isInResult()&&t.push(s)}return t}getLeftmostComparator(t){const e=new Map,i=s=>{const r=s.otherSE;e.set(s,{sine:f1(this.point,t.point,r.point),cosine:g1(this.point,t.point,r.point)})};return(s,r)=>{e.has(s)||i(s),e.has(r)||i(r);const{sine:o,cosine:a}=e.get(s),{sine:l,cosine:h}=e.get(r);return o.isGreaterThanOrEqualTo(0)&&l.isGreaterThanOrEqualTo(0)?a.isLessThan(h)?1:a.isGreaterThan(h)?-1:0:o.isLessThan(0)&&l.isLessThan(0)?a.isLessThan(h)?-1:a.isGreaterThan(h)?1:0:l.isLessThan(o)?-1:l.isGreaterThan(o)?1:0}}},p1=class ml{constructor(t){Y(this,"events"),Y(this,"poly"),Y(this,"_isExteriorRing"),Y(this,"_enclosingRing"),this.events=t;for(let e=0,i=t.length;e<i;e++)t[e].segment.ringOut=this;this.poly=null}static factory(t){const e=[];for(let i=0,s=t.length;i<s;i++){const r=t[i];if(!r.isInResult()||r.ringOut)continue;let o=null,a=r.leftSE,l=r.rightSE;const h=[a],c=a.point,d=[];for(;o=a,a=l,h.push(a),a.point!==c;)for(;;){const m=a.getAvailableLinkedEvents();if(m.length===0){const R=h[0].point,I=h[h.length-1].point;throw new Error(`Unable to complete output ring starting at [${R.x}, ${R.y}]. Last matching segment found ends at [${I.x}, ${I.y}].`)}if(m.length===1){l=m[0].otherSE;break}let y=null;for(let R=0,I=d.length;R<I;R++)if(d[R].point===a.point){y=R;break}if(y!==null){const R=d.splice(y)[0],I=h.splice(R.index);I.unshift(I[0].otherSE),e.push(new ml(I.reverse()));continue}d.push({index:h.length,point:a.point});const x=a.getLeftmostComparator(o);l=m.sort(x)[0].otherSE;break}e.push(new ml(h))}return e}getGeom(){let t=this.events[0].point;const e=[t];for(let h=1,c=this.events.length-1;h<c;h++){const d=this.events[h].point,m=this.events[h+1].point;$i.orient(d,t,m)!==0&&(e.push(d),t=d)}if(e.length===1)return null;const i=e[0],s=e[1];$i.orient(i,t,s)===0&&e.shift(),e.push(e[0]);const r=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:e.length-1,a=this.isExteriorRing()?e.length:-1,l=[];for(let h=o;h!=a;h+=r)l.push([e[h].x.toNumber(),e[h].y.toNumber()]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var t,e;let i=this.events[0];for(let o=1,a=this.events.length;o<a;o++){const l=this.events[o];si.compare(i,l)>0&&(i=l)}let s=i.segment.prevInResult(),r=s?s.prevInResult():null;for(;;){if(!s)return null;if(!r)return s.ringOut;if(r.ringOut!==s.ringOut)return((t=r.ringOut)==null?void 0:t.enclosingRing())!==s.ringOut?s.ringOut:(e=s.ringOut)==null?void 0:e.enclosingRing();s=r.prevInResult(),r=s?s.prevInResult():null}}},Yc=class{constructor(n){Y(this,"exteriorRing"),Y(this,"interiorRings"),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}addInterior(n){this.interiorRings.push(n),n.poly=this}getGeom(){const n=this.exteriorRing.getGeom();if(n===null)return null;const t=[n];for(let e=0,i=this.interiorRings.length;e<i;e++){const s=this.interiorRings[e].getGeom();s!==null&&t.push(s)}return t}},_1=class{constructor(n){Y(this,"rings"),Y(this,"polys"),this.rings=n,this.polys=this._composePolys(n)}getGeom(){const n=[];for(let t=0,e=this.polys.length;t<e;t++){const i=this.polys[t].getGeom();i!==null&&n.push(i)}return n}_composePolys(n){var t;const e=[];for(let i=0,s=n.length;i<s;i++){const r=n[i];if(!r.poly)if(r.isExteriorRing())e.push(new Yc(r));else{const o=r.enclosingRing();o!=null&&o.poly||e.push(new Yc(o)),(t=o==null?void 0:o.poly)==null||t.addInterior(r)}}return e}},y1=class{constructor(n,t=Oo.compare){Y(this,"queue"),Y(this,"tree"),Y(this,"segments"),this.queue=n,this.tree=new Mo(t),this.segments=[]}process(n){const t=n.segment,e=[];if(n.consumedBy)return n.isLeft?this.queue.delete(n.otherSE):this.tree.delete(t),e;n.isLeft&&this.tree.add(t);let i=t,s=t;do i=this.tree.lastBefore(i);while(i!=null&&i.consumedBy!=null);do s=this.tree.firstAfter(s);while(s!=null&&s.consumedBy!=null);if(n.isLeft){let r=null;if(i){const a=i.getIntersection(t);if(a!==null&&(t.isAnEndpoint(a)||(r=a),!i.isAnEndpoint(a))){const l=this._splitSafely(i,a);for(let h=0,c=l.length;h<c;h++)e.push(l[h])}}let o=null;if(s){const a=s.getIntersection(t);if(a!==null&&(t.isAnEndpoint(a)||(o=a),!s.isAnEndpoint(a))){const l=this._splitSafely(s,a);for(let h=0,c=l.length;h<c;h++)e.push(l[h])}}if(r!==null||o!==null){let a=null;r===null?a=o:o===null?a=r:a=si.comparePoints(r,o)<=0?r:o,this.queue.delete(t.rightSE),e.push(t.rightSE);const l=t.split(a);for(let h=0,c=l.length;h<c;h++)e.push(l[h])}e.length>0?(this.tree.delete(t),e.push(n)):(this.segments.push(t),t.prev=i)}else{if(i&&s){const r=i.getIntersection(s);if(r!==null){if(!i.isAnEndpoint(r)){const o=this._splitSafely(i,r);for(let a=0,l=o.length;a<l;a++)e.push(o[a])}if(!s.isAnEndpoint(r)){const o=this._splitSafely(s,r);for(let a=0,l=o.length;a<l;a++)e.push(o[a])}}}this.tree.delete(t)}return e}_splitSafely(n,t){this.tree.delete(n);const e=n.rightSE;this.queue.delete(e);const i=n.split(t);return i.push(e),n.consumedBy===void 0&&this.tree.add(n),i}},x1=class{constructor(){Y(this,"type"),Y(this,"numMultiPolys")}run(n,t,e){Js.type=n;const i=[new Kc(t,!0)];for(let l=0,h=e.length;l<h;l++)i.push(new Kc(e[l],!1));if(Js.numMultiPolys=i.length,Js.type==="difference"){const l=i[0];let h=1;for(;h<i.length;)gl(i[h].bbox,l.bbox)!==null?h++:i.splice(h,1)}if(Js.type==="intersection")for(let l=0,h=i.length;l<h;l++){const c=i[l];for(let d=l+1,m=i.length;d<m;d++)if(gl(c.bbox,i[d].bbox)===null)return[]}const s=new Mo(si.compare);for(let l=0,h=i.length;l<h;l++){const c=i[l].getSweepEvents();for(let d=0,m=c.length;d<m;d++)s.add(c[d])}const r=new y1(s);let o=null;for(s.size!=0&&(o=s.first(),s.delete(o));o;){const l=r.process(o);for(let h=0,c=l.length;h<c;h++){const d=l[h];d.consumedBy===void 0&&s.add(d)}s.size!=0?(o=s.first(),s.delete(o)):o=null}$i.reset();const a=p1.factory(r.segments);return new _1(a).getGeom()}},Js=new x1,Ao=Js,E1=0,Oo=class oo{constructor(t,e,i,s){Y(this,"id"),Y(this,"leftSE"),Y(this,"rightSE"),Y(this,"rings"),Y(this,"windings"),Y(this,"ringOut"),Y(this,"consumedBy"),Y(this,"prev"),Y(this,"_prevInResult"),Y(this,"_beforeState"),Y(this,"_afterState"),Y(this,"_isInResult"),this.id=++E1,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=i,this.windings=s}static compare(t,e){const i=t.leftSE.point.x,s=e.leftSE.point.x,r=t.rightSE.point.x,o=e.rightSE.point.x;if(o.isLessThan(i))return 1;if(r.isLessThan(s))return-1;const a=t.leftSE.point.y,l=e.leftSE.point.y,h=t.rightSE.point.y,c=e.rightSE.point.y;if(i.isLessThan(s)){if(l.isLessThan(a)&&l.isLessThan(h))return 1;if(l.isGreaterThan(a)&&l.isGreaterThan(h))return-1;const d=t.comparePoint(e.leftSE.point);if(d<0)return 1;if(d>0)return-1;const m=e.comparePoint(t.rightSE.point);return m!==0?m:-1}if(i.isGreaterThan(s)){if(a.isLessThan(l)&&a.isLessThan(c))return-1;if(a.isGreaterThan(l)&&a.isGreaterThan(c))return 1;const d=e.comparePoint(t.leftSE.point);if(d!==0)return d;const m=t.comparePoint(e.rightSE.point);return m<0?1:m>0?-1:1}if(a.isLessThan(l))return-1;if(a.isGreaterThan(l))return 1;if(r.isLessThan(o)){const d=e.comparePoint(t.rightSE.point);if(d!==0)return d}if(r.isGreaterThan(o)){const d=t.comparePoint(e.rightSE.point);if(d<0)return 1;if(d>0)return-1}if(!r.eq(o)){const d=h.minus(a),m=r.minus(i),y=c.minus(l),x=o.minus(s);if(d.isGreaterThan(m)&&y.isLessThan(x))return 1;if(d.isLessThan(m)&&y.isGreaterThan(x))return-1}return r.isGreaterThan(o)?1:r.isLessThan(o)||h.isLessThan(c)?-1:h.isGreaterThan(c)?1:t.id<e.id?-1:t.id>e.id?1:0}static fromRing(t,e,i){let s,r,o;const a=si.comparePoints(t,e);if(a<0)s=t,r=e,o=1;else if(a>0)s=e,r=t,o=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const l=new si(s,!0),h=new si(r,!1);return new oo(l,h,[i],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(e)?t:e},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(e)?t:e}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return $i.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){const e=this.bbox(),i=t.bbox(),s=gl(e,i);if(s===null)return null;const r=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,l=t.rightSE.point,h=$s(e,a)&&this.comparePoint(a)===0,c=$s(i,r)&&t.comparePoint(r)===0,d=$s(e,l)&&this.comparePoint(l)===0,m=$s(i,o)&&t.comparePoint(o)===0;if(c&&h)return m&&!d?o:!m&&d?l:null;if(c)return d&&r.x.eq(l.x)&&r.y.eq(l.y)?null:r;if(h)return m&&o.x.eq(a.x)&&o.y.eq(a.y)?null:a;if(m&&d)return null;if(m)return o;if(d)return l;const y=m1(r,this.vector(),a,t.vector());return y===null||!$s(s,y)?null:$i.snap(y)}split(t){const e=[],i=t.events!==void 0,s=new si(t,!0),r=new si(t,!1),o=this.rightSE;this.replaceRightSE(r),e.push(r),e.push(s);const a=new oo(s,o,this.rings.slice(),this.windings.slice());return si.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),si.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(s.checkForConsuming(),r.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,i=this.windings.length;e<i;e++)this.windings[e]*=-1}consume(t){let e=this,i=t;for(;e.consumedBy;)e=e.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const s=oo.compare(e,i);if(s!==0){if(s>0){const r=e;e=i,i=r}if(e.prev===i){const r=e;e=i,i=r}for(let r=0,o=i.rings.length;r<o;r++){const a=i.rings[r],l=i.windings[r],h=e.rings.indexOf(a);h===-1?(e.rings.push(a),e.windings.push(l)):e.windings[h]+=l}i.rings=null,i.windings=null,i.consumedBy=e,i.leftSE.consumedBy=e.leftSE,i.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,i=this._afterState.windings,s=this._afterState.multiPolys;for(let a=0,l=this.rings.length;a<l;a++){const h=this.rings[a],c=this.windings[a],d=e.indexOf(h);d===-1?(e.push(h),i.push(c)):i[d]+=c}const r=[],o=[];for(let a=0,l=e.length;a<l;a++){if(i[a]===0)continue;const h=e[a],c=h.poly;if(o.indexOf(c)===-1)if(h.isExterior)r.push(c);else{o.indexOf(c)===-1&&o.push(c);const d=r.indexOf(h.poly);d!==-1&&r.splice(d,1)}}for(let a=0,l=r.length;a<l;a++){const h=r[a].multiPoly;s.indexOf(h)===-1&&s.push(h)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(Ao.type){case"union":{const i=t.length===0,s=e.length===0;this._isInResult=i!==s;break}case"intersection":{let i,s;t.length<e.length?(i=t.length,s=e.length):(i=e.length,s=t.length),this._isInResult=s===Ao.numMultiPolys&&i<s;break}case"xor":{const i=Math.abs(t.length-e.length);this._isInResult=i%2===1;break}case"difference":{const i=s=>s.length===1&&s[0].isSubject;this._isInResult=i(t)!==i(e);break}}return this._isInResult}},jc=class{constructor(n,t,e){if(Y(this,"poly"),Y(this,"isExterior"),Y(this,"segments"),Y(this,"bbox"),!Array.isArray(n)||n.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=e,this.segments=[],typeof n[0][0]!="number"||typeof n[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=$i.snap({x:new ui(n[0][0]),y:new ui(n[0][1])});this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let s=i;for(let r=1,o=n.length;r<o;r++){if(typeof n[r][0]!="number"||typeof n[r][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=$i.snap({x:new ui(n[r][0]),y:new ui(n[r][1])});a.x.eq(s.x)&&a.y.eq(s.y)||(this.segments.push(Oo.fromRing(s,a,this)),a.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.x),a.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.y),a.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.x),a.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.y),s=a)}(!i.x.eq(s.x)||!i.y.eq(s.y))&&this.segments.push(Oo.fromRing(s,i,this))}getSweepEvents(){const n=[];for(let t=0,e=this.segments.length;t<e;t++){const i=this.segments[t];n.push(i.leftSE),n.push(i.rightSE)}return n}},v1=class{constructor(n,t){if(Y(this,"multiPoly"),Y(this,"exteriorRing"),Y(this,"interiorRings"),Y(this,"bbox"),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new jc(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,i=n.length;e<i;e++){const s=new jc(n[e],this,!1);s.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=s.bbox.ur.y),this.interiorRings.push(s)}this.multiPoly=t}getSweepEvents(){const n=this.exteriorRing.getSweepEvents();for(let t=0,e=this.interiorRings.length;t<e;t++){const i=this.interiorRings[t].getSweepEvents();for(let s=0,r=i.length;s<r;s++)n.push(i[s])}return n}},Kc=class{constructor(n,t){if(Y(this,"isSubject"),Y(this,"polys"),Y(this,"bbox"),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof n[0][0][0]=="number"&&(n=[n])}catch{}this.polys=[],this.bbox={ll:{x:new ui(Number.POSITIVE_INFINITY),y:new ui(Number.POSITIVE_INFINITY)},ur:{x:new ui(Number.NEGATIVE_INFINITY),y:new ui(Number.NEGATIVE_INFINITY)}};for(let e=0,i=n.length;e<i;e++){const s=new v1(n[e],this);s.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=s.bbox.ll.x),s.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=s.bbox.ll.y),s.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=s.bbox.ur.x),s.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=s.bbox.ur.y),this.polys.push(s)}this.isSubject=t}getSweepEvents(){const n=[];for(let t=0,e=this.polys.length;t<e;t++){const i=this.polys[t].getSweepEvents();for(let s=0,r=i.length;s<r;s++)n.push(i[s])}return n}},w1=(n,...t)=>Ao.run("union",n,t),S1=(n,...t)=>Ao.run("difference",n,t);$i.set;function C1(n){const t=[];if(ah(n,s=>{t.push(s.coordinates)}),t.length<2)throw new Error("Must have at least two features");const e=n.features[0].properties||{},i=S1(t[0],...t.slice(1));return i.length===0?null:i.length===1?oh(i[0],e):Ud(i,e)}var b1=C1;function T1(n){if(!n)throw new Error("geojson is required");var t=[];return n1(n,function(e){t.push(e)}),ul(t)}var R1=T1;function I1(n,t={}){const e=[];if(ah(n,s=>{e.push(s.coordinates)}),e.length<2)throw new Error("Must have at least 2 geometries");const i=w1(e[0],...e.slice(1));return i.length===0?null:i.length===1?oh(i[0],t.properties):Ud(i,t.properties)}var L1=I1;function Zc(n,t){const e=b1(ul([oh([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),n]));if(!e)return;e.properties={isMask:!0};const i=Io(Gc(n)),s=(i[2]-i[0])/360/1e3,r=i[0]<-180,o=i[2]>180,a=R1(n);if(a.features.length>1&&(r||o))for(const l of a.features){const h=Io(Gc(l));if(o&&h[0]<-180+s)for(const c of l.geometry.coordinates)for(const d of c)d[0]+=360-s;if(r&&h[2]>180-s)for(const c of l.geometry.coordinates)for(const d of c)d[0]-=360-s}t(ul([a.features.length<2?n:L1(a)??n,e]))}const Vc="EPSG:4326";function M1(n){var t;const e=n.getProperties(),{isMask:i}=e,s=(t=n.getGeometry())==null?void 0:t.getType(),r=i?0:s==="LineString"||s==="MultiLineString"?3:2;return new Ve({stroke:i?void 0:new Oi({color:"#3170fe",lineDash:[r,r],width:r,lineCap:"butt"}),fill:i?new fi({color:"#00000020"}):void 0,image:new Rr({src:`/icons/marker_${e.isReverse?"reverse":e.isSelected?"selected":"unselected"}.svg`,anchor:[.5,1]}),zIndex:e.isSelected?2:e.isReverse?0:1,text:e.isSelected&&e.tooltip?new Jo({backgroundFill:new fi({color:"white"}),text:e.tooltip,offsetY:-40,backgroundStroke:new Oi({color:"white",lineJoin:"round",width:3}),padding:[2,0,0,2]}):void 0})}function P1(n,t={},e={},i=M1){let s=-1,r,o,a,l=!1;const h=new hd({updateWhileAnimating:!0});n.addLayer(h);const c=new Ku({});h.setSource(c),h.setStyle(i),n.on("click",x=>{n.forEachFeatureAtPixel(x.pixel,R=>{const I=R.getId();if(I)return x.stopPropagation(),o==null||o({type:"markerClick",id:I}),R})}),n.on("pointermove",x=>{const R=n.forEachFeatureAtPixel(x.pixel,I=>I.getId());r!==R&&(r&&(o==null||o({type:"markerMouseLeave",id:r})),R&&(o==null||o({type:"markerMouseEnter",id:R})),n.getTargetElement().style.cursor=R?"pointer":l?"crosshair":"",r=R)});function d(){return n.getView().getProjection()}function m(x){return x.transform(Vc,d())}const y=x=>{o==null||o({type:"mapClick",coordinates:Ch(x.coordinate,d())})};return{setEventHandler(x){x?(o=x,n.on("click",y)):(o=void 0,n.un("click",y))},flyTo(x,R){n.getView().animate({center:Bs(x,d()),...R?{zoom:R}:{},duration:2e3,...t})},fitBounds(x,R,I){n.getView().fit(sg(x,Vc,d()),{padding:[R,R,R,R],...I?{maxZoom:I}:{},duration:2e3,...e})},indicateReverse(x){l=x,n.getTargetElement().style.cursor=x?"crosshair":""},setReverseMarker(x){a?x?a.getGeometry().setCoordinates(Bs(x,d())):(c.removeFeature(a),a.dispose(),a=void 0):x&&(a=new Ce(new Mi(Bs(x,d()))),a.setProperties({isReverse:!0}),c.addFeature(a))},setFeatures(x,R,I){function M(v){var A;if(v)for(const P of v.features){const O=P.geometry.type==="Polygon"?new gi(P.geometry.coordinates):P.geometry.type==="MultiPolygon"?new Ss(P.geometry.coordinates):null;O&&c.addFeature(new Ce({isMask:!!((A=P.properties)!=null&&A.isMask),geometry:m(O)}))}}c.clear(),a&&c.addFeature(a);t:if(R){let v=!1;if(R.geometry.type==="GeometryCollection"){const A=R.geometry.geometries.map(P=>P.type==="Polygon"?new gi(P.coordinates):P.type==="MultiPolygon"?new Ss(P.coordinates):null).filter(P=>!!P);if(A.length>0)c.addFeature(new Ce(m(new fr(A)))),v=!0;else for(const P of R.geometry.geometries)P.type==="LineString"?(c.addFeature(new Ce(m(new un(P.coordinates)))),v=!0):P.type==="MultiLineString"&&c.addFeature(new Ce(m(new ws(P.coordinates)))),v=!0}if(!v){if(R.geometry.type==="Polygon")Zc(R,M);else if(R.geometry.type==="MultiPolygon")Zc(R,M);else if(R.geometry.type==="LineString"){c.addFeature(new Ce(m(new un(R.geometry.coordinates))));break t}else if(R.geometry.type==="MultiLineString"){c.addFeature(new Ce(m(new ws(R.geometry.coordinates))));break t}}if(!I&&!R.geometry.type.endsWith("Point"))break t;c.addFeature(new Ce(m(new Mi(R.center))))}for(const v of x??[]){if(v===R)continue;const A=new Ce(new Mi(Bs(v.center,d())));A.setId(v.id),A.setProperties({fuzzy:!!v.matching_text,tooltip:v.place_type[0]==="reverse"?v.place_name:v.place_name.replace(/,.*/,"")}),c.addFeature(A)}},setSelectedMarker(x){var R,I,M;const v=c.getFeatures(),A=(R=v[0])!=null&&R.getProperties().isReverse?1:0;s>-1&&((I=v[s+A])==null||I.setProperties({isSelected:!1})),x>-1&&((M=v[x+A])==null||M.setProperties({isSelected:!0})),s=x},getCenterAndZoom(){const x=n.getView(),R=x.getCenter(),I=x.getZoom();if(!(!R||I===void 0))return[I,...Ch(R,d())]}}}var $t,rs;class A1 extends Lr{constructor(t){const e=document.createElement("div");e.className="ol-search",super({element:e,target:t.target}),Ec(this,$t),Ec(this,rs);const{flyTo:i,fullGeometryStyle:s,...r}=t;vc(this,$t,new i1({target:e,props:{flyTo:i===void 0?!0:!!i,...r}})),zt(this,$t).$on("select",o=>{this.dispatchEvent(new O1(o.detail.feature))}),zt(this,$t).$on("pick",o=>{this.dispatchEvent(new N1(o.detail.feature))}),zt(this,$t).$on("featureslisted",o=>{this.dispatchEvent(new F1(o.detail.features))}),zt(this,$t).$on("featuresmarked",o=>{this.dispatchEvent(new k1(o.detail.features))}),zt(this,$t).$on("response",o=>{this.dispatchEvent(new z1(o.detail.url,o.detail.featureCollection))}),zt(this,$t).$on("optionsvisibilitychange",o=>{this.dispatchEvent(new D1(o.detail.optionsVisible))}),zt(this,$t).$on("reversetoggle",o=>{this.dispatchEvent(new $1(o.detail.reverse))}),zt(this,$t).$on("querychange",o=>{this.dispatchEvent(new G1(o.detail.query))}),vc(this,rs,t)}setMap(t){var e;if(super.setMap(t),t){const{flyTo:i,fullGeometryStyle:s}=zt(this,rs),r=P1(t,typeof i=="boolean"?void 0:i,typeof i=="boolean"?void 0:i,s);(e=zt(this,$t))==null||e.$set({mapController:r})}}setOptions(t){var e;Object.assign(zt(this,rs),t);const{flyTo:i,fullGeometryStyle:s,...r}=zt(this,rs);(e=zt(this,$t))==null||e.$set({...r,flyTo:i===void 0?!0:!!i})}setQuery(t,e=!0){var i;(i=zt(this,$t))==null||i.setQuery(t,e)}clearMap(){var t;(t=zt(this,$t))==null||t.clearMap()}clearList(){var t;(t=zt(this,$t))==null||t.clearList()}setReverseMode(t){var e;(e=zt(this,$t))==null||e.$set({reverseActive:t})}focus(t){var e;(e=zt(this,$t))==null||e.focus(t)}blur(){var t;(t=zt(this,$t))==null||t.blur()}}$t=new WeakMap,rs=new WeakMap;class O1 extends qt{constructor(t){super("select"),Y(this,"feature"),this.feature=t}}class F1 extends qt{constructor(t){super("featureslisted"),Y(this,"features"),this.features=t}}class k1 extends qt{constructor(t){super("featuresmarked"),Y(this,"features"),this.features=t}}class D1 extends qt{constructor(t){super("optionsvisibilitychange"),Y(this,"optionsVisible"),this.optionsVisible=t}}class N1 extends qt{constructor(t){super("pick"),Y(this,"feature"),this.feature=t}}class G1 extends qt{constructor(t){super("querychange"),Y(this,"query"),this.query=t}}class z1 extends qt{constructor(t,e){super("response"),Y(this,"url"),Y(this,"featureCollection"),this.url=t,this.featureCollection=e}}class $1 extends qt{constructor(t){super("reversetoggle"),Y(this,"reverse"),this.reverse=t}}const lh=new A1({placeholder:"Search for a suburb or LGA",apiKey:"eTAPdG2m2qPNNeCV7NPb",bbox:[115.69122472080639,-32.20096184271112,116.09518539210681,-31.866613555669637],filter:n=>n.place_type.includes("municipality")||n.place_type.includes("county")||n.place_type.includes("place")}),W1=new Sp({units:"metric"}),pl=new ud({collapsible:!1}),qc=document.getElementById("popup-content"),B1=document.getElementById("popup"),ao=new vp({element:B1,autoPan:{animation:{duration:250}}}),Hd=new Cd,ia=new hd({source:new Ku({url:"./dog_parks_poly.json",format:Hd}),style:Pn.dogPark}),yr=document.getElementById("parklist");let ir=null;yr.addEventListener("click",n=>{if(ir&&ir.setStyle(Pn.filtered),n.target.parentElement.classList.contains("parklist-item")){const t=n.target.parentElement.dataset.featureId,i=ia.getSource().getFeatures().find(s=>s.getId()===parseInt(t));i&&(ir=i,i.setStyle(Pn.hovered))}});let xr=[];lh.on("pick",({feature:n})=>{if(!n)return;const t=n.geometry;if(t.type!=="Polygon")return;const e=new Cd,i=e.readFeatures(JSON.stringify(t));if(i.length===0)return;const s=e.writeFeatureObject(i[0]),r=Td(s.geometry.coordinates);ia.getSource().getFeatures().forEach(l=>{const h=Hd.writeFeatureObject(l,{featureProjection:"EPSG:3857",dataProjection:"EPSG:4326"}),c=Rd(h.geometry.coordinates),d=T_([r,c]);j_(d)&&(yr.setAttribute("class","active"),xr.push(l),l.setStyle(Pn.filtered))});const a=xr.map(l=>{const h=l.getProperties();return`<div class="parklist-item" data-feature-id="${l.getId()}"><span class="park-name">${h.Park_Name}</span><span class="park-address">${h.Address}</div>`}).join("");yr.innerHTML=a});lh.on("querychange",()=>{xr.forEach(n=>{n.setStyle(null)}),yr.setAttribute("class",""),yr.innerHTML="",xr=[]});const X1=new dd({className:"ol-zoom-ph"}),hh=new xp({target:"map",layers:[new $p({source:new o_}),ia],overlays:[ao],target:"map",view:new oi({center:Bs([115.79967133671343,-32.00025]),zoom:12}),controls:[lh,W1,pl,X1]});function Jd(){const n=hh.getSize()[0]<600;pl.setCollapsible(n),pl.setCollapsed(n)}hh.on("change:size",Jd);Jd();let Ws=null;hh.on("singleclick",n=>{Ws&&(xr.includes(Ws)?Ws.setStyle(Pn.filtered):Ws.setStyle(null)),ir&&ir.setStyle(Pn.filtered);const t=ia.getSource().getFeaturesAtCoordinate(n.coordinate);if(t.length>0){const e=t[0],i=e.getProperties();qc.innerHTML=Z_(i.Park_Name,i.Address,i.Description,i.LGA_type,i.LGA_name,i.Telephone,i.Email,i.Website,i.Enclosed,i["Coordinates_(x,y)"]),ao.setPosition(n.coordinate),ao.setProperties({}),Ws=e,e.setStyle(Pn.hovered)}else ao.setPosition(void 0),qc.innerHTML=""});function U1(){const n=document.getElementById("myTopnav");n.className=n.className==="topnav"?"topnav responsive":"topnav"}document.getElementById("navToggle").addEventListener("click",U1);
//# sourceMappingURL=index-CmzYfQ8r.js.map
